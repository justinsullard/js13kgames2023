(()=>{let now=0,$3=500,$6=144e3,D=0,$NA=0,$t=0,$RA=0,measure=0,beat=0,bar=0,step=0,$5B=!0,$6A=1,$p=32;const{cos,sin,min,max,sqrt,floor:$uA,ceil,round:$HB,imul,abs,PI,sign:$aA}=Math,$dB=(E=0,t=E=>E)=>new Array(E).fill(0).map((E,t)=>t).map(t),$q=([E,t],T)=>[E*cos(T)-t*sin(T),E*sin(T)+t*cos(T)],$XA=([E,t,T],[A,s,e])=>[E+A,t+s,T+e],$DA=([E,t,T],[A,s,e])=>[E-A,t-s,T-e],$d=(E,t=1e3)=>$HB(E*t)/t,$M=(E,t)=>E<t?E/t:1,$m=(E,t)=>max(0,$M(E,t)),$K=(E,t,T)=>t<E&&E<T,$L=(E,t)=>E instanceof t,$dA=(E,t=(E,t)=>E-t)=>E.sort(t),$IB=([E,t],T=1)=>[E*T,t*T],$0A=([E,t],T=1)=>{T/=$h([E,t])||1;return[E*T,t*T]},$h=([E,t],[T=0,A=0]=[])=>sqrt((T-E)**2+(A-t)**2),$iB=E=>(0<E?$uA:ceil)(E),$UB=E=>(E<0?$uA:ceil)(E),$jB=E=>$aA(E)*$HB(abs(E)),$XB=2*PI,$EB=$dB(128,E=>E?$XB/E:0),$o=(...E)=>Object.assign(...E),$GA=(E,t)=>E.forEach?.(t),$j=(E,t)=>E.map(t),$MC=(E,t)=>E.y-t.y||E.z-t.z||E.x-t.x,$c=E=>1+2.70158*(E-1)**3+1.70158*(E-1)**2,$9=E=>E*E*(2.70158*E-1.70158),$a=E=>1-cos(E*PI/2),$HA=E=>-(cos(PI*E)-1)/2,$sA=E=>sin(E*PI),$JA=E=>sin(E*$XB),$7=2.5949095,$8=$XB/4.5,$CC=()=>min(500/$6,.05),$AC=E=>{let t=max(0,sin(E*$XB)),T=$CC();return T<E&&E<=2*T?t+=2*$c((E-T)/T):2*T<E&&E<.5?t+=2:.5<=E&&E<.5+T&&(t+=2-2*$9((E-.5)/T)),t/3},$pB=E=>2*$HA($M(E,.5))-1,_WALK=E=>[(min(2*E,0)-(1-cos(E*$XB)))/2,-$a(-min(sin(E*$XB),0))/2],$jA=E=>_WALK(E),$FB=(E=0)=>{let A=0|E;return let=fn=()=>{var E=(A=A+2654435769|0)^A>>>16,E=imul(E,569420461);return E^=E>>>15,(((E=imul(E,1935289751))^E>>15)>>>0)/4294967296*2},$o(fn,{$9A:E=>void 0!==E?A=0|E:A,$g:(E=1)=>$HB(fn()*E),$w:()=>1-2*fn(),$aA:()=>$UB(fn.$w()),bit:()=>$HB(fn()),bool:()=>!!$HB(fn()),$oB:E=>E.slice().sort(fn.$w),$3A:E=>E[$iB(fn()*E.length)],$e:(E,t,T,A,s,e)=>`hwb(${$HB(E+fn.$w()*t)} ${$HB(T+fn.$w()*A)}% ${$HB(s+fn.$w()*e)}%)`,$X:(E,t,T=1)=>[E+fn.$w()*T,t+fn.$w()*T],$B:(E,t)=>{var T=A;return A=0|(E??A),t(),A=T,E??T}})},$fA=new Map,$r=E=>($fA.has(E)||$fA.set(E,new Set),$fA.get(E)),$O=(E,t)=>$r(E).add(t),$l=(E,t)=>$r(E).delete(t),$IA=(E,...t)=>$GA([...$r(E)],E=>E(...t)),$1A=(t,T)=>{let A=(...E)=>{$l(t,A),T(...E)};$O(t,A)};let DJ=0;const $cA=(E=0,t=0,T=16)=>{let A=E?T/E:0;return $dA($dB(E,E=>$uA(E*A+t+T)%T))},$A=$cA(7,2,12),$QB=32/27,Q=$dB(51,E=>440*2**((E-36)/12)).filter((E,t)=>$A.includes(t%12)).slice(2),$zA=(E,t=[])=>$dA([...new Set([...E,...t])]),$NC=()=>{let T=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$dB(13,E=>{let t=rand.$3A(T);return T=T.filter(E=>E!==t),[t,.05+.15*rand(),rand.$w(),$cA(1+rand.$g(),rand.$g(15))]})]},$4B=()=>[Q[15],...rand.$oB(Q.slice(16))].slice(0,8),$Y=(E,t,T,A,s,e,i=6)=>{const n=E.createOscillator();var R=E.createGain(),E=E.createStereoPanner();n.frequency.setValueAtTime(A/$QB,e),$GA($cA(i,2),(E,t)=>n.frequency.exponentialRampToValueAtTime(t%2?T*$QB:T/$QB,e+t/8)),R.gain.setValueAtTime(.1*A,e),R.gain.exponentialRampToValueAtTime(.5*A,e),R.gain.exponentialRampToValueAtTime(A,e+.325),R.gain.exponentialRampToValueAtTime(.01,e+2),E.pan.setValueAtTime(s,e),E.pan.exponentialRampToValueAtTime(-s,e+2),n.connect(R),R.connect(E),E.connect(t),n.start(e),n.stop(e+2)},$v=(E,t,T,A,s,e,i,n)=>{var R=E.createOscillator(),r=E.createGain(),h=E.createStereoPanner(),E=E.createDynamicsCompressor(),i=$d(i||A);R.frequency.setValueAtTime(T,e),R.frequency.exponentialRampToValueAtTime(T/1.5,e+.5),r.gain.setValueAtTime(.01,e),r.gain.exponentialRampToValueAtTime(i,e+1/32),r.gain.exponentialRampToValueAtTime(i/5,e+1/16),r.gain.linearRampToValueAtTime(0,e+.5),h.pan.setValueAtTime(n??s,e),E.threshold.setValueAtTime(-50,e),E.knee.setValueAtTime(40,e),E.ratio.setValueAtTime(12,e),E.attack.setValueAtTime(0,e),E.release.setValueAtTime(.25,e),R.connect(r),r.connect(h),h.connect(E),E.connect(t),R.start(e),R.stop(e+.51)},$aB=(E,t,T,A=0,s)=>{var e=.04+.03*rand(),i=1/8+rand()/16,n=E.createOscillator(),R=E.createGain(),E=E.createStereoPanner();n.type="triangle",n.frequency.setValueAtTime(T,s),R.gain.setValueAtTime(e,s),R.gain.exponentialRampToValueAtTime(e/2,s+1/32),R.gain.linearRampToValueAtTime(0,s+i),E.pan.setValueAtTime(A,s),n.connect(R),R.connect(E),E.connect(t),n.start(s),n.stop(s+i)},$KB=()=>{const e=new AudioContext,i=e.createAnalyser(),E=(i.connect(e.destination),i.fftSize=256,i.frequencyBinCount),t=new Uint8Array(E);let T=-$d(D/4e3,10)%1,n=T,A=[0],R=[],s=[],r=null,h=null;var I=(E=$NC(),t=$4B())=>{r=E,h=t};return setInterval(()=>{e.currentTime+.25<n||n<0||(r&&(R=r,r=null),h&&(s=h,h=null),$Y(e,i,(s[7-(beat+measure%8)%8]||2*Q[rand.$g(6)])/2,.2,.5*rand.$w(),n,$uA(n-T)%3+4),$GA(A,E=>{const[t,T,A,s]=R[E];$GA(s,E=>$v(e,i,t,$d(T),A,.25*E+n))}),n+=4)},100),$O("$aB",(E=0)=>{$aB(e,i,(s[beat]||Q[15])/2,"number"==typeof E?E:0,e.currentTime)}),$O("beat",()=>{var[,E,t,,]=R[0];$v(e,i,Q[14],E,t,e.currentTime)}),$O("$Y",()=>$Y(e,i,2*(s[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$w(),e.currentTime,6)),$O("pause",()=>{"running"===e.state&&$5B?e.suspend():"suspended"!==e.state||$5B||e.resume()}),I(),{$vA:I,n:n,get track(){return R},get voices(){return A},get melody(){return s},get $AA(){return i.getByteFrequencyData(t),Array.from(t).slice(0,E/2)},$bA:(E=[],t)=>{A=$zA([0,...E]),s=t||s}}},$2A=($cB=({$SB:E=min(1920,window.innerWidth),$1B:t=min(1080,window.innerHeight),os:A=!1}={})=>{let s=A?null:document.createElement("canvas"),e=(s&&(s.width=E,s.height=t),A?new OffscreenCanvas(E,t):s.transferControlToOffscreen()),n=e.getContext("2d");e.width=E,e.height=t;const R={get $T(){return e.width},get $U(){return e.width/2},get $V(){return e.width/3},get $H(){return e.height},$I:e.height/2,get $J(){return e.height/3},get $P(){return min(R.$J,R.$V)},get Rm(){return min(R.$H,R.$T)},get $Q(){return max(R.$H,R.$T)},$5:e,$7A:s,ctx:n,$bB:(E,t)=>{var T;A||(T=document.createElement("canvas"),s.replaceWith(T),(s=T).width=E,T.height=t,e=s.transferControlToOffscreen(),n=e.getContext("2d"),$o(R,{$5:e,ctx:n,$7A:s})),e.width=E,e.height=t,R.$I=e.height/2},$B:E=>(n.save(),E(R),n.restore(),R),E:()=>(n.clearRect(0,0,R.$T,R.$H),R),center:()=>(R.T(R.$U,R.$I),R),$D:(E="none")=>(n.filter=E,R),T:(E,t)=>(n.translate(E,t),R),R:(E,t)=>(n.rotate(E,t),R),$R:(...E)=>(n.roundRect(...E),R),M:(...E)=>(n.moveTo(...E),R),L:(...E)=>(n.lineTo(...E),R),A:(E=0,t=0,T=1,A=0,s=$EB[1],e=!1)=>(n.arc(E,t,T,A,s,e),R),B:(...E)=>(n.bezierCurveTo(...E),R),P:E=>(n.beginPath(),E?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(E=>{var[E,...t]=E.includes("(")?[E[0],E.slice(1).trim()]:E.split(" ");R[E](...$j(t,E=>"#"===E[0]||E.includes("(")?E:parseFloat(E,10)))}),R),C:()=>(n.closePath(),R),O:E=>(n.globalAlpha=E,R),S:(E=1,t=1)=>(n.scale(E,t),R),$G:(T,A)=>$GA(A,(E,t)=>T.addColorStop(t/A.length,E)),$E:(E,t,T,A,s)=>{E=n.createLinearGradient(E,t,T,A);return R.$G(E,s),E},$F:(E,t,T,A,s,e,i)=>{E=n.createRadialGradient(E,t,T,A,s,e);return R.$G(E,i),E},F:E=>(n.fillStyle=E,n.fill(),R),$C:(E,t)=>(n.fillStyle=E,n.fill(t),R),W:(E,t)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(),R),$W:(E,t,T)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(T),R),$f:(...E)=>(n.drawImage(...E),R)};return R.E(),R.$EA=E=>E.$EA(R),R},()=>{const i=new Path2D;return i.M=(...E)=>(i.moveTo(...E),i),i.L=(...E)=>(i.lineTo(...E),i),i.A=(E=0,t=0,T=1,A=0,s=$EB[1],e=!1)=>(i.arc(E,t,T,A,s,e),i),i.$=(...E)=>(i.arcTo(...E),i),i.B=(...E)=>(i.bezierCurveTo(...E),i),i.Q=(...E)=>(i.quadraticBezierCurveTo(...E),i),i.C=()=>(i.closePath(),i),i}),$iA=(E,t)=>$cB({$SB:E,$1B:t||E,os:!0}),$s=(E=32,t="#840")=>{const T=$iA(3*E),A=E/4,s=1.4*E;return T.$B(()=>{T.E().center().P().A(0,0,E).C().F(t).P().M(-s,-A).L(s,-A).M(-s,A).L(s,A).M(-A,-s).L(-A,s).M(A,-s).L(A,s).W(t,3)}),{R:1.5*E,D:3*E,get $f(){return T.$5}}},$UA=(Array.$uB=()=>[],(a,d,m={},p="$b")=>{const dd=window[p].$uB?.()??[],o=dd.length,dv=$j(d,([,E])=>"function"==typeof E?E.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(E)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $uB=()=>[...${p}.$uB(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$uB()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$j(d,([E],t)=>`  get ${E}(){return this[${t+o}]} set ${E}(x){return this[${t+o}]=x}`).join("")+$j(Object.values(m),E=>E.toString()).join("")+"};";return eval(e)}),$PA=($UA("$b",[["x",0],["y",0],["z",0],["$1",0],["$u",[]],["$9A",null]],{$z(){return new this.constructor(...this)},$XA(E){return[this.x,this.y,this.z]=$XA(this,E),this},$q(E){return[this.x,this.y]=$q(this,E),this},$DA(E){return new $b(...$DA(this,E))},$n(){return $j([this.x,this.y,this.z],$HB)},$0A(E=1){return[this.x,this.y]=$0A([this.x,this.y],E),this},$IB(E=1){return this.$0A(this.$h()*E),this},$h(){return $h([this.x,this.y])},$5A(E){var[t,T,A]=this.$SC();return E.S(A,A),E.T(t,T),this},$SC(){var[E,t,T]=this.$DA($WB),A=t<0?4/-t*5:0;return[E*=4,t=4*T*A,A]},$nB(E=1){var[t,T,A]=this.$SC(),s=(t*=A*$p,T*=A*$p,E?2*-$p*A:0);return new $b(t+$S.$U,T+$S.$I+s,2*A*(E?$p:1))},$FC(){var[E,t,T]=this.$nB();return $2A().A(E,t,abs(T)).C()},$hB(){},$PB(){},$EA(){},$4(){},$xB(){}},"Array"),$UA("$gA",[["$t",0],["$lB",{}],["$fB",null],["$NB",null],["$eA",null],["$hB",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$JB=($UA("$Z",[["shell",null],["$MB",0],["$BB",0],["$GC",1],["$RC",1],["$C",()=>new $b],["$xA",()=>new $b],["$sB",()=>new $b(1,1,0)],["$BC",[]],["w",0],["a",0],["s",0],["d",0],["$OC",2],["$HC",[]],["$UC",1],["$rA",[]],["$yB",0],["$JC",[0,0,0]]],{$YB(){return this.$MB?abs(this.$MB):0},$qB(){var E=this.$BB%1;return E*=this.$C.$h?.()||$K(E,1/32,31/32)?1:0,(this.$GC<0?1-E:E)%1},$qA(){return this.$qB()?$M(this.$qB()%.5,.5)%1:1-bar%.5*2%1},$hB(E){E=min(1,E/1e3);let{w:t,a:T,s:A,d:s}=this;var e=$HB(this.x)+128,i=$HB(this.y)+128,n=this.$BC.filter(E=>E.$t<=$t),n=(n.length?($GA(n,E=>{var t,T,A;E.$NB=E.$NB||E.$t,E.$fB?$h(this,E.$fB)>1/16?(E.$t=$t,[T,A]=(t=$0A($DA(E.$fB,this),1)).map(abs),$o(E.$lB,t[0]<0?{a:T,d:0}:{a:0,d:T},t[1]<0?{w:A,s:0}:{w:0,s:A})):(E.$eA=E.$t,E.$lB={w:0,a:0,s:0,d:0}):(E.$t=-1,E.$eA=$t),$o(this,E.$lB)}),n.length&&({w:t,a:T,s:A,d:s}=this),this.$BC=this.$BC.filter(E=>!E.$eA||E.$eA>$t||E.$t>$t)):$o(this,{w:0,a:0,s:0,d:0}),this.$xA=new $b(s-T,A-t,0),this.$GC=$aA(this.$xA.x||this.$GC),this.$RC=$aA(this.$xA.y||this.$RC),new $b(...this.$xA)),R=new $b(...this.$C),r=this.$qA();if(0===n.$h()&&$K(R.$h(),1/16,r)&&n.$XA(new $b(...this.$sB).$0A((1-r)/2)),n.$0A(4*E),this.$xA.$h()){const A=.75+$M(n.$z().$0A(2).$XA(R.$z().$0A(1)).$h(),3)/4;R.$IB(A)}R.$XA(n),R.$0A(min(R.$h(),this.$OC));var h,n=(this.$C=R).$h(),I=new $b(...R);I.$0A(I.$h()*E);const O=$XA(this,I);this.$u.length&&!this.$u.find(E=>$h($DA(E,O))<E.$9B)&&I.$IB(-.5);let S=$HB(this.x+I.x)+128,a=$HB(this.y+I.y)+128;if(S<0||255<S||a<0||256<a)console.log("Bad end of movement",S,a,this);else if(e===S&&i===a||((h=world.$LA[a][S])&&h!==this&&(I.$IB(-.1),S=$HB(this.x+I.x)+128,a=$HB(this.y+I.y)+128),world.$LA[i][e]=null,world.$LA[a][S]=this),this.$XA(I),this.$BB+=I.$h(),this.$MB=n*this.$GC,this.$sB=n?R.$z().$0A(1):this.$sB,this.$xA.$h()<.25&&R.$h()&&R.$IB(this.$qA()<1/8?0:$m(1-2*E,1)),0===R.$h()&&this.$qB()&&r&&(R.$IB(0),this.$BB=$HB(2*this.$BB)/2),this===$7B){const A=$uA(this.$BB/.25);A>this.$yB&&$IA("$aB",this.$sB.x/-2),this.$yB=A}}},"$b"),({$CA:t=512,$rA:s=[]}={})=>{const e=$iA(t),A=t/2,i=t/12,T={R:A,$CA:t,$rA:s,$EA:(E=e)=>(E.$B(()=>{let T=5.6*i;E===e&&E.E().center(),E.P().A(0,0,A).C().F(E.$F(0,2*i,4*i,0,0,t,["#242","#262"])),e.P().A(0,0,T),$dB(28,E=>{var[E,t]=$q([1,0],$EB[28]*(E-.5)-$EB[4]);e.M(E*T,t*T).L(E*A,t*A)}),e.W(e.$F(0,2*i,3*i,0,0,t,["#3536","#4846"]),2),$dB(13,E=>{let t=0,T=(E-11)*i*2.25;var A;E<10&&(A=$EB[10]*(E+2.5),[t,T]=$q([4.5*i,0],A)),e.P().A(t,T,i).C().F("rgba(127,127,127,0.25)"),s[E]&&e.P().A(t,T,i).C().F("#aa9")})}),T),$0(E){return s[world.$rA.indexOf(E)]=1,T.$EA(),T},get $f(){return e.$5}};return T.$EA(),T}),$LC=new Map,$tA=($UA("$6B",[["$MA",null],["$pA",()=>`hwb(${$HB(30+10*rand.$w()-2)} ${$HB(0+10*rand())}% ${$HB(47+10*rand())}%)`],["$eB",()=>`hwb(${$HB(30+2*rand.$w()-2)} 0% ${$HB(67+4*rand())}%)`],["$GB",0],["$CB",[]],["$RB",[]]],{$2A(E,t,T,A,s){var e,i,n,R,r,h,[E,t,T,A,s]=[$d(E,4),$d(t,64),T,A,$d(s[0],4)],A=[E,t,T,A,s].join();return $LC.has(A)||(e=$JA(t)/8,i=E?E/8:$JA(t)/16,n=$sA(t)/8,abs(E/16),[t,R]=[E?$jA(t):[0,0],E?$jA(1-t):[0,0]],[[t,R],[r,h]]=[t,R],s=sqrt(abs(s)/(abs(E)||1)),$LC.set(A,$2A().A(0+i*s,n-3,1,$XB[4],$XB).M(0+i*s,n-2).L(2+r/3,e*T-1.5).L(1+t/16,e*T-1).L(1+t*s,R).L(0,n-1).L(-1-r*s,h).L(r/16-1,-1-e*T).L(-2-t/3,-1.5-e*T).C())),$LC.get(A)},$EA(i,n=bar%.5*2,R=!0){i.$B(()=>{R&&this.$5A(i);var E=this.$qB()%.5,E=E?$M(E%.5,.5):1-n,t=this["$MB"];let T=t?t/8:$JA(E)/16,A=$sA(E)/8,s=abs(t/16);const e=sqrt(abs(this.$C[0])/(abs(t)||1));this.shell&&0<this.$RC&&i.P().A(0-T*e/2,-1.75-A/2+s,7/8).C().W("#242",1/16).F("#131");t=this.$2A(this.$MB,E,this.$GC,this.$RC,this.$C);i.$W(this.$eB,1/8,t).$C(this.$pA,t),this.shell&&(this.$RC<0||$5B)&&i.$B(()=>{i.P().A(0-T*e/2,-1.75-A/2+s,7/8).C(),i.W("#242",1/16),i.T(0-T*e/2,-1.75-A/2+s),i.R(this.$C[0]/16),i.$f(shell.$f,-1,-1,2,2)}),$AB.$fB})},$PB(){var E,t,T;this.$MA||(this.$MA=this.$n()),this.$GB&&!this.$BC?.length&&(E=$t%576,E=$t-E,t=this.$u[0],t=$DA(t,this),T=$h(t),this.$BC=[$o(new $gA,{$t:288+E+rand.$g(16),$fB:$XA($IB(t,(T-2)/T),this)}),$o(new $gA,{$t:528+E+rand.$g(16),$fB:this.$MA}),$o(new $gA,{$t:575+E})].filter(E=>E.$t>=$t))},$4(E){return this!==E&&this.$DA(E).$h()<=4&&(!this.$GB&&!this.$CB.length||this.$CB.find(t=>$7B.$HC.find(E=>$L(E,t)))||this.$GB&&this.$RB.find(t=>$7B.$HC.find(E=>$L(E,t))))},$xB(E){var t,T;this.$GB||this.$CB.length||($IA("$Y"),this.$GB=1,t=this.$u[0],t=$DA(t,this),T=$h(t),this.$BC.push($o(new $gA,{$t:$t+1+rand.$g(8),$fB:$XA($IB(t,(T-2)/T),this)})));const A=$j(this.$CB,t=>E.$HC.find(E=>$L(E,t))).filter(E=>E);if(A.$2B){const s=this.$CB.filter(t=>A.find(E=>$L(E,t)));E.$HC=E.$HC.filter(E=>!A.includes(E)),this.$CB=this.$CB.filter(E=>!s.includes(E))}}},"$Z"),$UA("$BA",[],{$EA(e){e.$B(()=>{this.$5A(e),e.S(this.$GC,1);var E=this.$MB,[t,T]=E?$jA(this.$qA()):[0,0],[A,s]=E?$jA(1-this.$qA()):[0,0],[[A,s],[t,T]]=0<this.$GC?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$C[0])/(abs(E)||1));e.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),e.P().M(1,s/4-3).L(2,s/4-2).L(1,s/4-2).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-2).L(.5,s/4-2.5).L(0,s/4-3).C().W("#620",1/8).F("#840"),e.P().A(1,s/4-4,1,$EB[2],1,!0).W("#620",.125)})}},"$Z"),$UA("$nA",[],{$EA(e,E,t,T){e.$B(()=>{this.$5A(e),e.S(this.$GC,1);var E=this.$MB,[t,T]=E?$jA(this.$qA()):[0,0],[A,s]=E?$jA(1-this.$qA()):[0,0],[[A,s],[t,T]]=0<this.$GC?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$C[0])/(abs(E)||1));e.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),e.P().M(2,s/4-2).L(2,s/4-1).L(1.5,s/4-.5).L(1,s/4-1).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-3).L(1,s/4-2.25).L(1.5,s/4-2.5).C().stroke("#620",1/8).F("#840"),e.P().A(2,s/4-2.25,.75,$EB[2],$EB[2]+$EB[7]).stroke("#620",.125)})}},"$Z"),$UA("$WA",[["$DB",0],["$9B",32],["$pA","#ccf"],["$eB","#ccf4"]],{$EA(i){i.$B(()=>{var E,t,{$DB:T,$9B:A}=this,s=A-1,e=1.3*A;T&&(E=$iB(cos($EB[28]*T)*e),t=T<14?E:-e,T=14<T?-E:e,i.P().M(0,s).B(T,A,T,-A,0,-s).B(t,-A,t,A,0,s).C().F(this.$pA)),i.P().A(0,0,s).C().W(this.$eB,A/16)})},$yA(){return abs(sin($EB[2]*this.$DB/28))}},"$b"),$UA("$u",[["$pA",()=>`hwb(${120+rand.$g(25)} ${10+rand.$g(5)}% ${$HB(65+rand.$g(5))}%)`],["$9B",16],["$8B",[]],["$vB",[]],["$IC",[]],["$NC",null],["$4B",null]],{$wB(t=16){this.$9B=t;rand();return this.$8B=$dB(16,E=>new $b(0,-t,0).$q($EB[16]*(E+rand()/4))),this},$hB(t){$GA(this.$IC,E=>E.$hB(t))}},"$b"),$UA("$lA",[["$S",null]],{$EA(E){return this.$S||(this.$S=$cB({$SB:64,$1B:64}).P().M(...rand.$X(1,28)).L(...rand.$X(24,24)).L(...rand.$X(21,12)).L(...rand.$X(31,11)).L(...rand.$X(33,23)).L(...rand.$X(47,14)).L(...rand.$X(53,21)).L(...rand.$X(61,31)).L(...rand.$X(52,44)).L(...rand.$X(42,47)).L(...rand.$X(43,43)).L(...rand.$X(39,48)).L(...rand.$X(16,57)).L(...rand.$X(9,54)).L(...rand.$X(3,42)).C().F(rand.$e(15,2,17,2,68,4))),E.$f(this.$S.$5,0,0,64,64),E}},"$b"),$UA("$4A",[["$2A",""],["$S",null],["$SB",0],["$1B",0],["$ZA",0],["$pA",()=>rand.$e(150,2,10,6,80,4)]],{$wB(E){return this.$9A=rand.$B(this.$9A,()=>{const e=min(8,this.$1=E||this.$1||4*rand()+3),i=ceil(e);let n=0,R=0,r=0;this.$2A=$dB(i,E=>{var t=(e-E)/(e-E+3),T=n-t/.125,A=t*(i-E),s=n+t+.5,E=$M(e-E,i),t=$d(rand.$w()*E*t/2),A=(R=max(A,R),`M ${t} ${$d(T)} L ${$d(-A)} ${$d(s)-rand()*E} L ${$d(r)} ${$d(n+.25)} L ${$d(A)} ${$d(s)-rand()*E} L ${t} `+$d(T));return r=t,n=T,A}).join(" ")+(" F "+this.$pA),this.$SB=ceil(2*R),this.$1B=ceil(abs(n)),this.$S=$cB({$SB:this.$SB*$p*4,$1B:this.$1B*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$SB/2,this.$1B).P(this.$2A))}),this},$EA(E){if(this.$S)return E.$B(()=>{this.$5A(E),E.$f(this.$S.$5,-this.$SB/2,-this.$1B,4*this.$SB,4*this.$1B)}),this},$hB(E){this.$ZA=this.$ZA||4+rand.$g(284),$t>=this.$ZA&&(this.$wB(this.$1+(rand()+1)/8),this.$ZA=$t+576)},$4(E){return 2<this.$1&&this.$DA(E).$h()<=4},$xB(E){E.$HC.push(new $lA),this.$wB(--this.$1),$IA("beat")}},"$b"),$UA("$0B",[["$S",null],["$DB",0],["$pA",()=>rand.$e(180,4,33,3,55,4)],["$RA",-1],["$SB",4],["$1B",4],["$oA",0]],{$wB(){const T=this.$oA,A=(this.$S=this.$S??$iA(this.$SB*$p*4,this.$1B*$p*4),rand.$w()/4);var E=T?-2:-1.5;const s=rand()/8,e=E+s;return this.$S.$B(E=>{var t;E.E().S($p,$p).T(this.$SB/2,this.$1B).P().M(-1.5-A,0).B(-2.5,-3,-1,-3,A,s-2).B(1,-3,2.5,-3,1.5+A,0).C().F(this.$pA).P().M(0,0).B(2*-A,-s,4*A,e,A,e).W("#0002",1/8),E.P().A(A,e,T?.75:1/8).F(`hwb(${$HB((180/28*this.$DB+240+rand.$w()/4)%360)} ${$HB(10+25*rand())}% 5%)`),this.$oA&&(t=$o(new $WA,{$9B:10,$DB:this.$DB,$pA:"#ccf",$eB:"#000a"}),E.O(.5).T(1.25*A,e).S(1/16,1/16),t.$EA(E))}),this},$EA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$5A(E),E.$f(this.$S.$5,-this.$SB/2,-this.$1B,4*this.$SB,4*this.$1B)}),E},$hB(E,t,T){t=t??moon?.$DB,T=T??$NA;return t!==this.$RA&&.5<=T&&!this.$oA&&(this.$RA=t,this.$oA=+((moon?.$DB??-1)===this.$DB),this.$wB()),this},$4(E){return this.$oA&&this.$DA(E).$h()<=2},$xB(E){var t=$o(this.$z(),{$S:null});E.$HC.push(t.$wB()),this.$oA=0,this.$wB(),$IA("$Y")}},"$b"),$UA("$wA",[["$2A",""],["$S",null],["$SB",0],["$1B",0],["$ZA",0],["$pA",()=>rand.$e(120,2,20,2,67,2)]],{$wB(t){return this.$9A=rand.$B(this.$9A,()=>{const T=min(4,this.$1=t||this.$1||3*rand()+1);var E=ceil(T);const A=6*E+1;this.$2A="M 2 0 "+$dB(A,E=>{var t=(E+.5)/A*PI,E=E%2;return`L ${$d(2*cos(t)+(E?rand.$w()/2:0))} `+(E?$d(sin(t)*-T*2+rand.$w()/2):-.5)}).join(" ")+" L -2 0 C F "+this.$pA,this.$SB=4,this.$1B=2*E,this.$S=$cB({$SB:this.$SB*$p*4,$1B:this.$1B*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$SB/2,this.$1B).P(this.$2A))}),this},$EA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$5A(E),E.$f(this.$S.$5,-this.$SB/2,-this.$1B,4*this.$SB,4*this.$1B)}),this},$hB(E){this.$ZA=this.$ZA||4+rand.$g(284),$t>=this.$ZA&&this.$1<4&&(this.$wB(this.$1+(rand()+1)/8),this.$ZA=$t+576)},$4(E){return 2<this.$1&&this.$DA(E).$h()<=4},$xB(E){E.$HC.push($o((new $wA).$wB(1),{$1:1})),this.$wB(--this.$1),$IA("beat")}},"$b"),$UA("$VB",[["$S",null]],{$EA(E){}},"$b"),$UA("$A",[["$S",null]],{$EA(E){}},"$b"),$UA("$OB",[["$S",null]],{$EA(E){return this.$S||(this.$S=$cB({$SB:64,$1B:64}).P().M(...rand.$X(2,58)).L(...rand.$X(4,61)).L(...rand.$X(61,9)).L(...rand.$X(58,6)).C().F(rand.$e(15,2,17,2,68,4)).P().M(...rand.$X(7,4)).L(...rand.$X(7,8)).L(...rand.$X(58,61)).L(...rand.$X(61,58)).L(...rand.$X(18,18)).L(...rand.$X(20,12)).L(...rand.$X(18,10)).L(...rand.$X(16,16)).C().F(rand.$e(15,2,17,2,68,4))),E.$f(this.$S.$5,0,0,64,64),E}},"$b"),$UA("$y",[["$2A",""],["$S",null],["$SB",0],["$1B",0],["$ZA",0],["$pA",()=>rand.$e(105,2,12,2,65,2)]],{$wB(A){return this.$9A=rand.$B(this.$9A,()=>{const t=min(4,this.$1=A||this.$1||3*rand()+1);var E=ceil(t);const T=2*E+1;this.$2A="M 2 0 "+$dB(T,E=>{E=(E+.5)/T*PI;return`L ${$d(2.75*cos(E)+rand.$w()/2)} `+$d(sin(E)*-t+rand.$w()/4)}).join(" ")+` L -2 0 C F ${this.$pA} W #1324 0.125`,this.$SB=6,this.$1B=2*E,this.$S=$cB({$SB:this.$SB*$p*4,$1B:this.$1B*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$SB/2,this.$1B).P(this.$2A))}),this},$EA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$5A(E),E.$f(this.$S.$5,-this.$SB/2,-this.$1B,4*this.$SB,4*this.$1B)}),this},$hB(E){this.$ZA=this.$ZA||4+rand.$g(284),$t>=this.$ZA&&this.$1<4&&(this.$wB(this.$1+(rand()+1)/8),this.$ZA=$t+576)},$4(E){return 2<this.$1&&this.$DA(E).$h()<=4},$xB(E){E.$HC.push(new $OB),this.$wB(--this.$1),$IA("beat")}},"$b"),$UA("$zB",[["$S",null]],{$EA(E){}},"$b"),$UA("$mB",[["$S",null]],{$EA(E){}},"$b"),$UA("$2",[["$S",null]],{$EA(E){}},"$b"),$UA("$gB",[["$S",null]],{$EA(E){}},"$b"),$UA("$LB",[["$S",null]],{$EA(E){}},"$b"),$UA("$TC",[["$S",null]],{$EA(E){}},"$b"),$UA("$x",[["$S",null]],{$EA(E){}},"$b"),$UA("$FA",[["$OA",null],["$N",[]],["$B",()=>{}]],{},"$b"),new Map),$S=($UA("$KA",[["$i",()=>new $lA],["O",()=>rand()],["$FA",null]],{$EA(s,E){s.$B(()=>{this.$5A(s);var E,t,T,A=$d((this.O+bar%.5*2)%1,64);s.$B(()=>s.T(-1.5,-2).S(1/32,1/32).$EA(this.$i)),s.$B(()=>s.T(1.5,-1.75).S(-1/32,1/32).$EA(this.$i)),$tA.has(A)||(E=$iA(128,256),t=$JA(A),T=$JA((A+.25)%1),E.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$EB[2]).B(-1,-2.5-T/2,0+t,-2.5-T,0-t/2,-3.5).B(0-t,-2.5-T,1,-2.5-T/2,1,-1.5).F(s.$F(0,-1.25,.5+T/8,0,0,4-T/4,["#ff0a","#e206","#d004"])),$tA.set(A,E)),s.$f($tA.get(A).$5,-1,-4,2,4)})},$4(E){return!(this.$u[0].$vB.filter(E=>$L(E,$6B)).find(E=>!E.$GB)||!this.$FA)},$xB(E){var t=this["$FA"];t&&($7B.$rA.push(t),$7B.shell.$0(t),DJ.$bA($j($7B.shell.$rA,(E,t)=>E?t+1:null).filter(E=>E)),this.$FA=0,$IA("$Y"),$IA("$v"))}},"$b"),$UA("$TB",[["$9A",13],["$1",0],["$rA",[]],["$B",[]],["$DC",[]],["$ZB",[]],["$LA",()=>$dB(256,E=>$dB(256,E=>null))],["$mA",[]],["$j",null],["$uA",null],["$rB",[]],["$vB",[]],["$IC",[]],["$QC",[]],["$NC",null],["$4B",null]],{$wB(E){this.$j=this.$j||$cB({$SB:256,$1B:256,os:!0}),this.$uA=this.$uA||$cB({$SB:256,$1B:256,os:!0}),this.$9A=E,rand.$9A(E);var[E,t]=rand.$oB([$VB,$mB]),[T,A]=rand.$oB([rand.$oB([$LB,$nA,$A]),rand.$oB([$2,$BA,$gB])]);this.$rA=[$6B,E,...T,$x,...A,t,...rand.$oB([$zB,$TC]),$JB],this.$NC=$NC(),this.$4B=$4B();this.$B=$dB(28,E=>(new $u).$wB(12).$XA([96,0,0]).$q(E*$EB[28]-$EB[4])),this.$DC=$dB(13,E=>{E=E<10?(new $u).$wB(18).$XA([80,0,0]).$q($EB[10]*(E+2.5)):(new $u).$wB(18).$XA([0,16*(E-11)*2.5,0]);return E.$NC=$NC(),E.$4B=$4B(),E}),this.$mA=[...this.$B,...this.$DC],$GA(this.$B,(T,E)=>{T.$YA="moon "+E,$GA(T.$8B,t=>{var E;this.$mA.filter(E=>t.$z().$XA(T).$DA(E).$h()<=E.$9B+.05).length<2&&((E=(new $4A).$wB().$XA(T).$XA(t)).$u.push(T),T.$IC.push(E),this.$IC.push(E))});E=$o(new $0B,{x:T.x,y:T.y,$DB:E}).$hB(0,0,.5);T.$IC.push(E),this.$IC.push(E)}),$GA(this.$DC,(T,E)=>{var t=(new $KA).$XA(T);t.$FA=this.$rA[E],T.$vB.push(t),t.$u.push(T),$dB(32,E=>{const t=new $b(0,-T.$9B,0).$q($EB[32]*(E+rand.$w()/4));this.$mA.filter(E=>t.$z().$XA(T).$DA(E).$h()<=E.$9B+.05).length<2&&((E=(new(rand.bit()?$wA:$y)).$wB().$XA(T).$XA(t)).$u.push(T),T.$IC.push(E),this.$IC.push(E))}),$dB(3,E=>{E=(new $6B).$XA(new $b(0,10+rand.$g(2),0).$q($EB[3]*(E+rand.$w()/8)).$XA(T));T.$vB.push(E),E.$u.push(T)})}),this.$vB.push(...$j(this.$mA,E=>E.$vB).flat().sort($MC)),this.$j.$B(A=>{A.E().center(),$GA(this.$mA,T=>{A.P(),$GA(T.$8B,(E,t)=>(t?A.L:A.M)(E[0]+T.x,E[1]+T.y)),A.C().F(A.$F(0,90,90,0,0,256,["#242","#262"])).O(.25).W(A.$F(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this.$uA.P().A(128,128,108).W("#202",16).C().P().A(128,102,40).F(this.$uA.$F(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])),this.$uA.$f(this.$j.$5,0,0,256,256);const s=$o(new $WA,{$9B:10});return $GA(this.$B,(t,E)=>{$o(s,{$DB:E}),this.$uA.$B(E=>{E.T(128+t.x,128+t.y).O(.875).P().A(0,0,t.$9B).F(t.$pA).O(.125),s.$EA(E)})}),this.$uA.$B(E=>{E.center(),$GA(this.$IC.filter(E=>!(E instanceof $0B)),E=>this.$uA.P().A(E.x,E.y+.5,1.25).F(E.$pA))}),$GA([...this.$vB,...this.$IC,$7B],E=>{E.y=$jB(E.y),E.x=$jB(E.x),this.$LA[E.y+128][E.x+128]=E}),this},$8A(){},$SA(){},$hB(t){const T=this.$mA.filter(E=>$h($DA(E,$7B))<E.$9B);return(T.find(E=>!$7B.$u.includes(E))||$7B.$u.find(E=>!T.includes(E)))&&($7B.$u=T,DJ?.$vA?.((T.find(E=>E.$NC)||this).$NC,(T.find(E=>E.$4B)||this).$4B)),$GA(this.$mA,E=>E.$hB(t)),this},$EA(t){this.$QC.length=0;var T=-t.$U/$p,A=t.$T/$p;let s=1;const e=max(0,$HB($WB.y));for(let E=e;E<=min(256,$HB($WB.y+132));E+=1){s&&t.O(1-s);const e=new $b($WB.x,E-128,0).$nB(0);var i=e[2];if(0===i)break;var n=i*$p*2,R=max(0,$uA($WB.x+128-t.$U/n)-4);min(256-R,ceil(t.$T/n)+8);t.$f(this.$uA.$5,$WB.x+128-t.$U/n,E,t.$T/n,1,T,(e[1]-t.$I)/$p,A,2*i),$GA($dA(this.$LA[E].filter(E=>E),$MC),E=>{E.$EA(t),E.$4?.($7B)&&this.$QC.unshift(E)}),s&&(t.O(1),s=max(0,s-i/4))}return t.$5}},"$b"),$cB());let moon=new $WA,sun=$s(32,"#ffd"),rand=$FB(13),stars=$dB(91,()=>[rand.$w(),rand.$w()]),shell=$JB(),$7B=$o(new $6B,{x:0,y:104,z:0,shell:shell,$RC:-1,$pA:"#840",$eB:"#620"}),$AB=new $b,world=($AB.$2A=$2A().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $TB).$wB(13)),entities=[],$KC=20,$tB=-2,$PC=4,$EC=-1/8,$WB=new $b($7B.x,$7B.y+$PC,$7B.z+$EC);const $hA=t=>{$5B||(D+=t*$6A,$NA=D%$6/$6,measure=$uA(D/4e3),bar=D%4e3/4e3,beat=$uA(8*bar),$t=$uA(D/250),$RA!==$t&&$IA("tick"),$RA=$t,step=D%$3/$3,$QA.change&&$7B.$BC.unshift($o(new $gA,{$t:$t,$lB:$QA.$XA})),$QA.shift?$7B.$OC=4:$7B.$OC=2,world.$hB(t),$7B.$hB(t),$GA(world.$vB,E=>E.$PB?.()),$GA(world.$vB,E=>E.$hB?.(t))),$WB.x+=($7B.x-$WB.x)/16,$WB.y+=($7B.y+($5B?$PC:$KC)-$WB.y)/16,$WB.z+=($7B.z-$WB.z+($5B?$EC:$tB))/16};let $VA=$dB(256,E=>[E,E]).flat().map(E=>E/$p);const $TA=(E=0)=>{performance.now();var t=E-now;now=E,$hA(t*$6A);const{$H:T,$I:n,$J:A,$T:s,$U:R,$V:e,$P:r,$Q:h}=$S;E=$NA,t=E;const I=(E+.5)%1;moon.$DB=D?$uA((28+(D-$CC()*$6)/$6)%28):0;let O=$pB(t)*e;const S=$AC(t);let a=$pB(I)*e;const N=$AC(I);.5<E?O=-a:a=-O;let L;$S.$B(()=>{if($S.E(),$S.ctx.fillStyle=.1<S?"#840":"#202",$S.ctx.fillRect(0,0,s,T),$S.center(),.25<N){const i=A-N*A*2;$GA(stars,([E,t])=>{var T=E*R,A=(t-I)*n,s=$M($h([a,i],[T,A]),4*moon.$9B),e=1+.5*sin((7.3*t+now%$6/$6+1.1*E)*$XB),t=(1+e)**2*max(0,sin(7.3*t+now/$6*130+11*E)**3);$S.O(max(0,1-moon.$yA()/2-(s<.25?1:1-s))).P().A(T,A,e).F("#ffd").C(),$S.P().M(T,A-t).L(T,A+t).M(T-t,A).L(T+t,A).W("#ffd",.5)}),L=`rgba(204,204,255,${$d(.1*moon.$yA())})`,$S.O(max(0,N)).P().A(a,i,2*h).C().F($S.$F(a,i,r*moon.$yA(),a,i,2*r,[`rgba(204,204,255,${$d(.05+.2*moon.$yA())})`,L,L,"rgba(24,0,24,0)"])).T(a,i),moon.$EA($S),L="#ccf6"}.25<S&&($S.O(max(0,S)),L="#aae6",$S.P().A(O,A-S*A*2,2*h).C().F($S.$F(O,A-S*A*2,sun.R*max(S,0),O,A-S*A*2,h,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$f(sun.$f,O-sun.R,A-S*A*2-sun.R,sun.D,sun.D))}),$S.$B(()=>{$S.T(R,n),$S.S($p,$p),world.$EA($S)}),$S.$B(()=>$S.T($AB.x-2,$AB.y-2).S(4,4).R($XB*$JA(now%4e3/4e3)).$C("#2808",$AB.$2A)),$AB.$fB=$5B?null:world.$QC.find(E=>$S.ctx.isPointInPath(E.$FC(),$AB.x,$AB.y)),$AB.$fB&&$S.$B(()=>{var E=$AB.$fB.$FC();$S.ctx.setLineDash([13,7]),$S.ctx.lineDashOffset=now/1e3*20,$S.$W("#280",1,E)});const i=$7B.$HC.length;$GA($7B.$HC,(t,E)=>{const T=($S.$T-128)/(i+1)*(E+1)+32,A=$S.$H-128;$S.$B(E=>t.$EA(E.T(T,A).P().$R(0,0,64,64,4).C().F("#fff4"),!0))}),$5B&&($S.ctx.fillStyle="#0f0",$S.ctx.font="32px monospace",$GA(["wasd + shift = move","esc = pause/resume","mouse = interact",DJ?"- paused -":"click to play"],(E,t)=>$S.ctx.fillText(E,$S.$U-$S.ctx.measureText(E).width/2,32*(t+1)))),requestAnimationFrame($TA)},$QA=($TA(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $XA(){var{w:E,a:t,s:T,d:A}=this;return{w:E,a:t,s:T,d:A}}}),$3B=($1A("mousedown",()=>$5B=!1),$O("click",()=>$AB.$fB?.$xB($7B)),$O("keydown",E=>{$IA("input");E=E.key.toLowerCase();$QA[E]=1,$IA("key-"+E),"escape"===E&&($5B=!$5B,$IA("pause"))}),$O("keyup",E=>$QA[E.key.toLowerCase()]=0),$O("mousedown",()=>$IA("input")),$O("mousemove",({clientX:E,clientY:t})=>$o($AB,{x:E,y:t})),$O("resize",()=>{$S.$bB(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$GA(["visibilitychange","blur"],E=>$O(E,()=>{$GA(Object.keys($QA),E=>$QA[E]=0)})),(E,t,T)=>E.addEventListener(t,T));$GA(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],t=>$3B(document,t,(...E)=>$IA(t,...E))),$GA(["resize","blur"],t=>$3B(window,t,(...E)=>$IA(t,...E))),$3B(document,"click",()=>DJ=DJ||$KB()),document.body.appendChild($S.$7A);})()