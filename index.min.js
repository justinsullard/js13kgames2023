(()=>{let now=0,$3=500,$6=144e3,D=0,$MA=0,$t=0,$QA=0,measure=0,beat=0,bar=0,step=0,$3B=!0,$5A=1,$p=32;const{cos,sin,min,max,sqrt,floor:$tA,ceil,round:$GB,imul,abs,PI,sign:$9A}=Math,$bB=(E=0,t=E=>E)=>new Array(E).fill(0).map((E,t)=>t).map(t),$q=([E,t],T)=>[E*cos(T)-t*sin(T),E*sin(T)+t*cos(T)],$WA=([E,t,T],[A,e,s])=>[E+A,t+e,T+s],$CA=([E,t,T],[A,e,s])=>[E-A,t-e,T-s],$d=(E,t=1e3)=>$GB(E*t)/t,$M=(E,t)=>E<t?E/t:1,$m=(E,t)=>max(0,$M(E,t)),$K=(E,t,T)=>t<E&&E<T,$L=(E,t)=>E instanceof t,$cA=(E,t=(E,t)=>E-t)=>E.sort(t),$HB=([E,t],T=1)=>[E*T,t*T],$ZA=([E,t],T=1)=>{T/=$h([E,t])||1;return[E*T,t*T]},$h=([E,t],[T=0,A=0]=[])=>sqrt((T-E)**2+(A-t)**2),$gB=E=>(0<E?$tA:ceil)(E),$SB=E=>(E<0?$tA:ceil)(E),$hB=E=>$9A(E)*$GB(abs(E)),$VB=2*PI,$DB=$bB(128,E=>E?$VB/E:0),$o=(...E)=>Object.assign(...E),$FA=(E,t)=>E.forEach?.(t),$j=(E,t)=>E.map(t),$KC=(E,t)=>E.y-t.y||E.z-t.z||E.x-t.x,$c=E=>1+2.70158*(E-1)**3+1.70158*(E-1)**2,$9=E=>E*E*(2.70158*E-1.70158),$a=E=>1-cos(E*PI/2),$GA=E=>-(cos(PI*E)-1)/2,$rA=E=>sin(E*PI),$IA=E=>sin(E*$VB),$7=2.5949095,$8=$VB/4.5,$AC=()=>min(500/$6,.05),$zB=E=>{let t=max(0,sin(E*$VB)),T=$AC();return T<E&&E<=2*T?t+=2*$c((E-T)/T):2*T<E&&E<.5?t+=2:.5<=E&&E<.5+T&&(t+=2-2*$9((E-.5)/T)),t/3},$nB=E=>2*$GA($M(E,.5))-1,_WALK=E=>[(min(2*E,0)-(1-cos(E*$VB)))/2,-$a(-min(sin(E*$VB),0))/2],$iA=E=>_WALK(E),$EB=(E=0)=>{let A=0|E;return let=fn=()=>{var E=(A=A+2654435769|0)^A>>>16,E=imul(E,569420461);return E^=E>>>15,(((E=imul(E,1935289751))^E>>15)>>>0)/4294967296*2},$o(fn,{$8A:E=>void 0!==E?A=0|E:A,$g:(E=1)=>$GB(fn()*E),$w:()=>1-2*fn(),$9A:()=>$SB(fn.$w()),bit:()=>$GB(fn()),bool:()=>!!$GB(fn()),$mB:E=>E.slice().sort(fn.$w),$2A:E=>E[$gB(fn()*E.length)],$e:(E,t,T,A,e,s)=>`hwb(${$GB(E+fn.$w()*t)} ${$GB(T+fn.$w()*A)}% ${$GB(e+fn.$w()*s)}%)`,$X:(E,t,T=1)=>[E+fn.$w()*T,t+fn.$w()*T],$B:(E,t)=>{var T=A;return A=0|(E??A),t(),A=T,E??T}})},$eA=new Map,$r=E=>($eA.has(E)||$eA.set(E,new Set),$eA.get(E)),$O=(E,t)=>$r(E).add(t),$l=(E,t)=>$r(E).delete(t),$HA=(E,...t)=>$FA([...$r(E)],E=>E(...t)),$0A=(t,T)=>{let A=(...E)=>{$l(t,A),T(...E)};$O(t,A)};let DJ=0;const $bA=(E=0,t=0,T=16)=>{let A=E?T/E:0;return $cA($bB(E,E=>$tA(E*A+t+T)%T))},$A=$bA(7,2,12),$OB=32/27,Q=$bB(51,E=>440*2**((E-36)/12)).filter((E,t)=>$A.includes(t%12)).slice(2),$yA=(E,t=[])=>$cA([...new Set([...E,...t])]),$LC=()=>{let T=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$bB(13,E=>{let t=rand.$2A(T);return T=T.filter(E=>E!==t),[t,.2*rand(),rand.$w(),$bA(1+rand.$g(),rand.$g(15))]})]},$2B=()=>[Q[15],...rand.$mB(Q.slice(16))].slice(0,8),$Y=(E,t,T,A,e,s,i=6)=>{const n=E.createOscillator();var R=E.createGain(),E=E.createStereoPanner();n.frequency.setValueAtTime(A/$OB,s),$FA($bA(i,2),(E,t)=>n.frequency.exponentialRampToValueAtTime(t%2?T*$OB:T/$OB,s+t/8)),R.gain.setValueAtTime(.1*A,s),R.gain.exponentialRampToValueAtTime(.5*A,s),R.gain.exponentialRampToValueAtTime(A,s+.325),R.gain.exponentialRampToValueAtTime(.01,s+2),E.pan.setValueAtTime(e,s),E.pan.exponentialRampToValueAtTime(-e,s+2),n.connect(R),R.connect(E),E.connect(t),n.start(s),n.stop(s+2)},$v=(E,t,T,A,e,s,i,n)=>{var R=E.createOscillator(),r=E.createGain(),O=E.createStereoPanner(),E=E.createDynamicsCompressor(),i=i||A;R.frequency.setValueAtTime(T,s),R.frequency.exponentialRampToValueAtTime(T/1.5,s+.5),r.gain.setValueAtTime(.01,s),r.gain.exponentialRampToValueAtTime(i,s+1/32),r.gain.exponentialRampToValueAtTime(i/5,s+1/16),r.gain.linearRampToValueAtTime(0,s+.5),O.pan.setValueAtTime(n??e,s),E.threshold.setValueAtTime(-50,s),E.knee.setValueAtTime(40,s),E.ratio.setValueAtTime(12,s),E.attack.setValueAtTime(0,s),E.release.setValueAtTime(.25,s),R.connect(r),r.connect(O),O.connect(E),E.connect(t),R.start(s),R.stop(s+.51)},$8B=(E,t,T,A=0,e)=>{var s=.04+.03*rand(),i=1/8+rand()/16,n=E.createOscillator(),R=E.createGain(),E=E.createStereoPanner();n.type="triangle",n.frequency.setValueAtTime(T,e),R.gain.setValueAtTime(s,e),R.gain.exponentialRampToValueAtTime(s/2,e+1/32),R.gain.linearRampToValueAtTime(0,e+i),E.pan.setValueAtTime(A,e),n.connect(R),R.connect(E),E.connect(t),n.start(e),n.stop(e+i)},$JB=()=>{const s=new AudioContext,i=s.createAnalyser(),E=(i.connect(s.destination),i.fftSize=256,i.frequencyBinCount),t=new Uint8Array(E);let T=-$d(D/4e3,10)%1,n=T,A=[0],R=[],e=[],r=null,O=null;var h=(E=$LC(),t=$2B())=>{r=E,O=t};return setInterval(()=>{s.currentTime+.25<n||n<0||(r&&(R=r,r=null),O&&(e=O,O=null),$Y(s,i,(e[7-(beat+measure%8)%8]||2*Q[rand.$g(6)])/2,.2,.5*rand.$w(),n,$tA(n-T)%3+4),$FA(A,E=>{const[t,T,A,e]=R[E];$FA(e,E=>$v(s,i,t,$d(T),A,.25*E+n))}),n+=4)},100),$O("$8B",(E=0)=>{$8B(s,i,(e[beat]||Q[15])/2,"number"==typeof E?E:0,s.currentTime)}),$O("beat",()=>{var[,E,t,,]=R[0];$v(s,i,Q[14],E,t,s.currentTime)}),$O("$Y",()=>$Y(s,i,2*(e[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$w(),s.currentTime,6)),$O("pause",()=>{"running"===s.state&&$3B?s.suspend():"suspended"!==s.state||$3B||s.resume()}),h(),{$uA:h,n:n,get track(){return R},get voices(){return A},get melody(){return e},get $A(){return i.getByteFrequencyData(t),Array.from(t).slice(0,E/2)},$aA:(E=[],t)=>{A=$yA([0,...E]),e=t||e}}},$1A=($aB=({$QB:E=min(1920,window.innerWidth),$ZB:t=min(1080,window.innerHeight),os:A=!1}={})=>{let e=A?null:document.createElement("canvas"),s=(e&&(e.width=E,e.height=t),A?new OffscreenCanvas(E,t):e.transferControlToOffscreen()),n=s.getContext("2d");s.width=E,s.height=t;const R={get $T(){return s.width},get $U(){return s.width/2},get $V(){return s.width/3},get $H(){return s.height},$I:s.height/2,get $J(){return s.height/3},get $P(){return min(R.$J,R.$V)},get Rm(){return min(R.$H,R.$T)},get $Q(){return max(R.$H,R.$T)},$5:s,$6A:e,ctx:n,$9B:(E,t)=>{var T;A||(T=document.createElement("canvas"),e.replaceWith(T),(e=T).width=E,T.height=t,s=e.transferControlToOffscreen(),n=s.getContext("2d"),$o(R,{$5:s,ctx:n,$6A:e})),s.width=E,s.height=t,R.$I=s.height/2},$B:E=>(n.save(),E(R),n.restore(),R),E:()=>(n.clearRect(0,0,R.$T,R.$H),R),center:()=>(R.T(R.$U,R.$I),R),$D:(E="none")=>(n.filter=E,R),T:(E,t)=>(n.translate(E,t),R),R:(E,t)=>(n.rotate(E,t),R),$R:(...E)=>(n.roundRect(...E),R),M:(...E)=>(n.moveTo(...E),R),L:(...E)=>(n.lineTo(...E),R),A:(E=0,t=0,T=1,A=0,e=$DB[1],s=!1)=>(n.arc(E,t,T,A,e,s),R),B:(...E)=>(n.bezierCurveTo(...E),R),P:E=>(n.beginPath(),E?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(E=>{var[E,...t]=E.includes("(")?[E[0],E.slice(1).trim()]:E.split(" ");R[E](...$j(t,E=>"#"===E[0]||E.includes("(")?E:parseFloat(E,10)))}),R),C:()=>(n.closePath(),R),O:E=>(n.globalAlpha=E,R),S:(E=1,t=1)=>(n.scale(E,t),R),$G:(T,A)=>$FA(A,(E,t)=>T.addColorStop(t/A.length,E)),$E:(E,t,T,A,e)=>{E=n.createLinearGradient(E,t,T,A);return R.$G(E,e),E},$F:(E,t,T,A,e,s,i)=>{E=n.createRadialGradient(E,t,T,A,e,s);return R.$G(E,i),E},F:E=>(n.fillStyle=E,n.fill(),R),$C:(E,t)=>(n.fillStyle=E,n.fill(t),R),W:(E,t)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(),R),$W:(E,t,T)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(T),R),$f:(...E)=>(n.drawImage(...E),R)};return R.E(),R.$DA=E=>E.$DA(R),R},()=>{const i=new Path2D;return i.M=(...E)=>(i.moveTo(...E),i),i.L=(...E)=>(i.lineTo(...E),i),i.A=(E=0,t=0,T=1,A=0,e=$DB[1],s=!1)=>(i.arc(E,t,T,A,e,s),i),i.$=(...E)=>(i.arcTo(...E),i),i.B=(...E)=>(i.bezierCurveTo(...E),i),i.Q=(...E)=>(i.quadraticBezierCurveTo(...E),i),i.C=()=>(i.closePath(),i),i}),$hA=(E,t)=>$aB({$QB:E,$ZB:t||E,os:!0}),$s=(E=32,t="#840")=>{const T=$hA(3*E),A=E/4,e=1.4*E;return T.$B(()=>{T.E().center().P().A(0,0,E).C().F(t).P().M(-e,-A).L(e,-A).M(-e,A).L(e,A).M(-A,-e).L(-A,e).M(A,-e).L(A,e).W(t,3)}),{R:1.5*E,D:3*E,get $f(){return T.$5}}},$TA=(Array.$sB=()=>[],(a,d,m={},p="$b")=>{const dd=window[p].$sB?.()??[],o=dd.length,dv=$j(d,([,E])=>"function"==typeof E?E.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(E)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $sB=()=>[...${p}.$sB(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$sB()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$j(d,([E],t)=>`  get ${E}(){return this[${t+o}]} set ${E}(x){return this[${t+o}]=x}`).join("")+$j(Object.values(m),E=>E.toString()).join("")+"};";return eval(e)}),$OA=($TA("$b",[["x",0],["y",0],["z",0],["$1",0],["$u",[]],["$8A",null]],{$y(){return new this.constructor(...this)},$WA(E){return[this.x,this.y,this.z]=$WA(this,E),this},$q(E){return[this.x,this.y]=$q(this,E),this},$CA(E){return new $b(...$CA(this,E))},$n(){return $j([this.x,this.y,this.z],$GB)},$ZA(E=1){return[this.x,this.y]=$ZA([this.x,this.y],E),this},$HB(E=1){return this.$ZA(this.$h()*E),this},$h(){return $h([this.x,this.y])},$4A(E){var[t,T,A]=this.$QC();return E.S(A,A),E.T(t,T),this},$QC(){var[E,t,T]=this.$CA($UB),A=t<0?4/-t*5:0;return[E*=4,t=4*T*A,A]},$lB(E=1){var[t,T,A]=this.$QC(),e=(t*=A*$p,T*=A*$p,E?2*-$p*A:0);return new $b(t+$S.$U,T+$S.$I+e,2*A*(E?$p:1))},$DC(){var[E,t,T]=this.$lB();return $1A().A(E,t,abs(T)).C()},$fB(){},$NB(){},$DA(){},$4(){},$vB(){}},"Array"),$TA("$EA",[["$NA",null],["$N",[]],["$B",()=>{}]]),$TA("$fA",[["$t",0],["$iB",{}],["$dB",null],["$MB",null],["$dA",null],["$fB",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$IB=($TA("$Z",[["shell",null],["$LB",0],["$AB",0],["$EC",1],["$PC",1],["$yB",()=>new $b],["$wA",()=>new $b],["$qB",()=>new $b(1,1,0)],["$C",[]],["w",0],["a",0],["s",0],["d",0],["$MC",2],["$FC",[]],["$qA",[]],["$wB",0],["$HC",[0,0,0]]],{$WB(){return this.$LB?abs(this.$LB):0},$oB(){var E=this.$AB%1;return E*=this.$yB.$h?.()||$K(E,1/32,31/32)?1:0,(this.$EC<0?1-E:E)%1},$pA(){return this.$oB()?$M(this.$oB()%.5,.5)%1:1-bar%.5*2%1},$fB(E){E=min(1,E/1e3);let{w:t,a:T,s:A,d:e}=this;var s=$GB(this.x)+128,i=$GB(this.y)+128,n=this.$C.filter(E=>E.$t<=$t),n=(n.length?($FA(n,E=>{var t,T,A;E.$MB=E.$MB||E.$t,E.$dB?$h(this,E.$dB)>1/16?(E.$t=$t,[T,A]=(t=$ZA($CA(E.$dB,this),1)).map(abs),$o(E.$iB,t[0]<0?{a:T,d:0}:{a:0,d:T},t[1]<0?{w:A,s:0}:{w:0,s:A})):(E.$dA=E.$t,E.$iB={w:0,a:0,s:0,d:0}):(E.$t=-1,E.$dA=$t),$o(this,E.$iB)}),n.length&&({w:t,a:T,s:A,d:e}=this),this.$C=this.$C.filter(E=>!E.$dA||E.$dA>$t||E.$t>$t)):$o(this,{w:0,a:0,s:0,d:0}),this.$wA=new $b(e-T,A-t,0),this.$EC=$9A(this.$wA.x||this.$EC),this.$PC=$9A(this.$wA.y||this.$PC),new $b(...this.$wA)),R=new $b(...this.$yB),r=this.$pA();if(0===n.$h()&&$K(R.$h(),1/16,r)&&n.$WA(new $b(...this.$qB).$ZA((1-r)/2)),n.$ZA(4*E),this.$wA.$h()){const A=.75+$M(n.$y().$ZA(2).$WA(R.$y().$ZA(1)).$h(),3)/4;R.$HB(A)}R.$WA(n),R.$ZA(min(R.$h(),this.$MC));var O,n=(this.$yB=R).$h(),h=new $b(...R);h.$ZA(h.$h()*E);const S=$WA(this,h);this.$u.length&&!this.$u.find(E=>$h($CA(E,S))<E.$7B)&&h.$HB(-.5);let I=$GB(this.x+h.x)+128,a=$GB(this.y+h.y)+128;if(I<0||255<I||a<0||256<a)console.log("Bad end of movement",I,a,this);else if(s===I&&i===a||((O=world.$KA[a][I])&&O!==this&&(h.$HB(-.1),I=$GB(this.x+h.x)+128,a=$GB(this.y+h.y)+128),world.$KA[i][s]=null,world.$KA[a][I]=this),this.$WA(h),this.$AB+=h.$h(),this.$LB=n*this.$EC,this.$qB=n?R.$y().$ZA(1):this.$qB,this.$wA.$h()<.25&&R.$h()&&R.$HB(this.$pA()<1/8?0:$m(1-2*E,1)),0===R.$h()&&this.$oB()&&r&&(R.$HB(0),this.$AB=$GB(2*this.$AB)/2),this===$5B){const A=$tA(this.$AB/.25);A>this.$wB&&$HA("$8B",this.$qB.x/-2),this.$wB=A}}},"$b"),({$BA:t=512,$qA:e=[]}={})=>{const s=$hA(t),A=t/2,i=t/12,T={R:A,$BA:t,$qA:e,$DA:(E=s)=>(E.$B(()=>{let T=5.6*i;E===s&&E.E().center(),E.P().A(0,0,A).C().F(E.$F(0,2*i,4*i,0,0,t,["#242","#262"])),s.P().A(0,0,T),$bB(28,E=>{var[E,t]=$q([1,0],$DB[28]*(E-.5)-$DB[4]);s.M(E*T,t*T).L(E*A,t*A)}),s.W(s.$F(0,2*i,3*i,0,0,t,["#3536","#4846"]),2),$bB(13,E=>{let t=0,T=(E-11)*i*2.25;var A;E<10&&(A=$DB[10]*(E+2.5),[t,T]=$q([4.5*i,0],A)),s.P().A(t,T,i).C().F("rgba(127,127,127,0.25)"),e[E]&&s.P().A(t,T,i).C().F("#aa9")})}),T),$0(E){return e[world.$qA.indexOf(E)]=1,T.$DA(),T},get $f(){return s.$5}};return T.$DA(),T}),$JC=new Map,$sA=($TA("$4B",[["$LA",null],["$oA",()=>`hwb(${$GB(30+10*rand.$w()-2)} ${$GB(0+10*rand())}% ${$GB(47+10*rand())}%)`],["$cB",()=>`hwb(${$GB(30+2*rand.$w()-2)} 0% ${$GB(67+4*rand())}%)`],["$FB",0],["$BB",[]],["$PB",[]]],{$1A(E,t,T,A,e){var s,i,n,R,r,O,[E,t,T,A,e]=[$d(E,4),$d(t,64),T,A,$d(e[0],4)],A=[E,t,T,A,e].join();return $JC.has(A)||(s=$IA(t)/8,i=E?E/8:$IA(t)/16,n=$rA(t)/8,abs(E/16),[t,R]=[E?$iA(t):[0,0],E?$iA(1-t):[0,0]],[[t,R],[r,O]]=[t,R],e=sqrt(abs(e)/(abs(E)||1)),$JC.set(A,$1A().A(0+i*e,n-3,1,$VB[4],$VB).M(0+i*e,n-2).L(2+r/3,s*T-1.5).L(1+t/16,s*T-1).L(1+t*e,R).L(0,n-1).L(-1-r*e,O).L(r/16-1,-1-s*T).L(-2-t/3,-1.5-s*T).C())),$JC.get(A)},$DA(i,n=bar%.5*2,R=!0){i.$B(()=>{R&&this.$4A(i);var E=this.$oB()%.5,E=E?$M(E%.5,.5):1-n,t=this["$LB"];let T=t?t/8:$IA(E)/16,A=$rA(E)/8,e=abs(t/16);const s=sqrt(abs(this.$yB[0])/(abs(t)||1));this.shell&&0<this.$PC&&i.P().A(0-T*s/2,-1.75-A/2+e,7/8).C().W("#242",1/16).F("#131");t=this.$1A(this.$LB,E,this.$EC,this.$PC,this.$yB);i.$W(this.$cB,1/8,t).$C(this.$oA,t),this.shell&&(this.$PC<0||$3B)&&i.$B(()=>{i.P().A(0-T*s/2,-1.75-A/2+e,7/8).C(),i.W("#242",1/16),i.T(0-T*s/2,-1.75-A/2+e),i.R(this.$yB[0]/16),i.$f(shell.$f,-1,-1,2,2)}),$B.$dB})},$NB(){var E,t,T;this.$LA||(this.$LA=this.$n()),this.$FB&&!this.$C?.length&&(E=$t%576,E=$t-E,t=this.$u[0],t=$CA(t,this),T=$h(t),this.$C=[$o(new $fA,{$t:288+E+rand.$g(16),$dB:$WA($HB(t,(T-2)/T),this)}),$o(new $fA,{$t:416+E+rand.$g(16),$dB:this.$LA}),$o(new $fA,{$t:575+E})].filter(E=>E.$t>=$t))},$4(E){return this!==E&&this.$CA(E).$h()<=4&&(!this.$FB&&!this.$BB.length||this.$BB.find(t=>$5B.$FC.find(E=>$L(E,t)))||this.$FB&&this.$PB.find(t=>$5B.$FC.find(E=>$L(E,t))))},$vB(E){var t,T;this.$FB||this.$BB.length||($HA("$Y"),this.$FB=1,$t%576<400&&($t,t=this.$u[0],t=$CA(t,this),T=$h(t),this.$C.push($o(new $fA,{$t:$t+1+rand.$g(8),$dB:$WA($HB(t,(T-2)/T),this)}))));const A=$j(this.$BB,t=>E.$FC.find(E=>$L(E,t))).filter(E=>E);if(A.$0B){const e=this.$BB.filter(t=>A.find(E=>$L(E,t)));E.$FC=E.$FC.filter(E=>!A.includes(E)),this.$BB=this.$BB.filter(E=>!e.includes(E))}}},"$Z"),$TA("$AA",[],{$DA(s){s.$B(()=>{this.$4A(s),s.S(this.$EC,1);var E=this.$LB,[t,T]=E?$iA(this.$pA()):[0,0],[A,e]=E?$iA(1-this.$pA()):[0,0],[[A,e],[t,T]]=0<this.$EC?[[t,T],[A,e]]:[[A,e],[t,T]],E=sqrt(abs(this.$yB[0])/(abs(E)||1));s.P().M(1,e/4-2).L(0-t*E,0+T).L(0,e/4-1).C().M(-1,T/4-1).L(A*E-1,0+e).L(-2,T/4-1.5).C().F("#520"),s.P().M(1,e/4-3).L(2,e/4-2).L(1,e/4-2).L(1+A*E,0+e).L(0,e/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,e/4-2).L(.5,e/4-2.5).L(0,e/4-3).C().W("#620",1/8).F("#840"),s.P().A(1,e/4-4,1,$DB[2],1,!0).W("#620",.125)})}},"$Z"),$TA("$mA",[],{$DA(s,E,t,T){s.$B(()=>{this.$4A(s),s.S(this.$EC,1);var E=this.$LB,[t,T]=E?$iA(this.$pA()):[0,0],[A,e]=E?$iA(1-this.$pA()):[0,0],[[A,e],[t,T]]=0<this.$EC?[[t,T],[A,e]]:[[A,e],[t,T]],E=sqrt(abs(this.$yB[0])/(abs(E)||1));s.P().M(1,e/4-2).L(0-t*E,0+T).L(0,e/4-1).C().M(-1,T/4-1).L(A*E-1,0+e).L(-2,T/4-1.5).C().F("#520"),s.P().M(2,e/4-2).L(2,e/4-1).L(1.5,e/4-.5).L(1,e/4-1).L(1+A*E,0+e).L(0,e/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,e/4-3).L(1,e/4-2.25).L(1.5,e/4-2.5).C().stroke("#620",1/8).F("#840"),s.P().A(2,e/4-2.25,.75,$DB[2],$DB[2]+$DB[7]).stroke("#620",.125)})}},"$Z"),$TA("$VA",[["$CB",0],["$7B",32],["$oA","#ccf"],["$cB","#ccf4"]],{$DA(i){i.$B(()=>{var E,t,{$CB:T,$7B:A}=this,e=A-1,s=1.3*A;T&&(E=$gB(cos($DB[28]*T)*s),t=T<14?E:-s,T=14<T?-E:s,i.P().M(0,e).B(T,A,T,-A,0,-e).B(t,-A,t,A,0,e).C().F(this.$oA)),i.P().A(0,0,e).C().W(this.$cB,A/16)})},$xA(){return abs(sin($DB[2]*this.$CB/28))}},"$b"),$TA("$u",[["$oA",()=>`hwb(${120+rand.$g(25)} ${10+rand.$g(5)}% ${$GB(65+rand.$g(5))}%)`],["$7B",16],["$6B",[]],["$tB",[]],["$GC",[]],["$2B",null]],{$uB(t=16){this.$7B=t;rand();return this.$6B=$bB(16,E=>new $b(0,-t,0).$q($DB[16]*(E+rand()/4))),this},$fB(t){$FA(this.$GC,E=>E.$fB(t))}},"$b"),$TA("$jA",[["$S",null]],{$DA(E){return this.$S||(this.$S=$aB({$QB:64,$ZB:64}).P().M(...rand.$X(1,28)).L(...rand.$X(24,24)).L(...rand.$X(21,12)).L(...rand.$X(31,11)).L(...rand.$X(33,23)).L(...rand.$X(47,14)).L(...rand.$X(53,21)).L(...rand.$X(61,31)).L(...rand.$X(52,44)).L(...rand.$X(42,47)).L(...rand.$X(43,43)).L(...rand.$X(39,48)).L(...rand.$X(16,57)).L(...rand.$X(9,54)).L(...rand.$X(3,42)).C().F(rand.$e(15,2,17,2,68,4))),E.$f(this.$S.$5,0,0,64,64),E}},"$b"),$TA("$3A",[["$1A",""],["$S",null],["$QB",0],["$ZB",0],["$YA",0],["$oA",()=>rand.$e(150,2,10,6,80,4)]],{$uB(E){return this.$8A=rand.$B(this.$8A,()=>{const s=min(8,this.$1=E||this.$1||4*rand()+3),i=ceil(s);let n=0,R=0,r=0;this.$1A=$bB(i,E=>{var t=(s-E)/(s-E+3),T=n-t/.125,A=t*(i-E),e=n+t+.5,E=$M(s-E,i),t=$d(rand.$w()*E*t/2),A=(R=max(A,R),`M ${t} ${$d(T)} L ${$d(-A)} ${$d(e)-rand()*E} L ${$d(r)} ${$d(n+.25)} L ${$d(A)} ${$d(e)-rand()*E} L ${t} `+$d(T));return r=t,n=T,A}).join(" ")+(" F "+this.$oA),this.$QB=ceil(2*R),this.$ZB=ceil(abs(n)),this.$S=$aB({$QB:this.$QB*$p*4,$ZB:this.$ZB*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$QB/2,this.$ZB).P(this.$1A))}),this},$DA(E){if(this.$S)return E.$B(()=>{this.$4A(E),E.$f(this.$S.$5,-this.$QB/2,-this.$ZB,4*this.$QB,4*this.$ZB)}),this},$fB(E){this.$YA=this.$YA||4+rand.$g(284),$t>=this.$YA&&(this.$uB(this.$1+(rand()+1)/8),this.$YA=$t+576)},$4(E){return 2<this.$1&&this.$CA(E).$h()<=4},$vB(E){E.$FC.push(new $jA),this.$uB(--this.$1),$HA("beat")}},"$b"),$TA("$YB",[["$S",null],["$CB",0],["$oA",()=>rand.$e(180,4,33,3,55,4)],["$QA",-1],["$QB",4],["$ZB",4],["$nA",0]],{$uB(){const T=this.$nA,A=(this.$S=this.$S??$hA(this.$QB*$p*4,this.$ZB*$p*4),rand.$w()/4);var E=T?-2:-1.5;const e=rand()/8,s=E+e;return this.$S.$B(E=>{var t;E.E().S($p,$p).T(this.$QB/2,this.$ZB).P().M(-1.5-A,0).B(-2.5,-3,-1,-3,A,e-2).B(1,-3,2.5,-3,1.5+A,0).C().F(this.$oA).P().M(0,0).B(2*-A,-e,4*A,s,A,s).W("#0002",1/8),E.P().A(A,s,T?.75:1/8).F(`hwb(${$GB((180/28*this.$CB+240+rand.$w()/4)%360)} ${$GB(10+25*rand())}% 5%)`),this.$nA&&(t=$o(new $VA,{$7B:10,$CB:this.$CB,$oA:"#ccf",$cB:"#000a"}),E.O(.5).T(1.25*A,s).S(1/16,1/16),t.$DA(E))}),this},$DA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$4A(E),E.$f(this.$S.$5,-this.$QB/2,-this.$ZB,4*this.$QB,4*this.$ZB)}),E},$fB(E,t,T){t=t??moon?.$CB,T=T??$MA;return t!==this.$QA&&.5<=T&&!this.$nA&&(this.$QA=t,this.$nA=+((moon?.$CB??-1)===this.$CB),this.$uB()),this},$4(E){return this.$nA&&this.$CA(E).$h()<=2},$vB(E){var t=$o(this.$y(),{$S:null});E.$FC.push(t.$uB()),this.$nA=0,this.$uB(),$HA("$Y")}},"$b"),$TA("$TB",[["$S",null]],{$DA(E){}},"$b"),$TA("$z",[["$S",null]],{$DA(E){}},"$b"),$TA("$vA",[["$1A",""],["$S",null],["$QB",0],["$ZB",0],["$YA",0],["$oA",()=>rand.$e(120,2,20,2,67,2)]],{$uB(t){return this.$8A=rand.$B(this.$8A,()=>{var E=min(4,this.$1=t||this.$1||3*rand()+1);const T=ceil(E),A=6*T+1;$tA(A/2);this.$1A="M 2 0 "+$bB(A,E=>{var t=(E+.5)/A*PI,E=E%2;return`L ${$d(2*cos(t)+(E?rand.$w()/2:0))} `+(E?$d(sin(t)*-T*2+rand.$w()/2):-.5)}).join(" ")+" L -2 0 C F "+this.$oA,this.$QB=4,this.$ZB=2*T,this.$S=$aB({$QB:this.$QB*$p*4,$ZB:this.$ZB*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$QB/2,this.$ZB).P(this.$1A))}),this},$DA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$4A(E),E.$f(this.$S.$5,-this.$QB/2,-this.$ZB,4*this.$QB,4*this.$ZB)}),this},$fB(E){this.$YA=this.$YA||4+rand.$g(284),$t>=this.$YA&&this.$1<4&&(this.$uB(this.$1+(rand()+1)/8),this.$YA=$t+576)},$4(E){return 2<this.$1&&this.$CA(E).$h()<=4},$vB(E){E.$FC.push($o((new $vA).$uB(1),{$1:1})),this.$uB(--this.$1),$HA("beat")}},"$b"),$TA("$xB",[["$S",null]],{$DA(E){}},"$b"),$TA("$jB",[["$S",null]],{$DA(E){}},"$b"),$TA("$2",[["$S",null]],{$DA(E){}},"$b"),$TA("$eB",[["$S",null]],{$DA(E){}},"$b"),$TA("$KB",[["$S",null]],{$DA(E){}},"$b"),$TA("$RC",[["$S",null]],{$DA(E){}},"$b"),$TA("$x",[["$S",null]],{$DA(E){}},"$b"),new Map),$S=($TA("$JA",[["$i",()=>new $jA],["O",()=>rand()],["$EA",null]],{$DA(e,E){e.$B(()=>{this.$4A(e);var E,t,T,A=$d((this.O+bar%.5*2)%1,64);e.$B(()=>e.T(-1.5,-2).S(1/32,1/32).$DA(this.$i)),e.$B(()=>e.T(1.5,-1.75).S(-1/32,1/32).$DA(this.$i)),$sA.has(A)||(E=$hA(128,256),t=$IA(A),T=$IA((A+.25)%1),E.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$DB[2]).B(-1,-2.5-T/2,0+t,-2.5-T,0-t/2,-3.5).B(0-t,-2.5-T,1,-2.5-T/2,1,-1.5).F(e.$F(0,-1.25,.5+T/8,0,0,4-T/4,["#ff0a","#e206","#d004"])),$sA.set(A,E)),e.$f($sA.get(A).$5,-1,-4,2,4)})},$4(E){return!(this.$u[0].$tB.filter(E=>$L(E,$4B)).find(E=>!E.$FB)||!this.$EA)},$vB(E){var t=this["$EA"];t&&($5B.$qA.push(t),$5B.shell.$0(t),DJ.$aA($j($5B.shell.$qA,(E,t)=>E?t+1:null).filter(E=>E)),this.$EA=0,$HA("$Y"),$HA("$v"))}},"$b"),$TA("$RB",[["$8A",13],["$1",0],["$qA",[]],["$zA",[]],["$BC",[]],["$XB",[]],["$KA",()=>$bB(256,E=>$bB(256,E=>null))],["$lA",[]],["$j",null],["$tA",null],["$pB",[]],["$tB",[]],["$GC",[]],["$OC",[]],["$LC",null],["$2B",null]],{$uB(E){this.$j=this.$j||$aB({$QB:256,$ZB:256,os:!0}),this.$tA=this.$tA||$aB({$QB:256,$ZB:256,os:!0}),this.$8A=E,rand.$8A(E);var[E,t]=rand.$mB([$TB,$jB]),[T,A]=rand.$mB([rand.$mB([$KB,$mA,$z]),rand.$mB([$2,$AA,$eB])]);this.$qA=[$4B,E,...T,$x,...A,t,...rand.$mB([$xB,$RC]),$IB],this.$LC=$LC(),this.$2B=$2B();this.$zA=$bB(28,E=>(new $u).$uB(12).$WA([96,0,0]).$q(E*$DB[28]-$DB[4])),this.$BC=$bB(13,E=>E<10?(new $u).$uB(18).$WA([80,0,0]).$q($DB[10]*(E+2.5)):(new $u).$uB(18).$WA([0,16*(E-11)*2.5,0])),this.$lA=[...this.$zA,...this.$BC],$FA(this.$zA,(T,E)=>{T.$XA="moon "+E,$FA(T.$6B,t=>{var E;this.$lA.filter(E=>t.$y().$WA(T).$CA(E).$h()<=E.$7B+.05).length<2&&((E=(new $3A).$uB().$WA(T).$WA(t)).$u.push(T),T.$GC.push(E),this.$GC.push(E))});E=$o(new $YB,{x:T.x,y:T.y,$CB:E}).$fB(0,0,.5);T.$GC.push(E),this.$GC.push(E)}),$FA(this.$BC,(T,E)=>{var t=(new $JA).$WA(T);t.$EA=this.$qA[E],T.$tB.push(t),t.$u.push(T),$FA(T.$6B,t=>{var E;this.$lA.filter(E=>t.$y().$WA(T).$CA(E).$h()<=E.$7B+.05).length<2&&((E=(new $vA).$uB().$WA(T).$WA(t)).$u.push(T),T.$GC.push(E),this.$GC.push(E))}),$bB(3,E=>{E=(new $4B).$WA(new $b(0,10+rand.$g(2),0).$q($DB[3]*(E+rand.$w()/8)).$WA(T));T.$tB.push(E),E.$u.push(T)}),T.$LC=$LC(),T.$2B=$2B()}),this.$tB.push(...$j(this.$lA,E=>E.$tB).flat().sort($KC)),this.$j.$B(A=>{A.E().center(),$FA(this.$lA,T=>{A.P(),$FA(T.$6B,(E,t)=>(t?A.L:A.M)(E[0]+T.x,E[1]+T.y)),A.C().F(A.$F(0,90,90,0,0,256,["#242","#262"])).O(.25).W(A.$F(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this.$tA.P().A(128,128,108).W("#202",16).C().P().A(128,112,48).F(this.$tA.$F(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])),this.$tA.$f(this.$j.$5,0,0,256,256);const e=$o(new $VA,{$7B:10});return $FA(this.$zA,(t,E)=>{$o(e,{$CB:E}),this.$tA.$B(E=>{E.T(128+t.x,128+t.y).O(.875).P().A(0,0,t.$7B).F(t.$oA).O(.125),e.$DA(E)})}),this.$tA.$B(E=>{E.center(),$FA(this.$GC.filter(E=>!(E instanceof $YB)),E=>this.$tA.P().A(E.x,E.y+.5,1.25).F(E.$oA))}),$FA([...this.$tB,...this.$GC,$5B],E=>{E.y=$hB(E.y),E.x=$hB(E.x),this.$KA[E.y+128][E.x+128]=E}),this},$7A(){},$RA(){},$fB(t){const T=this.$lA.filter(E=>$h($CA(E,$5B))<E.$7B);return(T.find(E=>!$5B.$u.includes(E))||$5B.$u.find(E=>!T.includes(E)))&&($5B.$u=T,DJ?.$uA?.((T.find(E=>E.$LC)||this).$LC,(T.find(E=>E.$2B)||this).$2B)),$FA(this.$lA,E=>E.$fB(t)),this},$DA(t){this.$OC.length=0;var T=-t.$U/$p,A=t.$T/$p;let e=1;const s=max(0,$GB($UB.y));for(let E=s;E<=min(256,$GB($UB.y+132));E+=1){e&&t.O(1-e);const s=new $b($UB.x,E-128,0).$lB(0);var i=s[2];if(0===i)break;var n=i*$p*2,R=max(0,$tA($UB.x+128-t.$U/n)-4);min(256-R,ceil(t.$T/n)+8);t.$f(this.$tA.$5,$UB.x+128-t.$U/n,E,t.$T/n,1,T,(s[1]-t.$I)/$p,A,2*i),$FA($cA(this.$KA[E].filter(E=>E),$KC),E=>{E.$DA(t),E.$4?.($5B)&&this.$OC.unshift(E)}),e&&(t.O(1),e=max(0,e-i/4))}return t.$5}},"$b"),$aB());let moon=new $VA,sun=$s(32,"#ffd"),rand=$EB(13),stars=$bB(91,()=>[rand.$w(),rand.$w()]),shell=$IB(),$5B=$o(new $4B,{x:0,y:104,z:0,shell:shell,$PC:-1,$oA:"#840",$cB:"#620"}),$B=new $b,world=($B.$1A=$1A().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $RB).$uB(13)),entities=[],$IC=20,$rB=-2,$NC=4,$CC=-1/8,$UB=new $b($5B.x,$5B.y+$NC,$5B.z+$CC);const $gA=t=>{$3B||(D+=t*$5A,$MA=D%$6/$6,measure=$tA(D/4e3),bar=D%4e3/4e3,beat=$tA(8*bar),$t=$tA(D/250),$QA!==$t&&$HA("tick"),$QA=$t,step=D%$3/$3,$PA.change&&$5B.$C.unshift($o(new $fA,{$t:$t,$iB:$PA.$WA})),$PA.shift?$5B.$MC=4:$5B.$MC=2,world.$fB(t),$5B.$fB(t),$FA(world.$tB,E=>E.$NB?.()),$FA(world.$tB,E=>E.$fB?.(t))),$UB.x+=($5B.x-$UB.x)/16,$UB.y+=($5B.y+($3B?$NC:$IC)-$UB.y)/16,$UB.z+=($5B.z-$UB.z+($3B?$CC:$rB))/16};let $UA=$bB(256,E=>[E,E]).flat().map(E=>E/$p);const $SA=(E=0)=>{performance.now();var t=E-now;now=E,$gA(t*$5A);const{$H:T,$I:n,$J:A,$T:e,$U:R,$V:s,$P:r,$Q:O}=$S;E=$MA,t=E;const h=(E+.5)%1;moon.$CB=D?$tA((28+(D-$AC()*$6)/$6)%28):0;let S=$nB(t)*s;const I=$zB(t);let a=$nB(h)*s;const N=$zB(h);.5<E?S=-a:a=-S;let L;$S.$B(()=>{if($S.E(),$S.ctx.fillStyle=.1<I?"#840":"#202",$S.ctx.fillRect(0,0,e,T),$S.center(),.25<N){const i=A-N*A*2;$FA(stars,([E,t])=>{var T=E*R,A=(t-h)*n,e=$M($h([a,i],[T,A]),4*moon.$7B),s=1+.5*sin((7.3*t+now%$6/$6+1.1*E)*$VB),t=(1+s)**2*max(0,sin(7.3*t+now/$6*130+11*E)**3);$S.O(max(0,1-moon.$xA()/2-(e<.25?1:1-e))).P().A(T,A,s).F("#ffd").C(),$S.P().M(T,A-t).L(T,A+t).M(T-t,A).L(T+t,A).W("#ffd",.5)}),L=`rgba(204,204,255,${$d(.1*moon.$xA())})`,$S.O(max(0,N)).P().A(a,i,2*O).C().F($S.$F(a,i,r*moon.$xA(),a,i,2*r,[`rgba(204,204,255,${$d(.05+.2*moon.$xA())})`,L,L,"rgba(24,0,24,0)"])).T(a,i),moon.$DA($S),L="#ccf6"}.25<I&&($S.O(max(0,I)),L="#aae6",$S.P().A(S,A-I*A*2,2*O).C().F($S.$F(S,A-I*A*2,sun.R*max(I,0),S,A-I*A*2,O,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$f(sun.$f,S-sun.R,A-I*A*2-sun.R,sun.D,sun.D))}),$S.$B(()=>{$S.T(R,n),$S.S($p,$p),world.$DA($S)}),$S.$B(()=>$S.T($B.x-2,$B.y-2).S(4,4).R($VB*$IA(now%4e3/4e3)).$C("#2808",$B.$1A)),$B.$dB=$3B?null:world.$OC.find(E=>$S.ctx.isPointInPath(E.$DC(),$B.x,$B.y)),$B.$dB&&$S.$B(()=>{var E=$B.$dB.$DC();$S.ctx.setLineDash([13,7]),$S.ctx.lineDashOffset=now/1e3*20,$S.$W("#280",1,E)});const i=$5B.$FC.length;$FA($5B.$FC,(t,E)=>{const T=($S.$T-128)/(i+1)*(E+1)+32,A=$S.$H-128;$S.$B(E=>t.$DA(E.T(T,A).P().$R(0,0,64,64,4).C().F("#fff4"),!0))}),$3B&&($S.ctx.fillStyle="#0f0",$S.ctx.font="32px monospace",$FA(["wasd + shift = move","esc = pause/resume","mouse = interact",DJ?"- paused -":"click to play"],(E,t)=>$S.ctx.fillText(E,$S.$U-$S.ctx.measureText(E).width/2,32*(t+1)))),requestAnimationFrame($SA)},$PA=($SA(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $WA(){var{w:E,a:t,s:T,d:A}=this;return{w:E,a:t,s:T,d:A}}}),$1B=($0A("mousedown",()=>$3B=!1),$O("click",()=>$B.$dB?.$vB($5B)),$O("keydown",E=>{$HA("input");E=E.key.toLowerCase();$PA[E]=1,$HA("key-"+E),"escape"===E&&($3B=!$3B,$HA("pause"))}),$O("keyup",E=>$PA[E.key.toLowerCase()]=0),$O("mousedown",()=>$HA("input")),$O("mousemove",({clientX:E,clientY:t})=>$o($B,{x:E,y:t})),$O("resize",()=>{$S.$9B(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$FA(["visibilitychange","blur"],E=>$O(E,()=>{$FA(Object.keys($PA),E=>$PA[E]=0)})),(E,t,T)=>E.addEventListener(t,T));$FA(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],t=>$1B(document,t,(...E)=>$HA(t,...E))),$FA(["resize","blur"],t=>$1B(window,t,(...E)=>$HA(t,...E))),$1B(document,"click",()=>DJ=DJ||$JB()),document.body.appendChild($S.$6A);})()