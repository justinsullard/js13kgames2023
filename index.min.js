(()=>{let now=0,$3=500,$6=144e3,D=0,$LA=0,$t=0,$PA=0,measure=0,beat=0,bar=0,step=0,$0B=!0,$4A=1,$p=32;const{cos,sin,min,max,sqrt,floor:$rA,ceil,round:$DB,imul,abs,PI,sign:$8A}=Math,$8B=(E=0,t=E=>E)=>new Array(E).fill(0).map((E,t)=>t).map(t),$q=([E,t],e)=>[E*cos(e)-t*sin(e),E*sin(e)+t*cos(e)],$VA=([E,t,e],[T,A,i])=>[E+T,t+A,e+i],$BA=([E,t,e],[T,A,i])=>[E-T,t-A,e-i],$d=(E,t=1e3)=>$DB(E*t)/t,$M=(E,t)=>E<t?E/t:1,$m=(E,t)=>max(0,$M(E,t)),$K=(E,t,e)=>t<E&&E<e,$L=(E,t)=>E instanceof t,$aA=(E,t=(E,t)=>E-t)=>E.sort(t),$EB=([E,t],e=1)=>[E*e,t*e],$YA=([E,t],e=1)=>{e/=$h([E,t])||1;return[E*e,t*e]},$h=([E,t],[e=0,T=0]=[])=>sqrt((e-E)**2+(T-t)**2),$dB=E=>(0<E?$rA:ceil)(E),$PB=E=>(E<0?$rA:ceil)(E),$eB=E=>$8A(E)*$DB(abs(E)),$SB=2*PI,$AB=$8B(128,E=>E?$SB/E:0),$o=(...E)=>Object.assign(...E),$EA=(E,t)=>E.forEach?.(t),$j=(E,t)=>E.map(t),$HC=(E,t)=>E.y-t.y||E.z-t.z||E.x-t.x,$c=E=>1+2.70158*(E-1)**3+1.70158*(E-1)**2,$9=E=>E*E*(2.70158*E-1.70158),$a=E=>1-cos(E*PI/2),$FA=E=>-(cos(PI*E)-1)/2,$pA=E=>sin(E*PI),$HA=E=>sin(E*$SB),$7=2.5949095,$8=$SB/4.5,$yB=()=>min(500/$6,.05),$wB=E=>{let t=max(0,sin(E*$SB)),e=$yB();return e<E&&E<=2*e?t+=2*$c((E-e)/e):2*e<E&&E<.5?t+=2:.5<=E&&E<.5+e&&(t+=2-2*$9((E-.5)/e)),t/3},$jB=E=>2*$FA($M(E,.5))-1,_WALK=E=>[(min(2*E,0)-(1-cos(E*$SB)))/2,-$a(-min(sin(E*$SB),0))/2],$gA=E=>_WALK(E),$BB=(E=0)=>{let T=0|E;return let=fn=()=>{var E=(T=T+2654435769|0)^T>>>16,E=imul(E,569420461);return E^=E>>>15,(((E=imul(E,1935289751))^E>>15)>>>0)/4294967296*2},$o(fn,{$7A:E=>void 0!==E?T=0|E:T,$g:(E=1)=>$DB(fn()*E),$w:()=>1-2*fn(),$8A:()=>$PB(fn.$w()),bit:()=>$DB(fn()),bool:()=>!!$DB(fn()),$iB:E=>E.slice().sort(fn.$w),$1A:E=>E[$dB(fn()*E.length)],$e:(E,t,e,T,A,i)=>`hwb(${$DB(E+fn.$w()*t)} ${$DB(e+fn.$w()*T)}% ${$DB(A+fn.$w()*i)}%)`,$X:(E,t,e=1)=>[E+fn.$w()*e,t+fn.$w()*e],$B:(E,t)=>{var e=T;return T=0|(E??T),t(),T=e,E??e}})},$cA=new Map,$r=E=>($cA.has(E)||$cA.set(E,new Set),$cA.get(E)),$O=(E,t)=>$r(E).add(t),$l=(E,t)=>$r(E).delete(t),$GA=(E,...t)=>$EA([...$r(E)],E=>E(...t)),$ZA=(t,e)=>{let T=(...E)=>{$l(t,T),e(...E)};$O(t,T)};let DJ=0;const $9A=(E=0,t=0,e=16)=>{let T=E?e/E:0;return $aA($8B(E,E=>$rA(E*T+t+e)%e))},$A=$9A(7,2,12),$LB=32/27,Q=$8B(51,E=>440*2**((E-36)/12)).filter((E,t)=>$A.includes(t%12)).slice(2),$vA=(E,t)=>$aA([...new Set([...E,...t])]),$IC=()=>{let e=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$8B(13,E=>{let t=rand.$1A(e);return e=e.filter(E=>E!==t),[t,.2*rand(),rand.$w(),$9A(1+rand.$g(),rand.$g(15))]})]},$ZB=()=>[Q[15],...rand.$iB(Q.slice(16))].slice(0,8),$Y=(E,e,t,T,A,i=6)=>{const s=E.createOscillator();var n=E.createGain(),R=E.createStereoPanner();s.frequency.setValueAtTime(t/$LB,A),$EA($9A(i,2),(E,t)=>s.frequency.exponentialRampToValueAtTime(t%2?e*$LB:e/$LB,A+t/8)),n.gain.setValueAtTime(.1*t,A),n.gain.exponentialRampToValueAtTime(.5*t,A),n.gain.exponentialRampToValueAtTime(t,A+.325),n.gain.exponentialRampToValueAtTime(.01,A+2),R.pan.setValueAtTime(T,A),R.pan.exponentialRampToValueAtTime(-T,A+2),s.connect(n),n.connect(R),R.connect(E.destination),s.start(A),s.stop(A+2)},$v=(E,t,e,T,A,i,s)=>{var n=E.createOscillator(),R=E.createGain(),r=E.createStereoPanner(),O=E.createDynamicsCompressor(),i=i||e;n.frequency.setValueAtTime(t,A),n.frequency.exponentialRampToValueAtTime(t/1.5,A+.5),R.gain.setValueAtTime(.01,A),R.gain.exponentialRampToValueAtTime(i,A+1/32),R.gain.exponentialRampToValueAtTime(i/5,A+1/16),R.gain.linearRampToValueAtTime(0,A+.5),r.pan.setValueAtTime(s??T,A),O.threshold.setValueAtTime(-50,A),O.knee.setValueAtTime(40,A),O.ratio.setValueAtTime(12,A),O.attack.setValueAtTime(0,A),O.release.setValueAtTime(.25,A),n.connect(R),R.connect(r),r.connect(O),O.connect(E.destination),n.start(A),n.stop(A+.51)},$5B=(E,t,e=0,T)=>{var A=.04+.03*rand(),i=1/8+rand()/16,s=E.createOscillator(),n=E.createGain(),R=E.createStereoPanner();s.type="triangle",s.frequency.setValueAtTime(t,T),n.gain.setValueAtTime(A,T),n.gain.exponentialRampToValueAtTime(A/2,T+1/32),n.gain.linearRampToValueAtTime(0,T+i),R.pan.setValueAtTime(e,T),s.connect(n),n.connect(R),R.connect(E.destination),s.start(T),s.stop(T+i)},$GB=()=>{let i=new AudioContext,E=-$d(D/4e3,10)%1,s=E,e=[0],n=[],T=[],A=null,R=null;var t=(E=$IC(),t=$ZB())=>{A=E,R=t};return setInterval(()=>{i.currentTime+.25<s||s<0||(A&&(n=A,A=null),R&&(T=R,R=null),$Y(i,(T[7-(beat+measure%8)%8]||2*Q[rand.$g(6)])/2,.2,.5*rand.$w(),s,$rA(s-E)%3+4),$EA(e,E=>{const[t,e,T,A]=n[E];$EA(A,E=>$v(i,t,$d(e),T,.25*E+s))}),s+=4)},100),$O("$5B",(E=0)=>{$5B(i,(T[beat]||Q[15])/2,"number"==typeof E?E:0,i.currentTime)}),$O("beat",()=>{var[,E,t,,]=n[0];$v(i,Q[14],E,t,i.currentTime)}),$O("$Y",()=>$Y(i,2*(T[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$w(),i.currentTime,6)),$O("pause",()=>{"running"===i.state&&$0B?i.suspend():"suspended"!==i.state||$0B||i.resume()}),t(),{$sA:t,n:s,get track(){return n},get voices(){return e},get melody(){return T},sing:(E=[],t)=>{e=$vA([0,...E]),T=t||T}}},$0A=($7B=({$NB:E=min(1920,window.innerWidth),$WB:t=min(1080,window.innerHeight),os:T=!1}={})=>{let A=T?null:document.createElement("canvas"),i=(A&&(A.width=E,A.height=t),T?new OffscreenCanvas(E,t):A.transferControlToOffscreen()),n=i.getContext("2d");i.width=E,i.height=t;const R={get $T(){return i.width},get $U(){return i.width/2},get $V(){return i.width/3},get $H(){return i.height},$I:i.height/2,get $J(){return i.height/3},get $P(){return min(R.$J,R.$V)},get Rm(){return min(R.$H,R.$T)},get $Q(){return max(R.$H,R.$T)},$5:i,$5A:A,ctx:n,$6B:(E,t)=>{var e;T||(e=document.createElement("canvas"),A.replaceWith(e),(A=e).width=E,e.height=t,i=A.transferControlToOffscreen(),n=i.getContext("2d"),$o(R,{$5:i,ctx:n,$5A:A})),i.width=E,i.height=t,R.$I=i.height/2},$B:E=>(n.save(),E(R),n.restore(),R),E:()=>(n.clearRect(0,0,R.$T,R.$H),R),center:()=>(R.T(R.$U,R.$I),R),$D:(E="none")=>(n.filter=E,R),T:(E,t)=>(n.translate(E,t),R),R:(E,t)=>(n.rotate(E,t),R),$R:(...E)=>(n.roundRect(...E),R),M:(...E)=>(n.moveTo(...E),R),L:(...E)=>(n.lineTo(...E),R),A:(E=0,t=0,e=1,T=0,A=$AB[1],i=!1)=>(n.arc(E,t,e,T,A,i),R),B:(...E)=>(n.bezierCurveTo(...E),R),P:E=>(n.beginPath(),E?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(E=>{var[E,...t]=E.includes("(")?[E[0],E.slice(1).trim()]:E.split(" ");R[E](...$j(t,E=>"#"===E[0]||E.includes("(")?E:parseFloat(E,10)))}),R),C:()=>(n.closePath(),R),O:E=>(n.globalAlpha=E,R),S:(E=1,t=1)=>(n.scale(E,t),R),$G:(e,T)=>$EA(T,(E,t)=>e.addColorStop(t/T.length,E)),$E:(E,t,e,T,A)=>{E=n.createLinearGradient(E,t,e,T);return R.$G(E,A),E},$F:(E,t,e,T,A,i,s)=>{E=n.createRadialGradient(E,t,e,T,A,i);return R.$G(E,s),E},F:E=>(n.fillStyle=E,n.fill(),R),$C:(E,t)=>(n.fillStyle=E,n.fill(t),R),W:(E,t)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(),R),$W:(E,t,e)=>(n.strokeStyle=E,n.lineWidth=t,n.stroke(e),R),$f:(...E)=>(n.drawImage(...E),R)};return R.E(),R.$CA=E=>E.$CA(R),R},()=>{const s=new Path2D;return s.M=(...E)=>(s.moveTo(...E),s),s.L=(...E)=>(s.lineTo(...E),s),s.A=(E=0,t=0,e=1,T=0,A=$AB[1],i=!1)=>(s.arc(E,t,e,T,A,i),s),s.$=(...E)=>(s.arcTo(...E),s),s.B=(...E)=>(s.bezierCurveTo(...E),s),s.Q=(...E)=>(s.quadraticBezierCurveTo(...E),s),s.C=()=>(s.closePath(),s),s}),$fA=(E,t)=>$7B({$NB:E,$WB:t||E,os:!0}),$s=(E=32,t="#840")=>{const e=$fA(3*E),T=E/4,A=1.4*E;return e.$B(()=>{e.E().center().P().A(0,0,E).C().F(t).P().M(-A,-T).L(A,-T).M(-A,T).L(A,T).M(-T,-A).L(-T,A).M(T,-A).L(T,A).W(t,3)}),{R:1.5*E,D:3*E,get $f(){return e.$5}}},$SA=(Array.$pB=()=>[],(a,d,m={},p="$b")=>{const dd=window[p].$pB?.()??[],o=dd.length,dv=$j(d,([,E])=>"function"==typeof E?E.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(E)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $pB=()=>[...${p}.$pB(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$pB()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$j(d,([E],t)=>`  get ${E}(){return this[${t+o}]} set ${E}(x){return this[${t+o}]=x}`).join("")+$j(Object.values(m),E=>E.toString()).join("")+"};";return eval(e)}),$NA=($SA("$b",[["x",0],["y",0],["z",0],["$1",0],["$u",[]],["$7A",null]],{$y(){return new this.constructor(...this)},$VA(E){return[this.x,this.y,this.z]=$VA(this,E),this},$q(E){return[this.x,this.y]=$q(this,E),this},$BA(E){return new $b(...$BA(this,E))},$n(){return $j([this.x,this.y,this.z],$DB)},$YA(E=1){return[this.x,this.y]=$YA([this.x,this.y],E),this},$EB(E=1){return this.$YA(this.$h()*E),this},$h(){return $h([this.x,this.y])},$3A(E){var[t,e,T]=this.$NC();return E.S(T,T),E.T(t,e),this},$NC(){var[E,t,e]=this.$BA($RB),T=t<0?4/-t*5:0;return[E*=4,t=4*e*T,T]},$hB(E=1){var[t,e,T]=this.$NC(),A=(t*=T*$p,e*=T*$p,E?2*-$p*T:0);return new $b(t+$S.$U,e+$S.$I+A,2*T*(E?$p:1))},$AC(){var[E,t,e]=this.$hB();return $0A().A(E,t,abs(e)).C()},$cB(){},$KB(){},$CA(){},$4(){},$sB(){}},"Array"),$SA("$DA",[["$MA",null],["$N",[]],["$B",()=>{}]]),$SA("$dA",[["$t",0],["$fB",{}],["$aB",null],["$JB",null],["$bA",null],["$cB",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$FB=($SA("$Z",[["shell",null],["$IB",0],["$yA",0],["$BC",1],["$MC",1],["$vB",()=>new $b],["$tA",()=>new $b],["$nB",()=>new $b(1,1,0)],["$xB",[]],["w",0],["a",0],["s",0],["d",0],["$JC",2],["$CC",[]],["$oA",[]],["$tB",0],["$EC",[0,0,0]]],{$TB(){return this.$IB?abs(this.$IB):0},$lB(){var E=this.$yA%1;return E*=this.$vB.$h?.()||$K(E,1/32,31/32)?1:0,(this.$BC<0?1-E:E)%1},$nA(){return this.$lB()?$M(this.$lB()%.5,.5)%1:1-bar%.5*2%1},$cB(E){E=min(1,E/1e3);let{w:t,a:e,s:T,d:A}=this;var i=$DB(this.x)+128,s=$DB(this.y)+128,n=this.$xB.filter(E=>E.$t<=$t),n=(n.length?($EA(n,E=>{var t,e,T;E.$JB=E.$JB||E.$t,E.$aB?$h(this,E.$aB)>1/16?(E.$t=$t,[e,T]=(t=$YA($BA(E.$aB,this),1)).map(abs),$o(E.$fB,t[0]<0?{a:e,d:0}:{a:0,d:e},t[1]<0?{w:T,s:0}:{w:0,s:T})):(E.$bA=E.$t,E.$fB={w:0,a:0,s:0,d:0}):(E.$t=-1,E.$bA=$t),$o(this,E.$fB)}),n.length&&({w:t,a:e,s:T,d:A}=this),this.$xB=this.$xB.filter(E=>!E.$bA||E.$bA>$t||E.$t>$t)):$o(this,{w:0,a:0,s:0,d:0}),this.$tA=new $b(A-e,T-t,0),this.$BC=$8A(this.$tA.x||this.$BC),this.$MC=$8A(this.$tA.y||this.$MC),new $b(...this.$tA)),R=new $b(...this.$vB),r=this.$nA();if(0===n.$h()&&$K(R.$h(),1/16,r)&&n.$VA(new $b(...this.$nB).$YA((1-r)/2)),n.$YA(4*E),this.$tA.$h()){const T=.75+$M(n.$y().$YA(2).$VA(R.$y().$YA(1)).$h(),3)/4;R.$EB(T)}R.$VA(n),R.$YA(min(R.$h(),this.$JC));var O,n=(this.$vB=R).$h(),S=new $b(...R);S.$YA(S.$h()*E);const I=$VA(this,S);this.$u.length&&!this.$u.find(E=>$h($BA(E,I))<E.$4B)&&S.$EB(-.5);let h=$DB(this.x+S.x)+128,a=$DB(this.y+S.y)+128;if(h<0||255<h||a<0||256<a)console.log("Bad end of movement",h,a,this);else if(i===h&&s===a||((O=world.$JA[a][h])&&O!==this&&(S.$EB(-.1),h=$DB(this.x+S.x)+128,a=$DB(this.y+S.y)+128),world.$JA[s][i]=null,world.$JA[a][h]=this),this.$VA(S),this.$yA+=S.$h(),this.$IB=n*this.$BC,this.$nB=n?R.$y().$YA(1):this.$nB,this.$tA.$h()<.25&&R.$h()&&R.$EB(this.$nA()<1/8?0:$m(1-2*E,1)),0===R.$h()&&this.$lB()&&r&&(R.$EB(0),this.$yA=$DB(2*this.$yA)/2),this===$2B){const T=$rA(this.$yA/.25);T>this.$tB&&$GA("$5B",this.$nB.x/-2),this.$tB=T}}},"$b"),({$AA:t=512,$oA:A=[]}={})=>{const i=$fA(t),T=t/2,s=t/12,e={R:T,$AA:t,$oA:A,$CA:(E=i)=>(E.$B(()=>{let e=5.6*s;E===i&&E.E().center(),E.P().A(0,0,T).C().F(E.$F(0,2*s,4*s,0,0,t,["#242","#262"])),i.P().A(0,0,e),$8B(28,E=>{var[E,t]=$q([1,0],$AB[28]*(E-.5)-$AB[4]);i.M(E*e,t*e).L(E*T,t*T)}),i.W(i.$F(0,2*s,3*s,0,0,t,["#3536","#4846"]),2),$8B(13,E=>{let t=0,e=(E-11)*s*2.25;var T;E<10&&(T=$AB[10]*(E+2.5),[t,e]=$q([4.5*s,0],T)),i.P().A(t,e,s).C().F("rgba(127,127,127,0.25)"),A[E]&&i.P().A(t,e,s).C().F("#aa9")})}),e),$0(E){return A[world.$oA.indexOf(E)]=1,e.$CA(),e},get $f(){return i.$5}};return e.$CA(),e}),$GC=new Map,$qA=($SA("$1B",[["$KA",null],["$mA",()=>`hwb(${$DB(30+10*rand.$w()-2)} ${$DB(0+10*rand())}% ${$DB(47+10*rand())}%)`],["$9B",()=>`hwb(${$DB(30+2*rand.$w()-2)} 0% ${$DB(67+4*rand())}%)`],["$CB",0],["$zA",[]],["$MB",[]]],{$0A(E,t,e,T,A){var i,s,n,R,r,O,[E,t,e,T,A]=[$d(E,4),$d(t,64),e,T,$d(A[0],4)],T=[E,t,e,T,A].join();return $GC.has(T)||(i=$HA(t)/8,s=E?E/8:$HA(t)/16,n=$pA(t)/8,abs(E/16),[t,R]=[E?$gA(t):[0,0],E?$gA(1-t):[0,0]],[[t,R],[r,O]]=[t,R],A=sqrt(abs(A)/(abs(E)||1)),$GC.set(T,$0A().A(0+s*A,n-3,1,$SB[4],$SB).M(0+s*A,n-2).L(2+r/3,i*e-1.5).L(1+t/16,i*e-1).L(1+t*A,R).L(0,n-1).L(-1-r*A,O).L(r/16-1,-1-i*e).L(-2-t/3,-1.5-i*e).C())),$GC.get(T)},$CA(s,n=bar%.5*2,R=!0){s.$B(()=>{R&&this.$3A(s);var E=this.$lB()%.5,E=E?$M(E%.5,.5):1-n,t=this["$IB"];let e=t?t/8:$HA(E)/16,T=$pA(E)/8,A=abs(t/16);const i=sqrt(abs(this.$vB[0])/(abs(t)||1));this.shell&&0<this.$MC&&s.P().A(0-e*i/2,-1.75-T/2+A,7/8).C().W("#242",1/16).F("#131");t=this.$0A(this.$IB,E,this.$BC,this.$MC,this.$vB);s.$W(this.$9B,1/8,t).$C(this.$mA,t),this.shell&&(this.$MC<0||$0B)&&s.$B(()=>{s.P().A(0-e*i/2,-1.75-T/2+A,7/8).C(),s.W("#242",1/16),s.T(0-e*i/2,-1.75-T/2+A),s.R(this.$vB[0]/16),s.$f(shell.$f,-1,-1,2,2)}),$xA.$aB})},$KB(){var E,t,e,T;this.$KA||(this.$KA=this.$n()),this.$CB&&!this.$xB?.length&&(E=$t%576,E=$t-E,t=this.$u[0],e=$BA(t,this),T=$h(e),this.$xB=[$o(new $dA,{$t:16+E+rand.$g(16),$aB:$VA($YA(e,-2),t)}),$o(new $dA,{$t:64+E+rand.$g(16),$aB:this.$KA}),$o(new $dA,{$t:288+E+rand.$g(16),$aB:$VA($EB(e,(T-2)/T),this)}),$o(new $dA,{$t:416+E+rand.$g(16),$aB:this.$KA}),$o(new $dA,{$t:575+E})].filter(E=>E.$t>=$t))},$4(E){return this!==E&&this.$BA(E).$h()<=4&&(!this.$CB&&!this.$zA.length||this.$zA.find(t=>$2B.$CC.find(E=>$L(E,t)))||this.$CB&&this.$MB.find(t=>$2B.$CC.find(E=>$L(E,t))))},$sB(E){this.$CB||this.$zA.length||($GA("$Y"),this.$CB=1);const e=$j(this.$zA,t=>E.$CC.find(E=>$L(E,t))).filter(E=>E);if(e.$XB){const t=this.$zA.filter(t=>e.find(E=>$L(E,t)));E.$CC=E.$CC.filter(E=>!e.includes(E)),this.$zA=this.$zA.filter(E=>!t.includes(E))}}},"$Z"),$SA("$A",[],{$CA(i){i.$B(()=>{this.$3A(i),i.S(this.$BC,1);var E=this.$IB,[t,e]=E?$gA(this.$nA()):[0,0],[T,A]=E?$gA(1-this.$nA()):[0,0],[[T,A],[t,e]]=0<this.$BC?[[t,e],[T,A]]:[[T,A],[t,e]],E=sqrt(abs(this.$vB[0])/(abs(E)||1));i.P().M(1,A/4-2).L(0-t*E,0+e).L(0,A/4-1).C().M(-1,e/4-1).L(T*E-1,0+A).L(-2,e/4-1.5).C().F("#520"),i.P().M(1,A/4-3).L(2,A/4-2).L(1,A/4-2).L(1+T*E,0+A).L(0,A/4-1).L(-1,e/4-1).L(-2-t*E,0+e).L(-2,e/4-1.5).L(-1.75,e/4-1.75).L(-2,e/4-2).L(0,A/4-2).L(.5,A/4-2.5).L(0,A/4-3).C().W("#620",1/8).F("#840"),i.P().A(1,A/4-4,1,$AB[2],1,!0).W("#620",.125)})}},"$Z"),$SA("$jA",[],{$CA(i,E,t,e){i.$B(()=>{this.$3A(i),i.S(this.$BC,1);var E=this.$IB,[t,e]=E?$gA(this.$nA()):[0,0],[T,A]=E?$gA(1-this.$nA()):[0,0],[[T,A],[t,e]]=0<this.$BC?[[t,e],[T,A]]:[[T,A],[t,e]],E=sqrt(abs(this.$vB[0])/(abs(E)||1));i.P().M(1,A/4-2).L(0-t*E,0+e).L(0,A/4-1).C().M(-1,e/4-1).L(T*E-1,0+A).L(-2,e/4-1.5).C().F("#520"),i.P().M(2,A/4-2).L(2,A/4-1).L(1.5,A/4-.5).L(1,A/4-1).L(1+T*E,0+A).L(0,A/4-1).L(-1,e/4-1).L(-2-t*E,0+e).L(-2,e/4-1.5).L(-1.75,e/4-1.75).L(-2,e/4-2).L(0,A/4-3).L(1,A/4-2.25).L(1.5,A/4-2.5).C().stroke("#620",1/8).F("#840"),i.P().A(2,A/4-2.25,.75,$AB[2],$AB[2]+$AB[7]).stroke("#620",.125)})}},"$Z"),$SA("$UA",[["$B",0],["$4B",32],["$mA","#ccf"],["$9B","#ccf4"]],{$CA(s){s.$B(()=>{var E,t,{$B:e,$4B:T}=this,A=T-1,i=1.3*T;e&&(E=$dB(cos($AB[28]*e)*i),t=e<14?E:-i,e=14<e?-E:i,s.P().M(0,A).B(e,T,e,-T,0,-A).B(t,-T,t,T,0,A).C().F(this.$mA)),s.P().A(0,0,A).C().W(this.$9B,T/16)})},$uA(){return abs(sin($AB[2]*this.$B/28))}},"$b"),$SA("$u",[["$mA",()=>`hwb(${120+rand.$g(25)} ${10+rand.$g(5)}% ${$DB(65+rand.$g(5))}%)`],["$4B",16],["$3B",[]],["$qB",[]],["$DC",[]],["$ZB",null]],{$rB(t=16){this.$4B=t;rand();return this.$3B=$8B(16,E=>new $b(0,-t,0).$q($AB[16]*(E+rand()/4))),this},$cB(t){$EA(this.$DC,E=>E.$cB(t))}},"$b"),$SA("$hA",[["$S",null]],{$CA(E){return this.$S||(this.$S=$7B({$NB:64,$WB:64}).P().M(...rand.$X(1,28)).L(...rand.$X(24,24)).L(...rand.$X(21,12)).L(...rand.$X(31,11)).L(...rand.$X(33,23)).L(...rand.$X(47,14)).L(...rand.$X(53,21)).L(...rand.$X(61,31)).L(...rand.$X(52,44)).L(...rand.$X(42,47)).L(...rand.$X(43,43)).L(...rand.$X(39,48)).L(...rand.$X(16,57)).L(...rand.$X(9,54)).L(...rand.$X(3,42)).C().F(rand.$e(15,2,17,2,68,4))),E.$f(this.$S.$5,0,0,64,64),E}},"$b"),$SA("$2A",[["$0A",""],["$S",null],["$NB",0],["$WB",0],["$XA",0],["$mA",()=>rand.$e(150,2,10,6,80,4)]],{$rB(E){return this.$7A=rand.$B(this.$7A,()=>{const i=min(8,this.$1=E||this.$1||4*rand()+3),s=ceil(i);let n=0,R=0,r=0;this.$0A=$8B(s,E=>{var t=(i-E)/(i-E+3),e=n-t/.125,T=t*(s-E),A=n+t+.5,E=$M(i-E,s),t=$d(rand.$w()*E*t/2),T=(R=max(T,R),`M ${t} ${$d(e)} L ${$d(-T)} ${$d(A)-rand()*E} L ${$d(r)} ${$d(n+.25)} L ${$d(T)} ${$d(A)-rand()*E} L ${t} `+$d(e));return r=t,n=e,T}).join(" ")+` F ${this.$mA} S #1218`,this.$NB=ceil(2*R),this.$WB=ceil(abs(n)),this.$S=$7B({$NB:this.$NB*$p*4,$WB:this.$WB*$p*4,os:!0}),this.$S.$B(E=>E.S($p,$p).T(this.$NB/2,this.$WB).P(this.$0A))}),this},$CA(E){if(this.$S)return E.$B(()=>{this.$3A(E),E.$f(this.$S.$5,-this.$NB/2,-this.$WB,4*this.$NB,4*this.$WB)}),this},$cB(E){this.$XA=this.$XA||4+rand.$g(284),$t>=this.$XA&&(this.$rB(this.$1+(rand()+1)/8),this.$XA=$t+576)},$4(E){return 2<this.$1&&this.$BA(E).$h()<=4},$sB(E){var t=$o(new $hA);E.$CC.push(t),this.$rB(--this.$1),$GA("beat")}},"$b"),$SA("$VB",[["$S",null],["$B",0],["$mA",()=>rand.$e(180,4,33,3,55,4)],["$PA",-1],["$NB",4],["$WB",4],["$lA",0]],{$rB(){const e=this.$lA,T=(this.$S=this.$S??$fA(this.$NB*$p*4,this.$WB*$p*4),rand.$w()/4);var E=e?-2:-1.5;const A=rand()/8,i=E+A;return this.$S.$B(E=>{var t;E.E().S($p,$p).T(this.$NB/2,this.$WB).P().M(-1.5-T,0).B(-2.5,-3,-1,-3,T,A-2).B(1,-3,2.5,-3,1.5+T,0).C().F(this.$mA).P().M(0,0).B(2*-T,-A,4*T,i,T,i).W("#0002",1/8),E.P().A(T,i,e?.75:1/8).F(`hwb(${$DB((180/28*this.$B+240+rand.$w()/4)%360)} ${$DB(10+25*rand())}% 5%)`),this.$lA&&(t=$o(new $UA,{$4B:10,$B:this.$B,$mA:"#ccf",$9B:"#000a"}),E.O(.5).T(1.25*T,i).S(1/16,1/16),t.$CA(E))}),this},$CA(E,t){if(this.$S)return t?E.$f(this.$S.$5,0,0,256,256):E.$B(()=>{this.$3A(E),E.$f(this.$S.$5,-this.$NB/2,-this.$WB,4*this.$NB,4*this.$WB)}),E},$cB(E,t,e){t=t??moon?.$B,e=e??$LA;return t!==this.$PA&&.5<=e&&!this.$lA&&(this.$PA=t,this.$lA=+((moon?.$B??-1)===this.$B),this.$rB()),this},$4(E){return this.$lA&&this.$BA(E).$h()<=2},$sB(E){var t=$o(this.$y(),{$S:null});E.$CC.push(t.$rB()),this.$lA=0,this.$rB(),$GA("$Y")}},"$b"),$SA("$QB",[["$S",null]],{$CA(E){}},"$b"),$SA("$z",[["$S",null]],{$CA(E){}},"$b"),$SA("$uB",[["$S",null]],{$CA(E){}},"$b"),$SA("$gB",[["$S",null]],{$CA(E){}},"$b"),$SA("$2",[["$S",null]],{$CA(E){}},"$b"),$SA("$bB",[["$S",null]],{$CA(E){}},"$b"),$SA("$HB",[["$S",null]],{$CA(E){}},"$b"),$SA("$OC",[["$S",null]],{$CA(E){}},"$b"),$SA("$x",[["$S",null]],{$CA(E){}},"$b"),new Map),$S=($SA("$IA",[["$i",()=>new $hA],["O",()=>rand()],["$DA",null]],{$CA(A,E){A.$B(()=>{this.$3A(A);var E,t,e,T=$d((this.O+bar%.5*2)%1,64);A.$B(()=>A.T(-1.5,-2).S(1/32,1/32).$CA(this.$i)),A.$B(()=>A.T(1.5,-1.75).S(-1/32,1/32).$CA(this.$i)),$qA.has(T)||(E=$fA(128,256),t=$HA(T),e=$HA((T+.25)%1),E.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$AB[2]).B(-1,-2.5-e/2,0+t,-2.5-e,0-t/2,-3.5).B(0-t,-2.5-e,1,-2.5-e/2,1,-1.5).F(A.$F(0,-1.25,.5+e/8,0,0,4-e/4,["#ff0a","#e206","#d004"])),$qA.set(T,E)),A.$f($qA.get(T).$5,-1,-4,2,4)})},$4(E){return!(this.$u[0].$qB.filter(E=>$L(E,$1B)).find(E=>!E.$CB)||!this.$DA)},$sB(E){this.$DA&&($2B.shell.$0(this.$DA),this.$DA=0,$GA("$Y"),$GA("$v"))}},"$b"),$SA("$OB",[["$7A",13],["$1",0],["$oA",[]],["$wA",[]],["$zB",[]],["$UB",[]],["$JA",()=>$8B(256,E=>$8B(256,E=>null))],["$iA",[]],["$j",null],["$rA",null],["$mB",[]],["$qB",[]],["$DC",[]],["$LC",[]],["$IC",null],["$ZB",null]],{$rB(E){this.$j=this.$j||$7B({$NB:256,$WB:256,os:!0}),this.$rA=this.$rA||$7B({$NB:256,$WB:256,os:!0}),this.$7A=E,rand.$7A(E);var[E,t]=rand.$iB([$QB,$gB]),[e,T]=rand.$iB([rand.$iB([$HB,$jA,$z]),rand.$iB([$2,$A,$bB])]);this.$oA=[$1B,E,...e,$x,...T,t,...rand.$iB([$uB,$OC]),$FB],this.$IC=$IC(),this.$ZB=$ZB();this.$wA=$8B(28,E=>(new $u).$rB(12).$VA([96,0,0]).$q(E*$AB[28]-$AB[4])),this.$zB=$8B(13,E=>E<10?(new $u).$rB(18).$VA([80,0,0]).$q($AB[10]*(E+2.5)):(new $u).$rB(18).$VA([0,16*(E-11)*2.5,0])),this.$iA=[...this.$wA,...this.$zB],$EA(this.$wA,(e,E)=>{e.$WA="moon "+E,$EA(e.$3B,t=>{var E;this.$iA.filter(E=>t.$y().$VA(e).$BA(E).$h()<=E.$4B+.05).length<2&&((E=(new $2A).$rB().$VA(e).$VA(t)).$u.push(e),e.$DC.push(E),this.$DC.push(E))});E=$o(new $VB,{x:e.x,y:e.y,$B:E}).$cB(0,0,.5);e.$DC.push(E),this.$DC.push(E)}),$EA(this.$zB,(t,E)=>{var e=(new $IA).$VA(t);e.$DA=this.$oA[E],t.$qB.push(e),e.$u.push(t),$8B(3,E=>{E=(new $1B).$VA(new $b(0,10+rand.$g(2),0).$q($AB[3]*(E+rand.$w()/8)).$VA(t));t.$qB.push(E),E.$u.push(t)}),t.$IC=$IC(),t.$ZB=$ZB()}),this.$qB.push(...$j(this.$iA,E=>E.$qB).flat().sort($HC)),this.$j.$B(T=>{T.E().center(),$EA(this.$iA,e=>{T.P(),$EA(e.$3B,(E,t)=>(t?T.L:T.M)(E[0]+e.x,E[1]+e.y)),T.C().F(T.$F(0,90,90,0,0,256,["#242","#262"])).O(.25).W(T.$F(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this.$rA.P().A(128,128,108).W("#202",16).C().P().A(128,112,48).F(this.$rA.$F(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])),this.$rA.$f(this.$j.$5,0,0,256,256);const A=$o(new $UA,{$4B:10});return $EA(this.$wA,(t,E)=>{$o(A,{$B:E}),this.$rA.$B(E=>{E.T(128+t.x,128+t.y).O(.875).P().A(0,0,t.$4B).F(t.$mA).O(.125),A.$CA(E)})}),this.$rA.$B(E=>{E.center(),$EA(this.$DC.filter(E=>!(E instanceof $VB)),E=>this.$rA.P().A(E.x,E.y+.5,1.25).F(E.$mA))}),$EA([...this.$qB,...this.$DC,$2B],E=>{E.y=$eB(E.y),E.x=$eB(E.x),this.$JA[E.y+128][E.x+128]=E}),this},$6A(){},$QA(){},$cB(t){const e=this.$iA.filter(E=>$h($BA(E,$2B))<E.$4B);return(e.find(E=>!$2B.$u.includes(E))||$2B.$u.find(E=>!e.includes(E)))&&($2B.$u=e,DJ?.$sA?.((e.find(E=>E.$IC)||this).$IC,(e.find(E=>E.$ZB)||this).$ZB)),$EA(this.$iA,E=>E.$cB(t)),this},$CA(t){this.$LC.length=0;var e=-t.$U/$p,T=t.$T/$p;let A=1;for(let E=max(0,$DB($RB.y));E<=min(256,$DB($RB.y+132));E+=1){A&&t.O(1-A);var i=new $b($RB.x,E-128,0).$hB(0),s=i[2];if(0===s)break;var n=s*$p*2,R=max(0,$rA($RB.x+128-t.$U/n)-4);min(256-R,ceil(t.$T/n)+8);t.$f(this.$rA.$5,$RB.x+128-t.$U/n,E,t.$T/n,1,e,(i[1]-t.$I)/$p,T,2*s),$EA($aA(this.$JA[E].filter(E=>E),$HC),E=>{E.$CA(t),E.$4?.($2B)&&this.$LC.unshift(E)}),A&&(t.O(1),A=max(0,A-s/4))}return t.$5}},"$b"),$7B());let moon=new $UA,sun=$s(32,"#ffd"),rand=$BB(13),stars=$8B(91,()=>[rand.$w(),rand.$w()]),shell=$FB(),$2B=$o(new $1B,{x:0,y:104,z:0,shell:shell,$MC:-1,$mA:"#840",$9B:"#620"}),$xA=new $b,world=($xA.$0A=$0A().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $OB).$rB(13)),entities=[],$FC=20,$oB=-2,$KC=4,$C=-1/8,$RB=new $b($2B.x,$2B.y+$KC,$2B.z+$C);const $eA=t=>{$0B||(D+=t*$4A,$LA=D%$6/$6,measure=$rA(D/4e3),bar=D%4e3/4e3,beat=$rA(8*bar),$t=$rA(D/250),$PA!==$t&&$GA("tick"),$PA=$t,step=D%$3/$3,$OA.change&&$2B.$xB.unshift($o(new $dA,{$t:$t,$fB:$OA.$VA})),$OA.shift?$2B.$JC=4:$2B.$JC=2,world.$cB(t),$2B.$cB(t),$EA(world.$qB,E=>E.$KB?.()),$EA(world.$qB,E=>E.$cB?.(t))),$RB.x+=($2B.x-$RB.x)/16,$RB.y+=($2B.y+($0B?$KC:$FC)-$RB.y)/16,$RB.z+=($2B.z-$RB.z+($0B?$C:$oB))/16};let $TA=$8B(256,E=>[E,E]).flat().map(E=>E/$p);const $RA=(E=0)=>{performance.now();var t=E-now;now=E,$eA(t*$4A);const{$H:e,$I:n,$J:T,$T:A,$U:R,$V:i,$P:r,$Q:O}=$S;E=$LA,t=E;const S=(E+.5)%1;moon.$B=D?$rA((28+(D-$yB()*$6)/$6)%28):0;let I=$jB(t)*i;const h=$wB(t);let a=$jB(S)*i;const N=$wB(S);.5<E?I=-a:a=-I;let L;$S.$B(()=>{if($S.E(),$S.ctx.fillStyle=.1<h?"#840":"#202",$S.ctx.fillRect(0,0,A,e),$S.center(),.25<N){const s=T-N*T*2;$EA(stars,([E,t])=>{var e=E*R,T=(t-S)*n,A=$M($h([a,s],[e,T]),4*moon.$4B),i=1+.5*sin((7.3*t+now%$6/$6+1.1*E)*$SB),t=(1+i)**2*max(0,sin(7.3*t+now/$6*130+11*E)**3);$S.O(max(0,1-moon.$uA()/2-(A<.25?1:1-A))).P().A(e,T,i).F("#ffd").C(),$S.P().M(e,T-t).L(e,T+t).M(e-t,T).L(e+t,T).W("#ffd",.5)}),L=`rgba(204,204,255,${$d(.1*moon.$uA())})`,$S.O(max(0,N)).P().A(a,s,2*O).C().F($S.$F(a,s,r*moon.$uA(),a,s,2*r,[`rgba(204,204,255,${$d(.05+.2*moon.$uA())})`,L,L,"rgba(24,0,24,0)"])).T(a,s),moon.$CA($S),L="#ccf6"}.25<h&&($S.O(max(0,h)),L="#aae6",$S.P().A(I,T-h*T*2,2*O).C().F($S.$F(I,T-h*T*2,sun.R*max(h,0),I,T-h*T*2,O,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$f(sun.$f,I-sun.R,T-h*T*2-sun.R,sun.D,sun.D))}),$S.$B(()=>{$S.T(R,n),$S.S($p,$p),world.$CA($S)}),$S.$B(()=>$S.T($xA.x-2,$xA.y-2).S(4,4).R($SB*$HA(now%4e3/4e3)).$C("#2808",$xA.$0A)),$xA.$aB=$0B?null:world.$LC.find(E=>$S.ctx.isPointInPath(E.$AC(),$xA.x,$xA.y)),$xA.$aB&&$S.$B(()=>{var E=$xA.$aB.$AC();$S.ctx.setLineDash([13,7]),$S.ctx.lineDashOffset=now/1e3*20,$S.$W("#280",1,E)});const s=$2B.$CC.length;$EA($2B.$CC,(t,E)=>{const e=($S.$T-128)/(s+1)*(E+1)+64,T=$S.$H-128;$S.$B(E=>t.$CA(E.T(e,T).P().$R(0,0,64,64,4).C().F("#fff4"),!0))}),$0B&&($S.ctx.fillStyle="#0f0",$S.ctx.font="32px monospace",$EA(["wasd + shift = move","esc = pause/resume","mouse = interact",DJ?"- paused -":"click to play"],(E,t)=>$S.ctx.fillText(E,$S.$U-$S.ctx.measureText(E).width/2,32*(t+1)))),requestAnimationFrame($RA)},$OA=($RA(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $VA(){var{w:E,a:t,s:e,d:T}=this;return{w:E,a:t,s:e,d:T}}}),$YB=($ZA("mousedown",()=>$0B=!1),$O("click",()=>$xA.$aB?.$sB($2B)),$O("keydown",E=>{$GA("input");E=E.key.toLowerCase();$OA[E]=1,$GA("key-"+E),"escape"===E&&($0B=!$0B,$GA("pause"))}),$O("keyup",E=>$OA[E.key.toLowerCase()]=0),$O("mousedown",()=>$GA("input")),$O("mousemove",({clientX:E,clientY:t})=>$o($xA,{x:E,y:t})),$O("resize",()=>{$S.$6B(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$EA(["visibilitychange","blur"],E=>$O(E,()=>{$EA(Object.keys($OA),E=>$OA[E]=0)})),(E,t,e)=>E.addEventListener(t,e));$EA(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],t=>$YB(document,t,(...E)=>$GA(t,...E))),$EA(["resize","blur"],t=>$YB(window,t,(...E)=>$GA(t,...E))),$YB(document,"click",()=>DJ=DJ||$GB()),document.body.appendChild($S.$5A);})()