(()=>{let now=0,$eC=500,$hC=144e3,D=0,$AC=0,$GD=0,$EC=0,measure=0,beat=0,bar=0,step=0,$n=!0,$TC=1,$CD=32,$G=20,$R=-2,$C=4,$L=-1/8;const{cos,sin,min,max,sqrt,floor:$LB,ceil,round:$0B,imul,abs,PI,sign:$YC}=Math,$v=(E=0,t=E=>E)=>new Array(E).fill(0).map((E,t)=>t).map(t),$DD=([E,t],T)=>[E*cos(T)-t*sin(T),E*sin(T)+t*cos(T)],$KC=([E,t,T],[A,s,n])=>[E+A,t+s,T+n],$pB=([E,t,T],[A,s,n])=>[E-A,t-s,T-n],$qC=(E,t=1e3)=>$0B(E*t)/t,OF=(E,t)=>E<t?E/t:1,$zC=(E,t)=>max(0,OF(E,t)),IN=(E,t,T)=>t<E&&E<T,IS=(E,t)=>E instanceof t,$1C=(E,t=(E,t)=>E-t)=>E.sort(t),$1B=([E,t],T=1)=>[E*T,t*T],$NC=([E,t],T=1)=>{T/=$uC([E,t])||1;return[E*T,t*T]},$uC=([E,t],[T=0,A=0]=[])=>sqrt((T-E)**2+(A-t)**2),$AB=E=>(0<E?$LB:ceil)(E),$dB=E=>(E<0?$LB:ceil)(E),$BB=E=>$YC(E)*$0B(abs(E)),$e=2*PI,$WB=$v(128,E=>E?$e/E:0),$BD=(...E)=>Object.assign(...E),$sB=(E,t)=>E.forEach?.(t),$wC=(E,t)=>E.map(t),$I=(E,t)=>E.y-t.y||E.z-t.z||E.x-t.x,$pC=E=>1+2.70158*(E-1)**3+1.70158*(E-1)**2,$mC=E=>E*E*(2.70158*E-1.70158),$nC=E=>1-cos(E*PI/2),$uB=E=>-(cos(PI*E)-1)/2,$JB=E=>sin(E*PI),$wB=E=>sin(E*$e),$jC=2.5949095,$lC=$e/4.5,$1=()=>min(500/$hC,.05),$Z=E=>{let t=max(0,sin(E*$e)),T=$1();return T<E&&E<=2*T?t+=2*$pC((E-T)/T):2*T<E&&E<.5?t+=2:.5<=E&&E<.5+T&&(t+=2-2*$mC((E-.5)/T)),t/3},$7=E=>2*$uB(OF(E,.5))-1,$7C=E=>[(min(2*E,0)-(1-cos(E*$e)))/2,-$nC(-min(sin(E*$e),0))/2],$YB=(E=0)=>{let A=0|E;return let=fn=()=>{var E=(A=A+2654435769|0)^A>>>16,E=imul(E,569420461);return E^=E>>>15,(((E=imul(E,1935289751))^E>>15)>>>0)/4294967296*2},$BD(fn,{$XC:E=>void 0!==E?A=0|E:A,$tC:(E=1)=>$0B(fn()*E),$gB:()=>1-2*fn(),$YC:()=>$dB(fn.$gB()),bit:()=>$0B(fn()),bool:()=>!!$0B(fn()),$6:E=>E.slice().sort(fn.$gB),$QC:E=>E[$AB(fn()*E.length)],$rC:(E,t,T,A,s,n)=>`hwb(${$0B(E+fn.$gB()*t)} ${$0B(T+fn.$gB()*A)}% ${$0B(s+fn.$gB()*n)}%)`,XY:(E,t,T=1)=>[E+fn.$gB()*T,t+fn.$gB()*T],DO:(E,t)=>{var T=A;return A=0|(E??A),t(),A=T,E??T}})},$3C=new Map,$ED=E=>($3C.has(E)||$3C.set(E,new Set),$3C.get(E)),ON=(E,t)=>$ED(E).add(t),$yC=(E,t)=>$ED(E).delete(t),$vB=(E,...t)=>$sB([...$ED(E)],E=>E(...t)),$OC=(t,T)=>{let A=(...E)=>{$yC(t,A),T(...E)};ON(t,A)};let DJ=0;const $0C=(E=0,t=0,T=16)=>{let A=E?T/E:0;return $1C($v(E,E=>$LB(E*A+t+T)%T))},CM=$0C(7,2,12),$9B=32/27,Q=$v(51,E=>440*2**((E-36)/12)).filter((E,t)=>CM.includes(t%12)).slice(2),$QB=(E,t=[])=>$1C([...new Set([...E,...t])]),$J=()=>{let T=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$v(13,E=>{let t=rand.$QC(T);return T=T.filter(E=>E!==t),[t,.05+.15*rand(),rand.$gB(),$0C(1+rand.$tC(),rand.$tC(15))]})]},$m=()=>[Q[15],...rand.$6(Q.slice(16))].slice(0,8),$9C=(E,t,T,A,s,n,i=6)=>{const e=E.createOscillator();var r=E.createGain(),E=E.createStereoPanner();e.frequency.setValueAtTime(A/$9B,n),$sB($0C(i,2),(E,t)=>e.frequency.exponentialRampToValueAtTime(t%2?T*$9B:T/$9B,n+t/8)),r.gain.setValueAtTime(.1*A,n),r.gain.exponentialRampToValueAtTime(.5*A,n),r.gain.exponentialRampToValueAtTime(A,n+.325),r.gain.exponentialRampToValueAtTime(.01,n+2),E.pan.setValueAtTime(s,n),E.pan.exponentialRampToValueAtTime(-s,n+2),e.connect(r),r.connect(E),E.connect(t),e.start(n),e.stop(n+2)},$fB=(E,t,T,A,s,n,i,e)=>{var r=E.createOscillator(),R=E.createGain(),I=E.createStereoPanner(),E=E.createDynamicsCompressor(),i=$qC(i||A);r.frequency.setValueAtTime(T,n),r.frequency.exponentialRampToValueAtTime(T/1.5,n+.5),R.gain.setValueAtTime(.01,n),R.gain.exponentialRampToValueAtTime(i,n+1/32),R.gain.exponentialRampToValueAtTime(i/5,n+1/16),R.gain.linearRampToValueAtTime(0,n+.5),I.pan.setValueAtTime(e??s,n),E.threshold.setValueAtTime(-50,n),E.knee.setValueAtTime(40,n),E.ratio.setValueAtTime(12,n),E.attack.setValueAtTime(0,n),E.release.setValueAtTime(.25,n),r.connect(R),R.connect(I),I.connect(E),E.connect(t),r.start(n),r.stop(n+.51)},$s=(E,t,T,A=0,s)=>{var n=.04+.03*rand(),i=1/8+rand()/16,e=E.createOscillator(),r=E.createGain(),E=E.createStereoPanner();e.type="triangle",e.frequency.setValueAtTime(T,s),r.gain.setValueAtTime(n,s),r.gain.exponentialRampToValueAtTime(n/2,s+1/32),r.gain.linearRampToValueAtTime(0,s+i),E.pan.setValueAtTime(A,s),e.connect(r),r.connect(E),E.connect(t),e.start(s),e.stop(s+i)},$3B=()=>{const n=new AudioContext,i=n.createAnalyser(),E=(i.connect(n.destination),i.fftSize=256,i.frequencyBinCount),t=new Uint8Array(E);let T=-$qC(D/4e3,10)%1,e=T,A=[0],r=[],s=[],R=null,I=null;var h=(E=$J(),t=$m())=>{R=E,I=t};return setInterval(()=>{n.currentTime+.25<e||e<0||(R&&(r=R,R=null),I&&(s=I,I=null),$9C(n,i,(s[7-(beat+measure%8)%8]||2*Q[rand.$tC(6)])/2,.2,.5*rand.$gB(),e,$LB(e-T)%3+4),$sB(A,E=>{const[t,T,A,s]=r[E];$sB(s,E=>$fB(n,i,t,$qC(T),A,.25*E+e))}),e+=4)},100),ON("$s",(E=0)=>{$s(n,i,(s[beat]||Q[15])/2,"number"==typeof E?E:0,n.currentTime)}),ON("$fB",()=>{var[,E,t,,]=r[0];$fB(n,i,Q[14],E,t,n.currentTime)}),ON("$9C",()=>$9C(n,i,2*(s[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$gB(),n.currentTime,6)),ON("pause",()=>{"running"===n.state&&$n?n.suspend():"suspended"!==n.state||$n||n.resume()}),h(),{$MB:h,n:e,get track(){return r},get voices(){return A},get melody(){return s},get $mB(){return i.getByteFrequencyData(t),Array.from(t).slice(0,E/2)},$ZC:(E=[],t)=>{A=$QB([0,...E]),s=t||s}}},$PC=($u=({$bB:E=min(1920,window.innerWidth),$i:t=min(1080,window.innerHeight),os:A=!1}={})=>{let s=A?null:document.createElement("canvas"),n=(s&&(s.width=E,s.height=t),A?new OffscreenCanvas(E,t):s.transferControlToOffscreen()),e=n.getContext("2d");n.width=E,n.height=t;const r={get W1(){return n.width},get W2(){return n.width/2},get W3(){return n.width/3},get H1(){return n.height},H2:n.height/2,get H3(){return n.height/3},get R3(){return min(r.H3,r.W3)},get Rm(){return min(r.H1,r.W1)},get RM(){return max(r.H1,r.W1)},$gC:n,$UC:s,ctx:e,$t:(E,t)=>{var T;A||(T=document.createElement("canvas"),s.replaceWith(T),(s=T).width=E,T.height=t,n=s.transferControlToOffscreen(),e=n.getContext("2d"),$BD(r,{$gC:n,ctx:e,$UC:s})),n.width=E,n.height=t,r.H2=n.height/2},DO:E=>(e.save(),E(r),e.restore(),r),E:()=>(e.clearRect(0,0,r.W1,r.H1),r),center:()=>(r.T(r.W2,r.H2),r),FX:(E="none")=>(e.filter=E,r),T:(E,t)=>(e.translate(E,t),r),R:E=>(e.rotate(E),r),RR:(...E)=>(e.roundRect(...E),r),M:(...E)=>(e.moveTo(...E),r),L:(...E)=>(e.lineTo(...E),r),A:(E=0,t=0,T=1,A=0,s=$WB[1],n=!1)=>(e.arc(E,t,T,A,s,n),r),B:(...E)=>(e.bezierCurveTo(...E),r),P:E=>(e.beginPath(),E?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(E=>{var[E,...t]=E.includes("(")?[E[0],E.slice(1).trim()]:E.split(" ");r[E](...$wC(t,E=>"#"===E[0]||E.includes("(")?E:parseFloat(E,10)))}),r),C:()=>(e.closePath(),r),O:E=>(e.globalAlpha=E,r),S:(E=1,t=1)=>(e.scale(E,t),r),GS:(T,A)=>$sB(A,(E,t)=>T.addColorStop(t/A.length,E)),GL:(E,t,T,A,s)=>{E=e.createLinearGradient(E,t,T,A);return r.GS(E,s),E},GR:(E,t,T,A,s,n,i)=>{E=e.createRadialGradient(E,t,T,A,s,n);return r.GS(E,i),E},F:E=>(e.fillStyle=E,e.fill(),r),FP:(E,t)=>(e.fillStyle=E,e.fill(t),r),W:(E,t)=>(e.strokeStyle=E,e.lineWidth=t,e.stroke(),r),WP:(E,t,T)=>(e.strokeStyle=E,e.lineWidth=t,e.stroke(T),r),$sC:(...E)=>(e.drawImage(...E),r)};return r.E(),r.$qB=(E,t)=>E.$qB(r,t),r},()=>{const i=new Path2D;return i.M=(...E)=>(i.moveTo(...E),i),i.L=(...E)=>(i.lineTo(...E),i),i.A=(E=0,t=0,T=1,A=0,s=$WB[1],n=!1)=>(i.arc(E,t,T,A,s,n),i),i.AT=(...E)=>(i.arcTo(...E),i),i.B=(...E)=>(i.bezierCurveTo(...E),i),i.Q=(...E)=>(i.quadraticBezierCurveTo(...E),i),i.C=()=>(i.closePath(),i),i}),$6C=(E,t)=>$u({$bB:E,$i:t||E,os:!0}),$FD=(E=32,t="#840")=>{const T=$6C(3*E),A=E/4,s=1.4*E;return T.DO(()=>{T.E().center().P().A(0,0,E).C().F(t).P().M(-s,-A).L(s,-A).M(-s,A).L(s,A).M(-A,-s).L(-A,s).M(A,-s).L(A,s).W(t,3)}),{R:1.5*E,D:3*E,get $sC(){return T.$gC}}},$HC=(Array.$S=()=>[],(a,d,m={},p="$oC")=>{const dd=window[p].$S?.()??[],o=dd.length,dv=$wC(d,([,E])=>"function"==typeof E?E.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(E)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $S=()=>[...${p}.$S(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$S()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$wC(d,([E],t)=>`  get ${E}(){return this[${t+o}]} set ${E}(x){return this[${t+o}]=x}`).join("")+$wC(Object.values(m),E=>E.toString()).join("")+"};";return eval(e)}),$CC=($HC("$oC",[["x",0],["y",0],["z",0],["$cC",0],["$eB",[]],["$XC",null],["$bB",0],["$i",0]],{$jB(){return new this.constructor(...this)},$KC(E){return[this.x,this.y,this.z]=$KC(this,E),this},$DD(E){return[this.x,this.y]=$DD(this,E),this},$pB(E){return new $oC(...$pB(this,E))},$AD(){return $wC([this.x,this.y,this.z],$0B)},$NC(E=1){return[this.x,this.y]=$NC([this.x,this.y],E),this},$1B(E=1){return this.$NC(this.$uC()*E),this},$uC(){return $uC([this.x,this.y])},$SC(E){var[t,T,A]=this.$F();return E.S(A,A),E.T(t,T),this},$F(){var[E,t,T]=this.$pB($d),A=t<0?4/-t*5:0;return[E*=4,t=4*T*A,A]},$5(E=1){var[t,T,A]=this.$F(),s=(t*=A*$CD,T*=A*$CD,1===this.$bB?1:2),n=E?-$CD*s*A:0;return new $oC(t+TV.W2,T+TV.H2+n,s*A*(E?$CD:1))},$M(){var[E,t,T]=this.$5();return $PC().A(E,t,abs(T)).C()},$z(){},$8B(){},$qB(){},$fC(){},$V(){}},"Array"),$HC("$4C",[["$GD",0],["$3",{}],["$x",null],["$6B",null],["$2C",null],["$z",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$2B=($HC("$aC",[["shell",null],["$5B",0],["$TB",0],["$N",1],["$E",1],["$Y",()=>new $oC],["$OB",()=>new $oC],["$a",()=>new $oC(1,1,0)],["$0",[]],["w",0],["a",0],["s",0],["d",0],["$K",2],["$O",[]],["$B",1],["$IB",[]],["$W",0],["$Q",[0,0,0]]],{$f(){return this.$5B?abs(this.$5B):0},$8(){var E=this.$TB%1;return E*=this.$Y.$uC?.()||IN(E,1/32,31/32)?1:0,(this.$N<0?1-E:E)%1},$HB(){return this.$8()?OF(this.$8()%.5,.5)%1:1-bar%.5*2%1},$z(E){E=min(1,E/1e3);let{w:t,a:T,s:A,d:s}=this;var n=$0B(this.x)+128,i=$0B(this.y)+128,e=this.$0.filter(E=>E.$GD<=$GD),e=(e.length?($sB(e,E=>{var t,T,A;E.$6B=E.$6B||E.$GD,E.$x?$uC(this,E.$x)>1/16?(E.$GD=$GD,[T,A]=(t=$NC($pB(E.$x,this),1)).map(abs),$BD(E.$3,t[0]<0?{a:T,d:0}:{a:0,d:T},t[1]<0?{w:A,s:0}:{w:0,s:A})):(E.$2C=E.$GD,E.$3={w:0,a:0,s:0,d:0}):(E.$GD=-1,E.$2C=$GD),$BD(this,E.$3)}),e.length&&({w:t,a:T,s:A,d:s}=this),this.$0=this.$0.filter(E=>!E.$2C||E.$2C>$GD||E.$GD>$GD)):$BD(this,{w:0,a:0,s:0,d:0}),this.$OB=new $oC(s-T,A-t,0),this.$N=$YC(this.$OB.x||this.$N),this.$E=$YC(this.$OB.y||this.$E),new $oC(...this.$OB)),r=new $oC(...this.$Y),R=this.$HB();if(0===e.$uC()&&IN(r.$uC(),1/16,R)&&e.$KC(new $oC(...this.$a).$NC((1-R)/2)),e.$NC(4*E),this.$OB.$uC()){const A=.75+OF(e.$jB().$NC(2).$KC(r.$jB().$NC(1)).$uC(),3)/4;r.$1B(A)}r.$KC(e),r.$NC(min(r.$uC(),this.$K));var I,e=(this.$Y=r).$uC(),h=new $oC(...r);h.$NC(h.$uC()*E);const O=$KC(this,h);this.$eB.length&&!this.$eB.find(E=>$uC($pB(E,O))<E.$r)&&h.$1B(-.5);let a=$0B(this.x+h.x)+128,S=$0B(this.y+h.y)+128;if(n===a&&i===S||((I=world.$yB[S][a])&&I!==this&&(h.$1B(-.1),a=$0B(this.x+h.x)+128,S=$0B(this.y+h.y)+128),world.$yB[i][n]=null,world.$yB[S][a]=this),this.$KC(h),this.$TB+=h.$uC(),this.$5B=e*this.$N,this.$a=e?r.$jB().$NC(1):this.$a,this.$OB.$uC()<.25&&r.$uC()&&r.$1B(this.$HB()<1/8?0:$zC(1-2*E,1)),0===r.$uC()&&this.$8()&&R&&(r.$1B(0),this.$TB=$0B(2*this.$TB)/2),this===$p){const A=$LB(this.$TB/.25);A>this.$W&&$vB("$s",this.$a.x/-2),this.$W=A}}},"$oC"),({$oB:t=512,$IB:s=[]}={})=>{const n=$6C(t),A=t/2,i=t/12,T={R:A,$oB:t,$IB:s,$qB:(E=n)=>(E.DO(()=>{let T=5.6*i;E===n&&E.E().center(),E.P().A(0,0,A).C().F(E.GR(0,2*i,4*i,0,0,t,["#242","#262"])),n.P().A(0,0,T),$v(28,E=>{var[E,t]=$DD([1,0],$WB[28]*(E-.5)-$WB[4]);n.M(E*T,t*T).L(E*A,t*A)}),n.W(n.GR(0,2*i,3*i,0,0,t,["#3536","#4846"]),2),$v(13,E=>{let t=0,T=(E-11)*i*2.25;var A;E<10&&(A=$WB[10]*(E+2.5),[t,T]=$DD([4.5*i,0],A)),n.P().A(t,T,i).C().F("rgba(127,127,127,0.25)"),s[E]&&n.P().A(t,T,i).C().F("#aa9")})}),T),$bC(E){return s[world.$IB.indexOf(E)]=1,T.$qB(),T},get $sC(){return n.$gC}};return T.$qB(),T}),$H=new Map,$KB=($HC("$o",[["$zB",null],["$GB",()=>`hwb(${$0B(30+10*rand.$gB()-2)} ${$0B(0+10*rand())}% ${$0B(47+10*rand())}%)`],["$w",()=>`hwb(${$0B(30+2*rand.$gB()-2)} 0% ${$0B(67+4*rand())}%)`],["$ZB",0],["$UB",[]],["$aB",[]]],{$PC(E,t,T,A,s){var n,i,e,r,R,I,[E,t,T,A,s]=[$qC(E,4),$qC(t,64),T,A,$qC(s[0],4)],A=[E,t,T,A,s].join();return $H.has(A)||(n=$wB(t)/8,i=E?E/8:$wB(t)/16,e=$JB(t)/8,abs(E/16),[t,r]=[E?$7C(t):[0,0],E?$7C(1-t):[0,0]],[[t,r],[R,I]]=[t,r],s=sqrt(abs(s)/(abs(E)||1)),$H.set(A,$PC().A(0+i*s,e-3,1,$e[4],$e).M(0+i*s,e-2).L(2+R/3,n*T-1.5).L(1+t/16,n*T-1).L(1+t*s,r).L(0,e-1).L(-1-R*s,I).L(R/16-1,-1-n*T).L(-2-t/3,-1.5-n*T).C())),$H.get(A)},$qB(i,e=bar%.5*2,r=!0){i.DO(()=>{r&&this.$SC(i);var E=this.$8()%.5,E=E?OF(E%.5,.5):1-e,t=this["$5B"];let T=t?t/8:$wB(E)/16,A=$JB(E)/8,s=abs(t/16);const n=sqrt(abs(this.$Y[0])/(abs(t)||1));this.shell&&0<this.$E&&i.P().A(0-T*n/2,-1.75-A/2+s,7/8).C().W("#242",1/16).F("#131");t=this.$PC(this.$5B,E,this.$N,this.$E,this.$Y);i.WP(this.$w,1/8,t).FP(this.$GB,t),this.shell&&(this.$E<0||$n)&&i.DO(()=>{i.P().A(0-T*n/2,-1.75-A/2+s,7/8).C(),i.W("#242",1/16),i.T(0-T*n/2,-1.75-A/2+s),i.R(this.$Y[0]/16),i.$sC(shell.$sC,-1,-1,2,2)}),$SB.$x})},$8B(){var E,t,T;this.$zB||(this.$zB=this.$AD()),this.$ZB&&!this.$0?.length&&(E=$GD%576,E=$GD-E,t=this.$eB[0],t=$pB(t,this),T=$uC(t),this.$0=[$BD(new $4C,{$GD:288+E+rand.$tC(16),$x:$KC($1B(t,(T-2)/T),this)}),$BD(new $4C,{$GD:528+E+rand.$tC(16),$x:this.$zB}),$BD(new $4C,{$GD:575+E})].filter(E=>E.$GD>=$GD))},$fC(E){return this!==E&&this.$pB(E).$uC()<=4&&(!this.$ZB&&!this.$UB.length||this.$UB.find(t=>$p.$O.find(E=>IS(E,t)))||this.$ZB&&this.$aB.find(t=>$p.$O.find(E=>IS(E,t))))},$V(E){var t,T;this.$ZB||this.$UB.length||($vB("$9C"),this.$ZB=1,t=this.$eB[0],t=$pB(t,this),T=$uC(t),this.$0.push($BD(new $4C,{$GD:$GD+1+rand.$tC(8),$x:$KC($1B(t,(T-2)/T),this)})));const A=$wC(this.$UB,t=>E.$O.find(E=>IS(E,t))).filter(E=>E);if(A.$j){const s=this.$UB.filter(t=>A.find(E=>IS(E,t)));E.$O=E.$O.filter(E=>!A.includes(E)),this.$UB=this.$UB.filter(E=>!s.includes(E))}}},"$aC"),$HC("$b",[["$zB",null],["$CB",1]],{$8B(){if(this.$zB||(this.$zB=this.$AD()),this.$CB){if(!this.$0?.length){var E=$GD%576;const t=$GD-E,T=this.$eB[0],A=this.$pB(T);$uC(A);const s=$WB[14];this.$0=$v(14,E=>$BD(new $4C,{$GD:t+42*E+rand.$tC(4),$2C:t+42*E+42-1,$x:A.$jB().$DD(s*(E+rand()/8)).$KC(T)})).filter(E=>E.$GD>=$GD)}return this}}},"$aC"),$HC("$XB",[["TV",null],["$MC",0]],{$qB(E,t){if(this.TV)return t?E.$sC(this.TV.$gC,0,0,64,64):E.DO(()=>{this.$SC(E),E.$sC(this.TV.$gC,-this.$bB/2,-this.$i,4*this.$bB,4*this.$i)}),this},$fC(E){return 2<this.$cC&&this.$pB(E).$uC()<=4},$z(E){this.$MC=this.$MC||4+rand.$tC(284),$GD>=this.$MC&&this.$cC<this.$xC&&(this.$U(this.$cC+(rand()+1)/8),this.$MC=$GD+576)}},"$oC"),$HC("$nB",[],{$qB(n){n.DO(()=>{this.$SC(n),n.S(this.$N,1);var E=this.$5B,[t,T]=E?$7C(this.$HB()):[0,0],[A,s]=E?$7C(1-this.$HB()):[0,0],[[A,s],[t,T]]=0<this.$N?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$Y[0])/(abs(E)||1));n.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),n.P().M(1,s/4-3).L(2,s/4-2).L(1,s/4-2).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-2).L(.5,s/4-2.5).L(0,s/4-3).C().W("#620",1/8).F("#840"),n.P().A(1,s/4-4,1,$WB[2],1,!0).W("#620",.125)})}},"$b"),$HC("$EB",[],{$qB(n,E,t,T){n.DO(()=>{this.$SC(n),n.S(this.$N,1);var E=this.$5B,[t,T]=E?$7C(this.$HB()):[0,0],[A,s]=E?$7C(1-this.$HB()):[0,0],[[A,s],[t,T]]=0<this.$N?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$Y[0])/(abs(E)||1));n.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),n.P().M(2,s/4-2).L(2,s/4-1).L(1.5,s/4-.5).L(1,s/4-1).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-3).L(1,s/4-2.25).L(1.5,s/4-2.5).C().W("#620",1/8).F("#840"),n.P().A(2,s/4-2.25,.75,$WB[2],$WB[2]+$WB[7]).W("#620",.125)})}},"$b"),$HC("$JC",[["$VB",0],["$r",32],["$GB","#ccf"],["$w","#ccf4"]],{$qB(i){i.DO(()=>{var E,t,{$VB:T,$r:A}=this,s=A-1,n=1.3*A;T&&(E=$AB(cos($WB[28]*T)*n),t=T<14?E:-n,T=14<T?-E:n,i.P().M(0,s).B(T,A,T,-A,0,-s).B(t,-A,t,A,0,s).C().F(this.$GB)),i.P().A(0,0,s).C().W(this.$w,A/16)})},$PB(){return abs(sin($WB[2]*this.$VB/28))}},"$oC"),$HC("$eB",[["$GB",()=>`hwb(${120+rand.$tC(25)} ${10+rand.$tC(5)}% ${$0B(65+rand.$tC(5))}%)`],["$r",16],["$q",[]],["$T",[]],["$P",[]],["$J",null],["$m",null]],{$U(t=16){this.$r=t;rand();return this.$q=$v(16,E=>new $oC(0,-t,0).$DD($WB[16]*(E+rand()/4))),this},$z(t){$sB(this.$P,E=>E.$z(t))}},"$oC"),$HC("$8C",[["TV",null]],{$qB(E){return this.TV||(this.TV=$u({$bB:64,$i:64}).P().M(...rand.XY(1,28)).L(...rand.XY(24,24)).L(...rand.XY(21,12)).L(...rand.XY(31,11)).L(...rand.XY(33,23)).L(...rand.XY(47,14)).L(...rand.XY(53,21)).L(...rand.XY(61,31)).L(...rand.XY(52,44)).L(...rand.XY(42,47)).L(...rand.XY(43,43)).L(...rand.XY(39,48)).L(...rand.XY(16,57)).L(...rand.XY(9,54)).L(...rand.XY(3,42)).C().F(rand.$rC(15,2,17,2,68,4))),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$RC",[["$GB",()=>rand.$rC(150,2,10,6,80,4)],["$xC",8]],{$U(E){return this.$XC=rand.DO(this.$XC,()=>{const n=min(this.$xC,this.$cC=E||this.$cC||4*rand()+3),i=ceil(n);let e=0,r=0,R=0;const t=$v(i,E=>{var t=(n-E)/(n-E+3),T=e-t/.125,A=t*(i-E),s=e+t+.5,E=OF(n-E,i),t=$qC(rand.$gB()*E*t/2),A=(r=max(A,r),`M ${t} ${$qC(T)} L ${$qC(-A)} ${$qC(s)-rand()*E} L ${$qC(R)} ${$qC(e+.25)} L ${$qC(A)} ${$qC(s)-rand()*E} L ${t} `+$qC(T));return R=t,e=T,A}).join(" ")+(" F "+this.$GB);this.$bB=ceil(2*r),this.$i=ceil(abs(e)),this.TV=$6C(this.$bB*$CD*4,this.$i*$CD*4).DO(E=>E.S($CD,$CD).T(this.$bB/2,this.$i).P(t))}),this},$V(E){E.$O.push(new $8C),this.$U(--this.$cC),$vB("beat")}},"$XB"),$HC("$h",[["TV",null],["$VB",0],["$GB",()=>rand.$rC(180,4,33,3,55,4)],["$EC",-1],["$FB",0]],{$U(){const T=this.$FB,A=(this.$bB=4,this.$i=4,this.TV=this.TV??$6C(this.$bB*$CD*4,this.$i*$CD*4),rand.$gB()/4);var E=T?-2:-1.5;const s=rand()/8,n=E+s;return this.TV.DO(E=>{var t;E.E().S($CD,$CD).T(this.$bB/2,this.$i).P().M(-1.5-A,0).B(-2.5,-3,-1,-3,A,s-2).B(1,-3,2.5,-3,1.5+A,0).C().F(this.$GB).P().M(0,0).B(2*-A,-s,4*A,n,A,n).W("#0002",1/8),E.P().A(A,n,T?.75:1/8).F(`hwb(${$0B((180/28*this.$VB+240+rand.$gB()/4)%360)} ${$0B(10+25*rand())}% 5%)`),this.$FB&&(t=$BD(new $JC,{$r:10,$VB:this.$VB,$GB:"#ccf",$w:"#000a"}),E.O(.5).T(1.25*A,n).S(1/16,1/16),t.$qB(E))}),this},$qB(E,t){if(this.TV)return t?E.$sC(this.TV.$gC,0,0,256,256):E.DO(()=>{this.$SC(E),E.$sC(this.TV.$gC,-this.$bB/2,-this.$i,4*this.$bB,4*this.$i)}),E},$z(E,t,T){t=t??moon?.$VB,T=T??$AC;return t!==this.$EC&&.5<=T&&!this.$FB&&(this.$EC=t,this.$FB=+((moon?.$VB??-1)===this.$VB),this.$U()),this},$fC(E){return this.$FB&&this.$pB(E).$uC()<=2},$V(E){var t=$BD(this.$jB(),{TV:null});E.$O.push(t.$U()),this.$FB=0,this.$U(),$vB("$9C")}},"$oC"),$HC("$NB",[["$GB",()=>rand.$rC(120,2,20,2,67,2)],["$xC",4]],{$U(s){return this.$XC=rand.DO(this.$XC,()=>{const T=min(this.$xC,this.$cC=s||this.$cC||3*rand()+1);var E=ceil(T);const A=6*E+1,t="M 2 0 "+$v(A,E=>{var t=(E+.5)/A*PI,E=E%2;return`L ${$qC(2*cos(t)+(E?rand.$gB()/8:0))} `+(E?$qC(sin(t)*-T*2+rand.$gB()/2):-.5)}).join(" ")+" L -2 0 C F "+this.$GB;this.$bB=4,this.$i=2*E,this.TV=$u({$bB:this.$bB*$CD*4,$i:this.$i*$CD*4,os:!0}),this.TV.DO(E=>E.S($CD,$CD).T(this.$bB/2,this.$i).P(t))}),this},$V(E){E.$O.push($BD((new $NB).$U(1),{$cC:1})),this.$U(--this.$cC),$vB("$fB")}},"$XB"),$HC("$c",[["TV",null]],{$qB(E){return this.TV||(this.TV=$u({$bB:64,$i:64}).P().M(...rand.XY(2,32)).B(0,64,0,64,...rand.XY(16,62)).L(...rand.XY(48,62)).B(64,64,64,64,...rand.XY(62,32)).L(...rand.XY(48,32)).L(...rand.XY(48,12)).L(32,12).L(32,16).L(...rand.XY(44,16)).L(...rand.XY(44,32)).L(...rand.XY(20,32)).L(...rand.XY(20,16)).L(32,16).L(32,12).L(...rand.XY(16,12)).L(...rand.XY(16,32)).C().F(rand.$rC(42,2,26,2,43,4)).P().M(...rand.XY(14,38)).L(...rand.XY(28,58)).M(...rand.XY(36,38)).L(...rand.XY(50,58)).M(...rand.XY(52,38)).L(...rand.XY(38,58)).M(...rand.XY(30,38)).L(...rand.XY(16,58)).W("#4404",2)),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$iC",[["TV",null]],{$qB(E){return this.TV||(this.TV=$u({$bB:64,$i:64}).DO(E=>{var t=rand.XY(32,2,2),T=rand.$rC(105,2,12,2,65,2);E.P().M(...t).B(60,4,64,60,...rand.XY(32,60,2)).B(0,60,4,4,...t).F(rand.$rC(70,2,25,2,15,2)).P().M(...rand.XY(32,6,2)).L(...rand.XY(32,50,2)).M(...rand.XY(16,16,2)).L(...rand.XY(48,16,2)).M(...rand.XY(16,32,2)).L(...rand.XY(48,32,2)).M(...rand.XY(16,48,2)).L(...rand.XY(48,48,2)).W("#641",1).P().M(32,64).B(...rand.XY(26,24),...rand.XY(16,24),...rand.XY(2,14)).B(...rand.XY(8,64),...rand.XY(4,54),32,64).B(...rand.XY(38,24),...rand.XY(48,24),...rand.XY(62,14)).B(...rand.XY(56,64),...rand.XY(56,54),32,64).F(T)})),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$lB",[["$GB",()=>rand.$rC(105,2,12,2,65,2)],["$xC",4],["$tB",[]]],{$U(t){return this.$XC=rand.DO(this.$XC,()=>{var E=min(this.$xC,this.$cC=t||this.$cC||3*rand()+1);this.$tB.length=0,this.$tB.push(...$v(max(0,$LB(E-1)),E=>new $iC));const s=2*min(E,3),n=rand.$YC();this.$bB=4,this.$i=$0B(2+s),this.TV=$6C(this.$bB*$CD*4,this.$i*$CD*4).DO(A=>{A.S($CD,$CD).T(2,this.$i).P().M(0,-s).L(0,-1/8).W(this.$GB,.25),$v(3,T=>A.DO(E=>{0===T?A.T(0,-s).R(rand.$gB()/8):A.T(0,-s/2+rand.$gB()/2).R(n*$YC(1.5-T)*$WB[5]);var t=this.$tB[T];t?(0===T?A.T(-1,-1):A.T(-1,-2),A.S(1/$CD,1/$CD).$qB(t,!0)):A.P().M(0,0).B(-.5,-.5,-.5,-.5,0,-1).B(.5,-.5,.5,-.5,0,0).C().F(this.$GB)}))})}),this},$V(E){E.$O.push(this.$tB.pop()),this.$U(--this.$cC),$vB("$fB")}},"$XB"),$HC("$7B",[["TV",null]],{$qB(E){return this.TV||(this.TV=$u({$bB:64,$i:64}).P().M(...rand.XY(2,58)).L(...rand.XY(4,61)).L(...rand.XY(61,9)).L(...rand.XY(58,6)).C().F(rand.$rC(15,2,17,2,68,4)).P().M(...rand.XY(7,4)).L(...rand.XY(7,8)).L(...rand.XY(58,61)).L(...rand.XY(61,58)).L(...rand.XY(18,18)).L(...rand.XY(20,12)).L(...rand.XY(18,10)).L(...rand.XY(16,16)).C().F(rand.$rC(15,2,17,2,68,4))),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$iB",[["$GB",()=>rand.$rC(105,2,12,2,65,2)],["$xC",4]],{$U(s){return this.$XC=rand.DO(this.$XC,()=>{const t=min(this.$xC,this.$cC=s||this.$cC||3*rand()+1);var E=ceil(t);const T=2*E+1,A="M 2 0 "+$v(T,E=>{E=(E+.5)/T*PI;return`L ${$qC(2.75*cos(E)+rand.$gB()/2)} `+$qC(sin(E)*-t+rand.$gB()/4)}).join(" ")+` L -2 0 C F ${this.$GB} W #1324 0.125`;this.$bB=6,this.$i=2*E,this.TV=$u({$bB:this.$bB*$CD*4,$i:this.$i*$CD*4,os:!0}),this.TV.DO(E=>E.S($CD,$CD).T(this.$bB/2,this.$i).P(A))}),this},$V(E){E.$O.push(new $7B),this.$U(--this.$cC),$vB("$fB")}},"$XB"),$HC("$VC",[["TV",null],["$GB",()=>rand.$rC(32,3,37,4,55,4)]],{$U(){return this.$XC=rand.DO(this.$XC,()=>{this.TV=$6C(64).P().M(...rand.XY(4,60,3)).L(...rand.XY(9,32,4)).L(...rand.XY(16,16,7)).L(...rand.XY(32,20,8)).L(...rand.XY(48,16,6)).L(...rand.XY(53,32,4)).L(...rand.XY(60,60,3)).L(57,64).L(7,64).C().F(this.$GB).W("#332",1),this.$bB=1,this.$i=1}),this},$qB(E,t){return this.TV||this.$U(),t?E.$sC(this.TV.$gC,0,0,64,64):E.DO(()=>{this.$SC(E),E.$sC(this.TV.$gC,-this.$bB/2,-this.$i,this.$bB,this.$i)}),this},$fC(E){return this.$pB(E).$uC()<=4},$V(E){E.$O.push(this);var[E,t]=this.$AD(),t=(world.$yB[t+128][E+128]=null,this.$eB[0].$T),E=world.$T;t.splice(t.indexOf(this),1),E.splice(E.indexOf(this),1),$vB("$fB")}},"$oC"),$HC("$X",[["TV",null]],{$qB(E){}},"$oC"),$HC("$4",[["TV",null]],{$qB(E){return this.TV||(this.TV=$6C(64).P().A(24,24,20,PI/2,PI).L(...rand.XY(48,8)).C().F(rand.$rC(32,3,37,4,55,4)).P().M(...rand.XY(24,8)).L(...rand.XY(20,12)).L(...rand.XY(59,61)).L(...rand.XY(61,59)).C().F(rand.$rC(15,2,17,2,68,4))),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$dC",[["TV",null]],{$qB(E){return this.TV||(this.TV=$6C(64).P().M(64,32).L(...rand.XY(52,25)).L(54,32).L(...rand.XY(52,39)).C().F(rand.$rC(32,3,37,4,55,4)).P().M(20,32).L(...rand.XY(17,28)).L(0,28).L(4,32).L(0,36).L(...rand.XY(17,36)).C().F("#fffc").P().M(3,32).L(59,32).M(...rand.XY(20,4)).L(...rand.XY(20,60)).W(rand.$rC(15,2,17,2,68,4),2).P().A(20,32,29,-PI/2-1/8,PI/2+1/8).W(rand.$rC(15,2,17,2,68,4),4)),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$y",[["TV",null],["$GB",()=>rand.$rC(46,3,30,5,40,4)]],{$U(){return this.$XC=rand.DO(this.$XC,()=>{const t=rand.XY(32,16,5),T=rand.XY(32,38,3),A=3*rand.$gB(),s=rand.$rC(10,3,11,3,50,4),n=this.$GB,i=rand.$rC(46,3,5,2,75,4);this.TV=$6C(512).S(8,8).DO(E=>E.P().M(3+A,64).L(...t).L(61+A,64).C().F(E.GR(32,0,16,32,-32,112,[s,n,n,n,s])).W(s,.5).P().M(21+A,64).L(...T).L(43+A,64).C().F(i).P().M(t[0]-4,t[1]-7).L(...t).L(t[0]+5,t[1]-8).W(i,1)),this.$bB=8,this.$i=8}),this},$qB(E,t){return this.TV||this.$U(),t?E.$sC(this.TV.$gC,0,0,64,64):E.DO(()=>{this.$SC(E),E.$sC(this.TV.$gC,-this.$bB/2,-this.$i,this.$bB,this.$i)}),this}},"$oC"),$HC("$4B",[["TV",null]],{$qB(E){return this.TV||(this.TV=$6C(64).P().M(...rand.XY(3,8)).L(...rand.XY(6,3)).L(...rand.XY(48,45)).L(...rand.XY(45,48)).C().F(rand.$rC(15,2,17,2,68,4)).P().M(...rand.XY(63,63)).L(...rand.XY(59,47)).L(...rand.XY(42,42)).L(...rand.XY(47,59)).C().F(rand.$rC(32,3,37,4,55,4))),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$A",[["TV",null]],{$qB(E){return this.TV||(this.TV=$6C(64).P(),this.TV.DO(t=>{$v(4,E=>{t.M(...$KC([32,28],$DD([0,26],$WB[12]*E))).L(...$KC([32,28],$DD([0,26],$WB[12]*(E+4)))).L(...$KC([32,28],$DD([0,26],$WB[12]*(E+8)))).L(...$KC([32,28],$DD([0,26],$WB[12]*E)))}),t.W("#ffcc",1).P().M(6,28).L(2,47).L(6,63).L(10,50).L(6,28).M(58,28).L(54,52).L(58,63).L(62,53).L(58,28).F("#fffc").P().A(32,28,26).W(rand.$rC(15,2,17,2,68,4),4)})),E.$sC(this.TV.$gC,0,0,64,64),E}},"$oC"),$HC("$hB",[["TV",null]],{$qB(E){}},"$oC"),$HC("$rB",[["$BC",null],["OK",[]],["DO",()=>{}]],{},"$oC"),new Map),ww=($HC("$xB",[["$vC",()=>new $8C],["O",()=>rand()],["$rB",null]],{$qB(s,E){s.DO(()=>{this.$SC(s);var E,t,T,A=$qC((this.O+bar%.5*2)%1,64);s.DO(()=>s.T(-1.5,-2).S(1/32,1/32).$qB(this.$vC)),s.DO(()=>s.T(1.5,-1.75).S(-1/32,1/32).$qB(this.$vC)),$KB.has(A)||(E=$6C(128,256),t=$wB(A),T=$wB((A+.25)%1),E.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$WB[2]).B(-1,-2.5-T/2,0+t,-2.5-T,0-t/2,-3.5).B(0-t,-2.5-T,1,-2.5-T/2,1,-1.5).F(s.GR(0,-1.25,.5+T/8,0,0,4-T/4,["#ff0a","#e206","#d004"])),$KB.set(A,E)),s.$sC($KB.get(A).$gC,-1,-4,2,4)})},$fC(E){return!(this.$eB[0].$T.filter(E=>IS(E,$o)).find(E=>!E.$ZB)||!this.$rB)},$V(E){var t=this["$rB"];t&&($p.$IB.push(t),$p.shell.$bC(t),DJ.$ZC($wC($p.shell.$IB,(E,t)=>E?t+1:null).filter(E=>E)),this.$rB=0,$vB("$9C"),$vB("$fB"))}},"$oC"),$HC("$cB",[["$XC",13],["$cC",0],["$IB",[]],["$RB",[]],["$2",[]],["$g",[]],["$yB",()=>$v(256,E=>$v(256,E=>null))],["$DB",[]],["$wC",null],["$LB",null],["$9",[]],["$T",[]],["$P",[]],["$D",[]],["$J",null],["$m",null]],{$U(E){this.$wC=this.$wC||$u({$bB:256,$i:256,os:!0}),this.$LB=this.$LB||$u({$bB:256,$i:256,os:!0}),this.$XC=E,rand.$XC(E);var[E,t]=rand.$6([$c,$4]),[T,A]=rand.$6([rand.$6([$4B,$EB,$lB]),rand.$6([$dC,$nB,$y])]);this.$IB=[$o,E,...T,$hB,...A,t,...rand.$6([$X,$A]),$2B],this.$J=$J(),this.$m=$m();this.$RB=$v(28,E=>(new $eB).$U(12).$KC([96,0,0]).$DD(E*$WB[28]-$WB[4])),this.$2=$v(13,E=>{E=E<10?(new $eB).$U(18).$KC([80,0,0]).$DD($WB[10]*(E+2.5)):(new $eB).$U(18).$KC([0,16*(E-11)*2.5,0]);return E.$J=$J(),E.$m=$m(),E}),this.$g=$v(3,E=>[$BD((new $eB).$U(16).$KC([0,56,0]).$DD($WB[16]*(2*E+2)),{$m:$m()}),$BD((new $eB).$U(16).$KC([0,56,0]).$DD($WB[16]*(2*E+10)),{$m:$m()})]).flat();const s=this.$2[this.$IB.indexOf($EB)];E=this.$g.find(E=>E.$pB(s).$uC()<E.$r+s.$r);const n=this.$2[this.$IB.indexOf($nB)];T=this.$g.find(E=>E.$pB(n).$uC()<E.$r+n.$r);$sB([[E,$EB,$NB],[T,$nB,$RC]],([T,t,A])=>{T.$T.push(...$v(7,E=>$BD((new t).$KC([0,12,0]).$DD($WB[7]*(E+rand()/8)).$KC(T),{$eB:[T]}))),$v(32,E=>{const t=new $oC(0,-T.$r,0).$DD($WB[32]*(E+rand.$gB()/4));this.$2.filter(E=>t.$jB().$KC(T).$pB(E).$uC()<=E.$r+.05).length<1?((E=(new A).$U().$KC(T).$KC(t)).$eB.push(T),T.$P.push(E),this.$P.push(E)):((E=(new $VC).$U().$KC(T).$KC(t)).$eB.push(T),T.$T.push(E),this.$T.push(E))})});const i=this.$2[this.$IB.indexOf($lB)],e=this.$g.reduce((E,t)=>!E||E.$pB(i).$uC()>t.$pB(i).$uC()&&0===t.$T.length?t:E,null),r=($v(13,E=>{E=(new $lB).$U().$KC([4+rand.$tC(7),0,0]).$DD($WB[13]*E).$KC(e);E.$eB.push(e),e.$P.push(E),this.$P.push(E)}),this.$DB=[...this.$RB,...this.$2,...this.$g],$sB(this.$RB,(T,E)=>{T.$LC="moon "+E,$sB(T.$q,t=>{var E;this.$DB.filter(E=>t.$jB().$KC(T).$pB(E).$uC()<=E.$r+.05).length<2&&((E=(new $RC).$U().$KC(T).$KC(t)).$eB.push(T),T.$P.push(E),this.$P.push(E))});E=$BD(new $h,{x:T.x,y:T.y,$VB:E}).$z(0,0,.5);T.$P.push(E),this.$P.push(E)}),$sB(this.$2,(A,E)=>{var t=(new $xB).$KC(A);t.$rB=this.$IB[E],A.$T.push(t),t.$eB.push(A),$v(3,E=>{var E=$WB[3]*(E+rand.$gB()/8),t=10+rand.$tC(2),T=(new $o).$KC(new $oC(0,t,0).$DD(E).$KC(A)),t=(new $y).$KC(new $oC(0,t+2,0).$DD(E+$WB[32]*rand.$YC()).$KC(A));$sB(([])=>E=>{var{x:t,y:T}=this.$AD();$BD(E,{x:t,y:T})}),A.$T.push(T,t),$sB([t,T],E=>E.$eB.push(A))}),12!==E&&$v(32,E=>{const t=new $oC(0,-A.$r,0).$DD($WB[32]*(E+rand.$gB()/4));this.$DB.filter(E=>t.$jB().$KC(A).$pB(E).$uC()<=E.$r+.05).length<2&&((E=new(rand.bit()?$NB:$iB)).$U().$KC(A).$KC(t),E.$eB.push(A),A.$P.push(E),this.$P.push(E))})}),this.$T.push(...$wC(this.$DB,E=>E.$T).flat().sort($I)),this.$wC.DO(A=>{A.E().center(),$sB(this.$DB.filter(E=>!this.$g.includes(E)),T=>{A.P(),$sB(T.$q,(E,t)=>(t?A.L:A.M)(E[0]+T.x,E[1]+T.y)),A.C().F(A.GR(0,90,90,0,0,256,["#242","#262"])).O(.25).W(A.GR(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this)["$LB"],R=(r.P().A(128,128,108).W("#202",16).C().P().A(128,102,40).F(this.$LB.GR(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])).P().A(128,164,22).F(this.$LB.GR(128,164,16,128,160,30,["#fff8","#fff4"])),r.P(),$sB(this.$g,E=>r.M(E.x+128,E.y+128).A(E.x+128,E.y+128,16)),r.F(r.GR(128,128,48,128,108,192,["#141","#263"])),this.$LB.$sC(this.$wC.$gC,0,0,256,256),$BD(new $JC,{$r:10}));return $sB(this.$RB,(t,E)=>{$BD(R,{$VB:E}),this.$LB.DO(E=>{E.T(128+t.x,128+t.y).O(.875).P().A(0,0,t.$r).F(t.$GB).O(.125),R.$qB(E)})}),this.$LB.DO(E=>{E.center(),$sB(this.$P.filter(E=>!(E instanceof $h)),E=>this.$LB.P().A(E.x,E.y+.5,1.25).F(E.$GB))}),$sB([...this.$T,...this.$P,$p],E=>{E.y=$BB(E.y),E.x=$BB(E.x),this.$yB[E.y+128][E.x+128]=E,IS(E,$y)&&(this.$yB[E.y+128][E.x+127]=E,this.$yB[E.y+128][E.x+129]=E)}),this},$WC(){},$FC(){},$z(t){const T=this.$DB.filter(E=>$uC($pB(E,$p))<E.$r);return(T.find(E=>!$p.$eB.includes(E))||$p.$eB.find(E=>!T.includes(E)))&&($p.$eB=T,DJ?.$MB?.((T.find(E=>E.$J)||this).$J,(T.find(E=>E.$m)||this).$m)),$sB(this.$DB,E=>E.$z(t)),this},$qB(t){this.$D.length=0;var T=-t.W2/$CD,A=t.W1/$CD;let s=1;const n=max(0,$0B($d.y));for(let E=n;E<=min(256,$0B($d.y+132));E+=1){s&&t.O(1-s);const n=new $oC($d.x,E-128,0).$5(0);var i=n[2];if(0===i)break;var e=i*$CD*2,r=max(0,$LB($d.x+128-t.W2/e)-4);min(256-r,ceil(t.W1/e)+8);t.$sC(this.$LB.$gC,$d.x+128-t.W2/e,E,t.W1/e,1,T,(n[1]-t.H2)/$CD,A,2*i),$sB($1C(this.$yB[E].filter(E=>E),$I),E=>{E.$qB(t),E.$fC?.($p)&&this.$D.unshift(E)}),s&&(t.O(1),s=max(0,s-i/4))}return t.$gC}},"$oC")),TV=$u();let moon=new $JC,sun=$FD(32,"#ffd"),rand=$YB(13),stars=$v(91,()=>[rand.$gB(),rand.$gB()]),shell=$2B(),$p=$BD(new $o,{x:0,y:104,z:0,shell:shell,$E:-1,$GB:"#840",$w:"#620"}),$SB=new $oC,world=($SB.$PC=$PC().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $cB).$U(13)),$d=new $oC($p.x,$p.y+$C,$p.z+$L);const $5C=t=>{$n||(D+=t*$TC,$AC=D%$hC/$hC,measure=$LB(D/4e3),bar=D%4e3/4e3,beat=$LB(8*bar),$GD=$LB(D/250),$EC!==$GD&&$vB("tick"),$EC=$GD,step=D%$eC/$eC,$DC.change&&$p.$0.unshift($BD(new $4C,{$GD:$GD,$3:$DC.$KC})),$DC.shift?$p.$K=4:$p.$K=2,world.$z(t),$p.$z(t),$sB(world.$T,E=>E.$8B?.()),$sB(world.$T,E=>E.$z?.(t))),$d.x+=($p.x-$d.x)/16,$d.y+=($p.y+($n?$C:$G)-$d.y)/16,$d.z+=($p.z-$d.z+($n?$L:$R))/16};let $IC=$v(256,E=>[E,E]).flat().map(E=>E/$CD);const $GC=(E=0)=>{performance.now();var t=E-now;now=E,$5C(t*$TC);const{H1:T,H2:e,H3:A,W1:s,W2:r,W3:n,R3:R,RM:I}=TV;E=$AC,t=E;const h=(E+.5)%1;moon.$VB=D?$LB((28+(D-$1()*$hC)/$hC)%28):0;let O=$7(t)*n;const a=$Z(t);let S=$7(h)*n;const L=$Z(h);.5<E?O=-S:S=-O;let N;TV.DO(()=>{if(TV.E(),TV.ctx.fillStyle=.1<a?"#840":"#202",TV.ctx.fillRect(0,0,s,T),TV.center(),.25<L){const i=A-L*A*2;$sB(stars,([E,t])=>{var T=E*r,A=(t-h)*e,s=OF($uC([S,i],[T,A]),4*moon.$r),n=1+.5*sin((7.3*t+now%$hC/$hC+1.1*E)*$e),t=(1+n)**2*max(0,sin(7.3*t+now/$hC*130+11*E)**3);TV.O(max(0,1-moon.$PB()/2-(s<.25?1:1-s))).P().A(T,A,n).F("#ffd").C(),TV.P().M(T,A-t).L(T,A+t).M(T-t,A).L(T+t,A).W("#ffd",.5)}),N=`rgba(204,204,255,${$qC(.1*moon.$PB())})`,TV.O(max(0,L)).P().A(S,i,2*I).C().F(TV.GR(S,i,R*moon.$PB(),S,i,2*R,[`rgba(204,204,255,${$qC(.05+.2*moon.$PB())})`,N,N,"rgba(24,0,24,0)"])).T(S,i),moon.$qB(TV),N="#ccf6"}.25<a&&(TV.O(max(0,a)),N="#aae6",TV.P().A(O,A-a*A*2,2*I).C().F(TV.GR(O,A-a*A*2,sun.R*max(a,0),O,A-a*A*2,I,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$sC(sun.$sC,O-sun.R,A-a*A*2-sun.R,sun.D,sun.D))}),TV.DO(()=>{TV.T(r,e),TV.S($CD,$CD),world.$qB(TV)}),TV.DO(()=>TV.T($SB.x-2,$SB.y-2).S(4,4).R($e*$wB(now%4e3/4e3)).FP("#280c",$SB.$PC)),$SB.$x=$n?null:world.$D.find(E=>TV.ctx.isPointInPath(E.$M(),$SB.x,$SB.y)),$SB.$x&&TV.DO(()=>{var E=$SB.$x.$M();TV.ctx.setLineDash([13,7]),TV.ctx.lineDashOffset=now/1e3*20,TV.WP("#280",1,E)});const i=$p.$O.length;$sB($p.$O,(t,E)=>{const T=(TV.W1-128)/(i+1)*(E+1)+32,A=TV.H1-128;TV.DO(E=>t.$qB(E.T(T,A).P().RR(0,0,64,64,4).C().F("#fff4"),!0))}),$n&&(TV.ctx.fillStyle="#0f0",TV.ctx.font="32px monospace",$sB(["wasd = move","shift = run","esc = pause/resume","mouse = interact",DJ?"- paused -":"click to play"],(E,t)=>TV.ctx.fillText(E,TV.W2-TV.ctx.measureText(E).width/2,32*(t+1)))),requestAnimationFrame($GC)},$DC=($GC(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $KC(){var{w:E,a:t,s:T,d:A}=this;return{w:E,a:t,s:T,d:A}}}),$l=($OC("mousedown",()=>$n=!1),ON("click",()=>$SB.$x?.$V($p)),ON("keydown",E=>{$vB("input");E=E.key.toLowerCase();$DC[E]=1,$vB("key-"+E),"escape"===E&&($n=!$n,$vB("pause"))}),ON("keyup",E=>$DC[E.key.toLowerCase()]=0),ON("mousedown",()=>$vB("input")),ON("mousemove",({clientX:E,clientY:t})=>$BD($SB,{x:E,y:t})),ON("resize",()=>{TV.$t(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$sB(["visibilitychange","blur"],E=>ON(E,()=>{$sB(Object.keys($DC),E=>$DC[E]=0)})),(E,t,T)=>E.addEventListener(t,T));$sB(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],t=>$l(document,t,(...E)=>$vB(t,...E))),$sB(["resize","blur"],t=>$l(window,t,(...E)=>$vB(t,...E))),$l(document,"click",()=>DJ=DJ||$3B()),document.body.appendChild(TV.$UC);})()