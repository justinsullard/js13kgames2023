(()=>{const $rC="js13kgames2023-13drums";let now=0,$bC=500,$eC=144e3,D=0,$xB=0,$ED=0,$BC=0,measure=0,beat=0,bar=0,step=0,$l=!0,$QC=1,$AD=32,$G=20,$R=-2,$C=4,$L=-1/8;const{cos,sin,min,max,sqrt,floor:$JB,ceil,round:$YB,imul,abs,PI,sign:$VC}=Math,$t=(E=0,t=E=>E)=>new Array(E).fill(0).map((E,t)=>t).map(t),$BD=([E,t],T)=>[E*cos(T)-t*sin(T),E*sin(T)+t*cos(T)],$HC=([E,t,T],[A,s,n])=>[E+A,t+s,T+n],$mB=([E,t,T],[A,s,n])=>[E-A,t-s,T-n],$nC=(E,t=1e3)=>$YB(E*t)/t,OF=(E,t)=>E<t?E/t:1,$xC=(E,t)=>max(0,OF(E,t)),IN=(E,t,T)=>t<E&&E<T,IS=(E,t)=>E instanceof t,$YC=(E,t=(E,t)=>E-t)=>E.sort(t),$ZB=([E,t],T=1)=>[E*T,t*T],$KC=([E,t],T=1)=>{T/=$sC([E,t])||1;return[E*T,t*T]},$sC=([E,t],[T=0,A=0]=[])=>sqrt((T-E)**2+(A-t)**2),$y=E=>(0<E?$JB:ceil)(E),$bB=E=>(E<0?$JB:ceil)(E),$z=E=>$VC(E)*$YB(abs(E)),$d=2*PI,$UB=$t(128,E=>E?$d/E:0),$zC=(...E)=>Object.assign(...E),$pB=(E,t)=>E.forEach?.(t),$uC=(E,t)=>E.map(t),$I=(E,t)=>E.y-t.y||E.z-t.z||E.x-t.x,$mC=E=>1+2.70158*(E-1)**3+1.70158*(E-1)**2,$iC=E=>E*E*(2.70158*E-1.70158),$jC=E=>1-cos(E*PI/2),$rB=E=>-(cos(PI*E)-1)/2,$HB=E=>sin(E*PI),$tB=E=>sin(E*$d),$gC=2.5949095,$hC=$d/4.5,$0=()=>min(500/$eC,.05),$Y=E=>{let t=max(0,sin(E*$d)),T=$0();return T<E&&E<=2*T?t+=2*$mC((E-T)/T):2*T<E&&E<.5?t+=2:.5<=E&&E<.5+T&&(t+=2-2*$iC((E-.5)/T)),t/3},$6=E=>2*$rB(OF(E,.5))-1,$4C=E=>[(min(2*E,0)-(1-cos(E*$d)))/2,-$jC(-min(sin(E*$d),0))/2],$WB=(E=0)=>{let A=0|E;return let=fn=()=>{var E=(A=A+2654435769|0)^A>>>16,E=imul(E,569420461);return E^=E>>>15,(((E=imul(E,1935289751))^E>>15)>>>0)/4294967296*2},$zC(fn,{$UC:E=>void 0!==E?A=0|E:A,$qC:(E=1)=>$YB(fn()*E),$eB:()=>1-2*fn(),$VC:()=>$bB(fn.$eB()),bit:()=>$YB(fn()),bool:()=>!!$YB(fn()),$5:E=>E.slice().sort(fn.$eB),$NC:E=>E[$y(fn()*E.length)],$oC:(E,t,T,A,s,n)=>`hwb(${$YB(E+fn.$eB()*t)} ${$YB(T+fn.$eB()*A)}% ${$YB(s+fn.$eB()*n)}%)`,XY:(E,t,T=1)=>[E+fn.$eB()*T,t+fn.$eB()*T],DO:(E,t)=>{var T=A;return A=0|(E??A),t(),A=T,E??T}})},$0C=new Map,$CD=E=>($0C.has(E)||$0C.set(E,new Set),$0C.get(E)),ON=(E,t)=>$CD(E).add(t),$wC=(E,t)=>$CD(E).delete(t),$sB=(E,...t)=>$pB([...$CD(E)],E=>E(...t)),$LC=(t,T)=>{let A=(...E)=>{$wC(t,A),T(...E)};ON(t,A)};let DJ=0;const $XC=(E=0,t=0,T=16)=>{let A=E?T/E:0;return $YC($t(E,E=>$JB(E*A+t+T)%T))},CM=$XC(7,2,12),$7B=32/27,Q=$t(51,E=>440*2**((E-36)/12)).filter((E,t)=>CM.includes(t%12)).slice(2),$OB=(E,t=[])=>$YC([...new Set([...E,...t])]),$J=()=>{let T=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$t(13,E=>{let t=rand.$NC(T);return T=T.filter(E=>E!==t),[t,.05+.15*rand(),rand.$eB(),$XC(1+rand.$qC(),rand.$qC(15))]})]},$j=()=>[Q[15],...rand.$5(Q.slice(16))].slice(0,8),$6C=(E,t,T,A,s,n,i=6)=>{const e=E.createOscillator();var R=E.createGain(),E=E.createStereoPanner();e.frequency.setValueAtTime(A/$7B,n),$pB($XC(i,2),(E,t)=>e.frequency.exponentialRampToValueAtTime(t%2?T*$7B:T/$7B,n+t/8)),R.gain.setValueAtTime(.1*A,n),R.gain.exponentialRampToValueAtTime(.5*A,n),R.gain.exponentialRampToValueAtTime(A,n+.325),R.gain.exponentialRampToValueAtTime(.01,n+2),E.pan.setValueAtTime(s,n),E.pan.exponentialRampToValueAtTime(-s,n+2),e.connect(R),R.connect(E),E.connect(t),e.start(n),e.stop(n+2)},$dB=(E,t,T,A,s,n,i,e)=>{var R=E.createOscillator(),r=E.createGain(),I=E.createStereoPanner(),E=E.createDynamicsCompressor(),i=$nC(i||A);R.frequency.setValueAtTime(T,n),R.frequency.exponentialRampToValueAtTime(T/1.5,n+.5),r.gain.setValueAtTime(.01,n),r.gain.exponentialRampToValueAtTime(i,n+1/32),r.gain.exponentialRampToValueAtTime(i/5,n+1/16),r.gain.linearRampToValueAtTime(0,n+.5),I.pan.setValueAtTime(e??s,n),E.threshold.setValueAtTime(-50,n),E.knee.setValueAtTime(40,n),E.ratio.setValueAtTime(12,n),E.attack.setValueAtTime(0,n),E.release.setValueAtTime(.25,n),R.connect(r),r.connect(I),I.connect(E),E.connect(t),R.start(n),R.stop(n+.51)},$q=(E,t,T,A=0,s)=>{var n=.04+.03*rand(),i=1/8+rand()/16,e=E.createOscillator(),R=E.createGain(),E=E.createStereoPanner();e.type="triangle",e.frequency.setValueAtTime(T,s),R.gain.setValueAtTime(n,s),R.gain.exponentialRampToValueAtTime(n/2,s+1/32),R.gain.linearRampToValueAtTime(0,s+i),E.pan.setValueAtTime(A,s),e.connect(R),R.connect(E),E.connect(t),e.start(s),e.stop(s+i)},$1B=()=>{const n=new AudioContext,i=n.createAnalyser(),E=(i.connect(n.destination),i.fftSize=256,i.frequencyBinCount),t=new Uint8Array(E);let T=-$nC(D/4e3,10)%1,e=T,A=[0],R=[],s=[],r=null,I=null;var h=(E=$J(),t=$j())=>{r=E,I=t};return setInterval(()=>{n.currentTime+.25<e||e<0||(r&&(R=r,r=null),I&&(s=I,I=null),$6C(n,i,(s[7-(beat+measure%8)%8]||2*Q[rand.$qC(6)])/2,.2,.5*rand.$eB(),e,$JB(e-T)%3+4),$pB(A,E=>{const[t,T,A,s]=R[E];$pB(s,E=>$dB(n,i,t,$nC(T),A,.25*E+e))}),e+=4)},100),ON("$q",(E=0)=>{$q(n,i,(s[beat]||Q[15])/2,"number"==typeof E?E:0,n.currentTime)}),ON("$dB",()=>{var[,E,t,,]=R[0];$dB(n,i,Q[14],E,t,n.currentTime)}),ON("$6C",()=>$6C(n,i,2*(s[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$eB(),n.currentTime,6)),ON("pause",()=>{"running"===n.state&&$l?n.suspend():"suspended"!==n.state||$l||n.resume()}),h(),{$KB:h,n:e,get track(){return R},get voices(){return A},get melody(){return s},get $iB(){return i.getByteFrequencyData(t),Array.from(t).slice(0,E/2)},$WC:(E=[],t)=>{A=$OB([0,...E]),s=t||s}}},$MC=($s=({$9B:E=min(1920,window.innerWidth),$h:t=min(1080,window.innerHeight),os:A=!1}={})=>{let s=A?null:document.createElement("canvas"),n=(s&&(s.width=E,s.height=t),A?new OffscreenCanvas(E,t):s.transferControlToOffscreen()),e=n.getContext("2d");n.width=E,n.height=t;const R={get W1(){return n.width},get W2(){return n.width/2},get W3(){return n.width/3},get H1(){return n.height},H2:n.height/2,get H3(){return n.height/3},get R3(){return min(R.H3,R.W3)},get Rm(){return min(R.H1,R.W1)},get RM(){return max(R.H1,R.W1)},$dC:n,$RC:s,ctx:e,$r:(E,t)=>{var T;A||(T=document.createElement("canvas"),s.replaceWith(T),(s=T).width=E,T.height=t,n=s.transferControlToOffscreen(),e=n.getContext("2d"),$zC(R,{$dC:n,ctx:e,$RC:s})),n.width=E,n.height=t,R.H2=n.height/2},DO:E=>(e.save(),E(R),e.restore(),R),E:()=>(e.clearRect(0,0,R.W1,R.H1),R),center:()=>(R.T(R.W2,R.H2),R),FX:(E="none")=>(e.filter=E,R),T:(E,t)=>(e.translate(E,t),R),R:E=>(e.rotate(E),R),RR:(...E)=>(e.roundRect(...E),R),M:(...E)=>(e.moveTo(...E),R),L:(...E)=>(e.lineTo(...E),R),A:(E=0,t=0,T=1,A=0,s=$UB[1],n=!1)=>(e.arc(E,t,T,A,s,n),R),B:(...E)=>(e.bezierCurveTo(...E),R),P:E=>(e.beginPath(),E?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(E=>{var[E,...t]=E.includes("(")?[E[0],E.slice(1).trim()]:E.split(" ");R[E](...$uC(t,E=>"#"===E[0]||E.includes("(")?E:parseFloat(E,10)))}),R),C:()=>(e.closePath(),R),O:E=>(e.globalAlpha=E,R),S:(E=1,t=1)=>(e.scale(E,t),R),GS:(T,A)=>$pB(A,(E,t)=>T.addColorStop(t/A.length,E)),GL:(E,t,T,A,s)=>{E=e.createLinearGradient(E,t,T,A);return R.GS(E,s),E},GR:(E,t,T,A,s,n,i)=>{E=e.createRadialGradient(E,t,T,A,s,n);return R.GS(E,i),E},F:E=>(e.fillStyle=E,e.fill(),R),FP:(E,t)=>(e.fillStyle=E,e.fill(t),R),W:(E,t)=>(e.strokeStyle=E,e.lineWidth=t,e.stroke(),R),WP:(E,t,T)=>(e.strokeStyle=E,e.lineWidth=t,e.stroke(T),R),$pC:(...E)=>(e.drawImage(...E),R)};return R.E(),R.$nB=(E,t)=>E.$nB(R,t),R},()=>{const i=new Path2D;return i.M=(...E)=>(i.moveTo(...E),i),i.L=(...E)=>(i.lineTo(...E),i),i.A=(E=0,t=0,T=1,A=0,s=$UB[1],n=!1)=>(i.arc(E,t,T,A,s,n),i),i.AT=(...E)=>(i.arcTo(...E),i),i.B=(...E)=>(i.bezierCurveTo(...E),i),i.Q=(...E)=>(i.quadraticBezierCurveTo(...E),i),i.C=()=>(i.closePath(),i),i}),$3C=(E,t)=>$s({$9B:E,$h:t||E,os:!0}),$DD=(t=32,E="#840")=>{const T=$3C(3*t),A=t/4,s=1.4*t;return T.DO(()=>{T.E().center().P().A(0,0,t).C().F(E).P().M(-s,-A).L(s,-A).M(-s,A).L(s,A).M(-A,-s).L(-A,s).M(A,-s).L(A,s).W(E,3)}),{R:1.5*t,D:3*t,get $pC(){return T.$dC},$nB(E){E.$pC(T.$dC,0,0,2*t,2*t)}}},$EC=(Array.$S=()=>[],(a,d,m={},p="$lC")=>{const dd=window[p].$S?.()??[],o=dd.length,dv=$uC(d,([,E])=>"function"==typeof E?E.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(E)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $S=()=>[...${p}.$S(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$S()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$uC(d,([E],t)=>`  get ${E}(){return this[${t+o}]} set ${E}(x){return this[${t+o}]=x}`).join("")+$uC(Object.values(m),E=>E.toString()).join("")+"};";return eval(e)}),$zB=($EC("$lC",[["x",0],["y",0],["z",0],["$9C",0],["$cB",[]],["$UC",null],["$9B",0],["$h",0]],{$gB(){return new this.constructor(...this)},$HC(E){return[this.x,this.y,this.z]=$HC(this,E),this},$BD(E){return[this.x,this.y]=$BD(this,E),this},$mB(E){return new $lC(...$mB(this,E))},$yC(){return $uC([this.x,this.y,this.z],$YB)},$KC(E=1){return[this.x,this.y]=$KC([this.x,this.y],E),this},$ZB(E=1){return this.$KC(this.$sC()*E),this},$sC(){return $sC([this.x,this.y])},$PC(E){var[t,T,A]=this.$F();return E.S(A,A),E.T(t,T),this},$F(){var[E,t,T]=this.$mB($c),A=t<0?4/-t*5:0;return[E*=4,t=4*T*A,A]},$4(E=1){var[t,T,A]=this.$F(),s=(t*=A*$AD,T*=A*$AD,1===this.$9B?1:2),n=E?-$AD*s*A:0;return new $lC(t+TV.W2,T+TV.H2+n,s*A*(E?$AD:1))},$M(){var[E,t,T]=this.$4();return $MC().A(E,t,abs(T)).C()},$x(){},$6B(){},$nB(){},$cC(){},$V(){}},"Array"),$EC("$1C",[["$ED",0],["$2",{}],["$v",null],["$4B",null],["$ZC",null],["$x",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$0B=($EC("$7C",[["shell",null],["$3B",0],["$RB",0],["$N",1],["$E",1],["$X",()=>new $lC],["$MB",()=>new $lC],["$9",()=>new $lC(1,1,0)],["$Z",[]],["w",0],["a",0],["s",0],["d",0],["$K",2],["$O",[]],["$B",0],["$GB",[]],["$W",0],["$Q",[0,0,0]]],{$e(){return this.$3B?abs(this.$3B):0},$7(){var E=this.$RB%1;return E*=this.$X.$sC?.()||IN(E,1/32,31/32)?1:0,(this.$N<0?1-E:E)%1},$FB(){return this.$7()?OF(this.$7()%.5,.5)%1:1-bar%.5*2%1},$x(E){E=min(1,E/1e3);let{w:t,a:T,s:A,d:s}=this;var n=$YB(this.x)+128,i=$YB(this.y)+128,e=this.$Z.filter(E=>E.$ED<=$ED),e=(e.length?($pB(e,E=>{var t,T,A;E.$4B=E.$4B||E.$ED,E.$v?$sC(this,E.$v)>1/16?(E.$ED=$ED,[T,A]=(t=$KC($mB(E.$v,this),1)).map(abs),$zC(E.$2,t[0]<0?{a:T,d:0}:{a:0,d:T},t[1]<0?{w:A,s:0}:{w:0,s:A})):(E.$ZC=E.$ED,E.$2={w:0,a:0,s:0,d:0}):(E.$ED=-1,E.$ZC=$ED),$zC(this,E.$2)}),e.length&&({w:t,a:T,s:A,d:s}=this),this.$Z=this.$Z.filter(E=>!E.$ZC||E.$ZC>$ED||E.$ED>$ED)):$zC(this,{w:0,a:0,s:0,d:0}),this.$MB=new $lC(s-T,A-t,0),this.$N=$VC(this.$MB.x||this.$N),this.$E=$VC(this.$MB.y||this.$E),new $lC(...this.$MB)),R=new $lC(...this.$X),r=this.$FB();if(0===e.$sC()&&IN(R.$sC(),1/16,r)&&e.$HC(new $lC(...this.$9).$KC((1-r)/2)),e.$KC(4*E),this.$MB.$sC()){const A=.75+OF(e.$gB().$KC(2).$HC(R.$gB().$KC(1)).$sC(),3)/4;R.$ZB(A)}R.$HC(e),R.$KC(min(R.$sC(),this.$K));var I,e=(this.$X=R).$sC(),h=new $lC(...R);h.$KC(h.$sC()*E);const O=$HC(this,h);this.$cB.length&&!this.$cB.find(E=>$sC($mB(E,O))<E.$p)&&h.$ZB(-.5);let S=$YB(this.x+h.x)+128,a=$YB(this.y+h.y)+128;if(n===S&&i===a||((I=world.$vB[a][S])&&I!==this&&(h.$ZB(-.1),S=$YB(this.x+h.x)+128,a=$YB(this.y+h.y)+128),world.$vB[i][n]=null,world.$vB[a][S]=this),this.$HC(h),this.$RB+=h.$sC(),this.$3B=e*this.$N,this.$9=e?R.$gB().$KC(1):this.$9,this.$MB.$sC()<.25&&R.$sC()&&R.$ZB(this.$FB()<1/8?0:$xC(1-2*E,1)),0===R.$sC()&&this.$7()&&r&&(R.$ZB(0),this.$RB=$YB(2*this.$RB)/2),this===$n){const A=$JB(this.$RB/.25);A>this.$W&&$sB("$q",this.$9.x/-2),this.$W=A}}},"$lC"),({$lB:A=512,$GB:s=[]}={})=>{const n=$3C(A),i=A/2,e=A/12,T={$0B:1,R:i,$lB:A,$GB:s,$nB:(E=n,t)=>(E.DO(()=>{let T=5.6*e;t?E.$pC(n.$dC,0,0,64,64):(E===n&&E.E().center(),E.P().A(0,0,i).C().F(E.GR(0,2*e,4*e,0,0,A,["#242","#262"])),n.P().A(0,0,T),$t(28,E=>{var[E,t]=$BD([1,0],$UB[28]*(E-.5)-$UB[4]);n.M(E*T,t*T).L(E*i,t*i)}),n.W(n.GR(0,2*e,3*e,0,0,A,["#3536","#4846"]),2),$t(13,E=>{let t=0,T=(E-11)*e*2.25;var A;E<10&&(A=$UB[10]*(E+2.5),[t,T]=$BD([4.5*e,0],A)),n.P().A(t,T,e).C().F("rgba(127,127,127,0.25)"),s[E]&&n.P().A(t,T,e).C().F("#aa9")}))}),T),$8C(E){return s[world.$GB.indexOf(E)]=1,T.$nB(),T},get $pC(){return n.$dC}};return T.$nB(),T}),$H=new Map,$IB=($EC("$m",[["$wB",null],["$EB",()=>`hwb(${$YB(30+10*rand.$eB()-2)} ${$YB(0+10*rand())}% ${$YB(47+10*rand())}%)`],["$u",()=>`hwb(${$YB(30+2*rand.$eB()-2)} 0% ${$YB(67+4*rand())}%)`],["$XB",0],["$SB",[]],["$8B",[]]],{$MC(E,t,T,A,s){var n,i,e,R,r,I,[E,t,T,A,s]=[$nC(E,4),$nC(t,64),T,A,$nC(s[0],4)],A=[E,t,T,A,s].join();return $H.has(A)||(n=$tB(t)/8,i=E?E/8:$tB(t)/16,e=$HB(t)/8,abs(E/16),[t,R]=[E?$4C(t):[0,0],E?$4C(1-t):[0,0]],[[t,R],[r,I]]=[t,R],s=sqrt(abs(s)/(abs(E)||1)),$H.set(A,$MC().A(0+i*s,e-3,1,$d[4],$d).M(0+i*s,e-2).L(2+r/3,n*T-1.5).L(1+t/16,n*T-1).L(1+t*s,R).L(0,e-1).L(-1-r*s,I).L(r/16-1,-1-n*T).L(-2-t/3,-1.5-n*T).C())),$H.get(A)},$nB(i,e){const R=bar%.5*2;i.DO(()=>{e?i.T(32,64).S(16,16):this.$PC(i);var E=this.$7()%.5,E=E?OF(E%.5,.5):1-R,t=this["$3B"];let T=t?t/8:$tB(E)/16,A=$HB(E)/8,s=abs(t/16);const n=sqrt(abs(this.$X[0])/(abs(t)||1));this.shell&&0<this.$E&&i.P().A(0-T*n/2,-1.75-A/2+s,7/8).C().W("#242",1/16).F("#131");t=this.$MC(this.$3B,E,this.$N,this.$E,this.$X);i.WP(this.$u,1/8,t).FP(this.$EB,t),this.shell&&(this.$E<0||$l)&&i.DO(()=>{i.P().A(0-T*n/2,-1.75-A/2+s,7/8).C(),i.W("#242",1/16),i.T(0-T*n/2,-1.75-A/2+s),i.R(this.$X[0]/16),i.$pC(shell.$pC,-1,-1,2,2)}),this.$O.length&&i.DO(E=>{i.T(-1,-7).S(1/32,1/32).P().RR(0,0,64,64,8).C().F("#fff2").$nB(this.$O[0],!0)})})},$6B(){var E,t,T;this.$wB||(this.$wB=this.$yC()),this.$XB&&!this.$Z?.length&&(E=$ED%576,E=$ED-E,t=this.$cB[0],t=$mB(t,this),T=$sC(t),this.$Z=[$zC(new $1C,{$ED:288+E+rand.$qC(16),$v:$HC($ZB(t,(T-2)/T),this)}),$zC(new $1C,{$ED:528+E+rand.$qC(16),$v:this.$wB}),$zC(new $1C,{$ED:575+E})].filter(E=>E.$ED>=$ED))},$cC(E){return this!==E&&this.$mB(E).$sC()<=4&&(!this.$XB&&!this.$SB.length||this.$SB.find(t=>E.$O.find(E=>IS(E,t)))||this.$XB&&this.$8B.find(t=>E.$O.find(E=>IS(E,t))))},$V(E){const T=$uC(this.$SB,t=>E.$O.find(E=>IS(E,t))).filter(E=>E);var t,A;console.log("Interaction needs",T),T.length&&(E.$O=E.$O.filter(E=>!T.includes(E)),this.$O=this.$O.filter(E=>!T.includes(E)),this.$SB=this.$SB.filter(t=>!T.find(E=>IS(E,t)))),this.$XB||this.$SB.length||($sB("$6C"),this.$XB=1,t=this.$cB[0],t=$mB(t,this),A=$sC(t),this.$Z.push($zC(new $1C,{$ED:$ED+1+rand.$qC(8),$v:$HC($ZB(t,(A-2)/A),this)})))}},"$7C"),$EC("$a",[["$wB",null],["$AB",1]],{$6B(){if(this.$wB||(this.$wB=this.$yC()),this.$AB){if(!this.$Z?.length){var E=$ED%576;const t=$ED-E,T=this.$cB[0],A=this.$mB(T);$sC(A);const s=$UB[14];this.$Z=$t(14,E=>$zC(new $1C,{$ED:t+42*E+rand.$qC(4),$ZC:t+42*E+42-1,$v:A.$gB().$BD(s*(E+rand()/8)).$HC(T)})).filter(E=>E.$ED>=$ED)}return this}}},"$7C"),$EC("$VB",[["TV",null],["$JC",0]],{$nB(E,t){if(this.TV)return t?E.$pC(this.TV.$dC,0,0,256,256):E.DO(()=>{this.$PC(E),E.$pC(this.TV.$dC,-this.$9B/2,-this.$h,4*this.$9B,4*this.$h)}),this},$cC(E){return 2<this.$9C&&this.$mB(E).$sC()<=4&&E.$O.length<E.$B},$x(E){this.$JC=this.$JC||4+rand.$qC(284),$ED>=this.$JC&&this.$9C<this.$vC&&(this.$U(this.$9C+(rand()+1)/8),this.$JC=$ED+576)}},"$lC"),$EC("$jB",[],{$nB(n,i){n.DO(()=>{i?n.T(32,64).S(16,16):this.$PC(n),n.S(this.$N,1);var E=this.$3B,[t,T]=E?$4C(this.$FB()):[0,0],[A,s]=E?$4C(1-this.$FB()):[0,0],[[A,s],[t,T]]=0<this.$N?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$X[0])/(abs(E)||1));n.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),n.P().M(1,s/4-3).L(2,s/4-2).L(1,s/4-2).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-2).L(.5,s/4-2.5).L(0,s/4-3).C().W("#620",1/8).F("#840"),n.P().A(1,s/4-4,1,$UB[2],1,!0).W("#620",.125)})},$cC(E){return this.$mB(E).$sC()<=4&&E.$GB?.find(E=>IS(E.$yB,$2B))&&E.$O.length<E.$B},$V(E){this.$Z.length=0,this.$AB=0,E.$O.push(new $jB),$sB("beat")}},"$a"),$EC("$CB",[],{$nB(n,i){n.DO(()=>{i?n.T(32,64).S(16,16):this.$PC(n),n.S(this.$N,1);var E=this.$3B,[t,T]=E?$4C(this.$FB()):[0,0],[A,s]=E?$4C(1-this.$FB()):[0,0],[[A,s],[t,T]]=0<this.$N?[[t,T],[A,s]]:[[A,s],[t,T]],E=sqrt(abs(this.$X[0])/(abs(E)||1));n.P().M(1,s/4-2).L(0-t*E,0+T).L(0,s/4-1).C().M(-1,T/4-1).L(A*E-1,0+s).L(-2,T/4-1.5).C().F("#520"),n.P().M(2,s/4-2).L(2,s/4-1).L(1.5,s/4-.5).L(1,s/4-1).L(1+A*E,0+s).L(0,s/4-1).L(-1,T/4-1).L(-2-t*E,0+T).L(-2,T/4-1.5).L(-1.75,T/4-1.75).L(-2,T/4-2).L(0,s/4-3).L(1,s/4-2.25).L(1.5,s/4-2.5).C().W("#620",1/8).F("#840"),n.P().A(2,s/4-2.25,.75,$UB[2],$UB[2]+$UB[7]).W("#620",.125)})},$cC(E){return this.$mB(E).$sC()<=4&&E.$GB?.find(E=>IS(E.$yB,$2B))&&E.$O.length<E.$B},$V(E){this.$Z.length=0,this.$AB=0,E.$O.push(new $CB),$sB("beat")}},"$a"),$EC("$GC",[["$TB",0],["$p",32],["$EB","#ccf"],["$u","#ccf4"]],{$nB(i,e){i.DO(()=>{var E,t,{$TB:T,$p:A}=this,s=(e&&i.T(A,A),A-1),n=1.3*A;T&&(E=$y(cos($UB[28]*T)*n),t=T<14?E:-n,T=14<T?-E:n,i.P().M(0,s).B(T,A,T,-A,0,-s).B(t,-A,t,A,0,s).C().F(this.$EB)),i.P().A(0,0,s).C().W(this.$u,A/16)})},$NB(){return abs(sin($UB[2]*this.$TB/28))}},"$lC"),$EC("$cB",[["$EB",()=>`hwb(${120+rand.$qC(25)} ${10+rand.$qC(5)}% ${$YB(65+rand.$qC(5))}%)`],["$p",16],["$o",[]],["$T",[]],["$P",[]],["$J",null],["$j",null]],{$U(t=16){this.$p=t;rand();return this.$o=$t(16,E=>new $lC(0,-t,0).$BD($UB[16]*(E+rand()/4))),this},$x(t){$pB(this.$P,E=>E.$x(t))}},"$lC"),$EC("$5C",[["TV",null]],{$nB(E){return this.TV||(this.TV=$s({$9B:64,$h:64}).P().M(...rand.XY(1,28)).L(...rand.XY(24,24)).L(...rand.XY(21,12)).L(...rand.XY(31,11)).L(...rand.XY(33,23)).L(...rand.XY(47,14)).L(...rand.XY(53,21)).L(...rand.XY(61,31)).L(...rand.XY(52,44)).L(...rand.XY(42,47)).L(...rand.XY(43,43)).L(...rand.XY(39,48)).L(...rand.XY(16,57)).L(...rand.XY(9,54)).L(...rand.XY(3,42)).C().F(rand.$oC(15,2,17,2,68,4))),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$OC",[["$EB",()=>rand.$oC(150,2,10,6,80,4)],["$vC",8]],{$U(E){return this.$UC=rand.DO(this.$UC,()=>{const n=min(this.$vC,this.$9C=E||this.$9C||4*rand()+3),i=ceil(n);let e=0,R=0,r=0;const t=$t(i,E=>{var t=(n-E)/(n-E+3),T=e-t/.125,A=t*(i-E),s=e+t+.5,E=OF(n-E,i),t=$nC(rand.$eB()*E*t/2),A=(R=max(A,R),`M ${t} ${$nC(T)} L ${$nC(-A)} ${$nC(s)-rand()*E} L ${$nC(r)} ${$nC(e+.25)} L ${$nC(A)} ${$nC(s)-rand()*E} L ${t} `+$nC(T));return r=t,e=T,A}).join(" ")+(" F "+this.$EB);this.$9B=ceil(2*R),this.$h=ceil(abs(e)),this.TV=$3C(this.$9B*$AD*4,this.$h*$AD*4).DO(E=>E.S($AD,$AD).T(this.$9B/2,this.$h).P(t))}),this},$cC(E){return 2<this.$9C&&this.$mB(E).$sC()<=4&&E.$GB?.find(E=>IS(E.$yB,$3))&&E.$O.length<E.$B},$V(E){E.$O.push(new $5C),this.$U(--this.$9C),$sB("beat")}},"$VB"),$EC("$g",[["TV",null],["$TB",0],["$EB",()=>rand.$oC(180,4,33,3,55,4)],["$BC",-1],["$DB",0]],{$U(){const T=this.$DB,A=(this.$9B=4,this.$h=4,this.TV=this.TV??$3C(this.$9B*$AD*4,this.$h*$AD*4),rand.$eB()/4);var E=T?-2:-1.5;const s=rand()/8,n=E+s;return this.TV.DO(E=>{var t;E.E().S($AD,$AD).T(this.$9B/2,this.$h).P().M(-1.5-A,0).B(-2.5,-3,-1,-3,A,s-2).B(1,-3,2.5,-3,1.5+A,0).C().F(this.$EB).P().M(0,0).B(2*-A,-s,4*A,n,A,n).W("#0002",1/8),E.P().A(A,n,T?.75:1/8).F(`hwb(${$YB((180/28*this.$TB+240+rand.$eB()/4)%360)} ${$YB(10+25*rand())}% 5%)`),this.$DB&&(t=$zC(new $GC,{$p:10,$TB:this.$TB,$EB:"#ccf",$u:"#000a"}),E.O(.5).T(1.25*A,n).S(1/16,1/16),t.$nB(E))}),this},$nB(E,t){if(this.TV)return t?E.$pC(this.TV.$dC,0,0,256,256):E.DO(()=>{this.$PC(E),E.$pC(this.TV.$dC,-this.$9B/2,-this.$h,4*this.$9B,4*this.$h)}),E},$x(E,t,T){t=t??moon?.$TB,T=T??$xB;return t!==this.$BC&&.5<=T&&!this.$DB&&(this.$BC=t,this.$DB=+((moon?.$TB??-1)===this.$TB),this.$U()),this},$cC(E){return this.$DB&&this.$mB(E).$sC()<=2&&E.$O.length<E.$B},$V(E){var t=$zC(this.$gB(),{TV:null});E.$O.push(t.$U()),this.$DB=0,this.$U(),$sB("$6C")}},"$lC"),$EC("$LB",[["$EB",()=>rand.$oC(120,2,20,2,67,2)],["$vC",4]],{$U(s){return this.$UC=rand.DO(this.$UC,()=>{const T=min(this.$vC,this.$9C=s||this.$9C||3*rand()+1);var E=ceil(T);const A=6*E+1,t="M 2 0 "+$t(A,E=>{var t=(E+.5)/A*PI,E=E%2;return`L ${$nC(2*cos(t)+(E?rand.$eB()/8:0))} `+(E?$nC(sin(t)*-T*2+rand.$eB()/2):-.5)}).join(" ")+" L -2 0 C F "+this.$EB;this.$9B=4,this.$h=2*E,this.TV=$s({$9B:this.$9B*$AD*4,$h:this.$h*$AD*4,os:!0}),this.TV.DO(E=>E.S($AD,$AD).T(this.$9B/2,this.$h).P(t))}),this},$V(E){E.$O.push($zC((new $LB).$U(1),{$9C:1})),this.$U(--this.$9C),$sB("$dB")}},"$VB"),$EC("$b",[["TV",null]],{$nB(E){return this.TV||(this.TV=$s({$9B:64,$h:64}).P().M(...rand.XY(2,32)).B(0,64,0,64,...rand.XY(16,62)).L(...rand.XY(48,62)).B(64,64,64,64,...rand.XY(62,32)).L(...rand.XY(48,32)).L(...rand.XY(48,12)).L(32,12).L(32,16).L(...rand.XY(44,16)).L(...rand.XY(44,32)).L(...rand.XY(20,32)).L(...rand.XY(20,16)).L(32,16).L(32,12).L(...rand.XY(16,12)).L(...rand.XY(16,32)).C().F(rand.$oC(42,2,16,2,53,4)).P().M(...rand.XY(14,38)).L(...rand.XY(28,58)).M(...rand.XY(36,38)).L(...rand.XY(50,58)).M(...rand.XY(52,38)).L(...rand.XY(38,58)).M(...rand.XY(30,38)).L(...rand.XY(16,58)).W("#4404",2)),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$fC",[["TV",null]],{$nB(E){return this.TV||(this.TV=$s({$9B:64,$h:64}).DO(E=>{var t=rand.XY(32,2,2),T=rand.$oC(105,2,12,2,65,2);E.P().M(...t).B(60,4,64,60,...rand.XY(32,60,2)).B(0,60,4,4,...t).F(rand.$oC(70,2,25,2,15,2)).P().M(...rand.XY(32,6,2)).L(...rand.XY(32,50,2)).M(...rand.XY(16,16,2)).L(...rand.XY(48,16,2)).M(...rand.XY(16,32,2)).L(...rand.XY(48,32,2)).M(...rand.XY(16,48,2)).L(...rand.XY(48,48,2)).W("#641",1).P().M(32,64).B(...rand.XY(26,24),...rand.XY(16,24),...rand.XY(2,14)).B(...rand.XY(8,64),...rand.XY(4,54),32,64).B(...rand.XY(38,24),...rand.XY(48,24),...rand.XY(62,14)).B(...rand.XY(56,64),...rand.XY(56,54),32,64).F(T)})),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$hB",[["$EB",()=>rand.$oC(105,2,12,2,65,2)],["$vC",4],["$qB",[]]],{$U(t){return this.$UC=rand.DO(this.$UC,()=>{const s=rand.$VC();var E=min(this.$vC,this.$9C=t||this.$9C||3*rand()+1);this.$qB.length=0,this.$qB.push(...$t(max(0,$JB(E-1)),E=>new $fC));const n=2*min(E,3);this.$9B=4,this.$h=$YB(2+n),this.TV=$3C(this.$9B*$AD*4,this.$h*$AD*4).DO(A=>{A.S($AD,$AD).T(2,this.$h).P().M(0,-n).L(0,-1/8).W(this.$EB,.25),$t(3,T=>A.DO(E=>{0===T?A.T(0,-n).R(rand.$eB()/8):A.T(0,-n/2+rand.$eB()/2).R(s*$VC(1.5-T)*$UB[7]);var t=this.$qB[T];t?(0===T?A.T(-1,-1):A.T(-1,-2),A.S(1/$AD,1/$AD).$nB(t,!0)):A.P().M(0,0).B(-.5,-.5,-.5,-.5,0,-1).B(.5,-.5,.5,-.5,0,0).C().F(this.$EB)}))})}),this},$V(E){E.$O.push(this.$qB.pop()),this.$U(--this.$9C),$sB("$dB")}},"$VB"),$EC("$5B",[["TV",null]],{$nB(E){return this.TV||(this.TV=$s({$9B:64,$h:64}).P().M(...rand.XY(2,58)).L(...rand.XY(4,61)).L(...rand.XY(61,9)).L(...rand.XY(58,6)).C().F(rand.$oC(15,2,17,2,68,4)).P().M(...rand.XY(7,4)).L(...rand.XY(7,8)).L(...rand.XY(58,61)).L(...rand.XY(61,58)).L(...rand.XY(18,18)).L(...rand.XY(20,12)).L(...rand.XY(18,10)).L(...rand.XY(16,16)).C().F(rand.$oC(15,2,17,2,68,4))),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$fB",[["$EB",()=>rand.$oC(105,2,12,2,65,2)],["$vC",4]],{$U(s){return this.$UC=rand.DO(this.$UC,()=>{const t=min(this.$vC,this.$9C=s||this.$9C||3*rand()+1);var E=ceil(t);const T=2*E+1,A="M 2 0 "+$t(T,E=>{E=(E+.5)/T*PI;return`L ${$nC(2.75*cos(E)+rand.$eB()/2)} `+$nC(sin(E)*-t+rand.$eB()/4)}).join(" ")+` L -2 0 C F ${this.$EB} W #1324 0.125`;this.$9B=6,this.$h=2*E,this.TV=$s({$9B:this.$9B*$AD*4,$h:this.$h*$AD*4,os:!0}),this.TV.DO(E=>E.S($AD,$AD).T(this.$9B/2,this.$h).P(A))}),this},$V(E){E.$O.push(new $5B),this.$U(--this.$9C),$sB("$dB")}},"$VB"),$EC("$SC",[["TV",null],["$EB",()=>rand.$oC(32,3,37,4,55,4)]],{$U(){return this.$UC=rand.DO(this.$UC,()=>{this.TV=$3C(64).P().M(...rand.XY(4,60,3)).L(...rand.XY(9,32,4)).L(...rand.XY(16,16,7)).L(...rand.XY(32,20,8)).L(...rand.XY(48,16,6)).L(...rand.XY(53,32,4)).L(...rand.XY(60,60,3)).L(57,64).L(7,64).C().F(this.$EB).W("#332",1),this.$9B=1,this.$h=1}),this},$nB(E,t){return this.TV||this.$U(),t?E.$pC(this.TV.$dC,0,0,64,64):E.DO(()=>{this.$PC(E),E.$pC(this.TV.$dC,-this.$9B/2,-this.$h,this.$9B,this.$h)}),this},$cC(E){return this.$mB(E).$sC()<=4&&E.$O.length<E.$B},$V(E){E.$O.push(this);var[E,t]=this.$yC(),t=(world.$vB[t+128][E+128]=null,this.$cB[0].$T),E=world.$T;t.splice(t.indexOf(this),1),E.splice(E.indexOf(this),1),$sB("$dB")}},"$lC"),$EC("$3",[["TV",null]],{$nB(E){return this.TV||(this.TV=$3C(64).P().A(24,24,20,PI/2,PI).L(...rand.XY(48,8)).C().F(rand.$oC(32,3,37,4,55,4)).P().M(...rand.XY(24,8)).L(...rand.XY(20,12)).L(...rand.XY(59,61)).L(...rand.XY(61,59)).C().F(rand.$oC(15,2,17,2,68,4))),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$aC",[["TV",null]],{$nB(E){return this.TV||(this.TV=$3C(64).P().M(64,32).L(...rand.XY(52,25)).L(54,32).L(...rand.XY(52,39)).C().F(rand.$oC(32,3,37,4,55,4)).P().M(20,32).L(...rand.XY(17,28)).L(0,28).L(4,32).L(0,36).L(...rand.XY(17,36)).C().F("#fffc").P().M(3,32).L(59,32).M(...rand.XY(20,4)).L(...rand.XY(20,60)).W(rand.$oC(15,2,17,2,68,4),2).P().A(20,32,29,-PI/2-1/8,PI/2+1/8).W(rand.$oC(15,2,17,2,68,4),4)),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$w",[["TV",null],["$EB",()=>rand.$oC(46,3,30,5,40,4)]],{$U(){return this.$UC=rand.DO(this.$UC,()=>{const t=rand.XY(32,16,5),T=rand.XY(32,38,3),A=3*rand.$eB(),s=rand.$oC(10,3,11,3,50,4),n=this.$EB,i=rand.$oC(46,3,5,2,75,4);this.TV=$3C(512).S(8,8).DO(E=>E.P().M(3+A,64).L(...t).L(61+A,64).C().F(E.GR(32,0,16,32,-32,112,[s,n,n,n,s])).W(s,.5).P().M(21+A,64).L(...T).L(43+A,64).C().F(i).P().M(t[0]-4,t[1]-7).L(...t).L(t[0]+5,t[1]-8).W(i,1)),this.$9B=8,this.$h=8}),this},$nB(E,t){return this.TV||this.$U(),t?E.$pC(this.TV.$dC,0,0,64,64):E.DO(()=>{this.$PC(E),E.$pC(this.TV.$dC,-this.$9B/2,-this.$h,this.$9B,this.$h)}),this}},"$lC"),$EC("$2B",[["TV",null]],{$nB(E){return this.TV||(this.TV=$3C(64).P().M(...rand.XY(3,8)).L(...rand.XY(6,3)).L(...rand.XY(48,45)).L(...rand.XY(45,48)).C().F(rand.$oC(15,2,17,2,68,4)).P().M(...rand.XY(63,63)).L(...rand.XY(59,47)).L(...rand.XY(42,42)).L(...rand.XY(47,59)).C().F(rand.$oC(32,3,37,4,55,4))),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$A",[["TV",null]],{$nB(E){return this.TV||(this.TV=$3C(64).P(),this.TV.DO(t=>{$t(4,E=>{t.M(...$HC([32,28],$BD([0,26],$UB[12]*E))).L(...$HC([32,28],$BD([0,26],$UB[12]*(E+4)))).L(...$HC([32,28],$BD([0,26],$UB[12]*(E+8)))).L(...$HC([32,28],$BD([0,26],$UB[12]*E)))}),t.W("#ffcc",1).P().M(6,28).L(2,47).L(6,63).L(10,50).L(6,28).M(58,28).L(54,52).L(58,63).L(62,53).L(58,28).F("#fffc").P().A(32,28,26).W(rand.$oC(15,2,17,2,68,4),4)})),E.$pC(this.TV.$dC,0,0,64,64),E}},"$lC"),$EC("$oB",[["TV",null],["$yB",null],["$SB",[]],["$EB",()=>rand.$oC(46,3,30,5,40,4)]],{$U(t){this.$yB=t===$0B||t===$DD?t():new t,this.TV=$3C(256).DO(E=>{E.P().A(128,128,128).F(E.GR(128,112,112,128,128,128,[this.$EB,rand.$oC(46,3,20,5,50,4)]));try{E.T(64,48).S(2,2).$nB(this.$yB,!0)}catch(E){console.error("Error drawing drum",t,this.$yB)}});let E=[];switch(t){case $b:E=[$LB,$LB,$LB];break;case $3:E=[$5B,$LB,$SC];break;case $2B:E=[$5C,$LB,$SC];break;case $aC:E=[$5C,$5B,$SC];break;case $w:E=[$jB,$CB,$5C];break;case $A:E=[$5B,$LB,$g];break;case $DD:E=[$5B,$LB,$5C];case $GC:E=[$g,$g,$g];break;case $fC:E=[$fC,$fC,$fC];break;case $jB:E=[$jB,$jB,$jB];break;case $CB:E=[$CB,$CB,$CB]}return this.$SB=rand.$5(E),this},$nB(E,t){return t?E.$pC(this.TV.$dC,0,0,64,64):E.$pC(this.TV.$dC,-1,-3,2,2),E},DO(){var E=this.$yB;E.$0B?localStorage.setItem($rC,!0):IS(E,$m)?$n.$B=1:IS(E,$b)&&($n.$B=3)}},"$lC"),new Map),ww=($EC("$uB",[["$tC",()=>new $5C],["O",()=>rand()],["$oB",null]],{$nB(n,E){n.DO(()=>{var E,t,T,A=!this.$cC($n),s=(this.$PC(n),$nC((this.O+bar%.5*2)%1,64));n.DO(()=>n.T(-1.5,-2).S(1/32,1/32).$nB(this.$tC)),n.DO(()=>n.T(1.5,-1.75).S(-1/32,1/32).$nB(this.$tC)),$IB.has(s)||(E=$3C(128,256),t=$tB(s),T=$tB((s+.25)%1),E.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$UB[2]).B(-1,-2.5-T/2,0+t,-2.5-T,0-t/2,-3.5).B(0-t,-2.5-T,1,-2.5-T/2,1,-1.5).F(n.GR(0,-1.25,.5+T/8,0,0,4-T/4,["#ff0a","#e206","#d004"])),$IB.set(s,E)),this.$oB&&!A||n.$pC($IB.get(s).$dC,-1,-4,2,4),this.$oB&&(A&&n.O(.5).T($tB(s)/2,-5),this.$oB.$nB(n))})},$cC(E){return!(this.$cB[0].$T.filter(E=>IS(E,$m)).find(E=>!E.$XB)||!this.$oB||this.$oB.$yB.$0B&&(!this.$oB.$yB.$0B||12!==E.$GB.length))},$V(E){var t=this["$oB"];t?($n.$GB.push(t),$n.shell.$8C(t),t.DO(),DJ.$WC($uC($n.shell.$GB,(E,t)=>E?t+1:null).filter(E=>E)),this.$oB=0,$sB("$6C"),$sB("$dB")):E.$O&&E.$O.shift()}},"$lC"),$EC("$aB",[["$UC",13],["$9C",0],["$GB",[]],["$PB",[]],["$1",[]],["$f",[]],["$vB",()=>$t(256,E=>$t(256,E=>null))],["$BB",[]],["$uC",null],["$JB",null],["$8",[]],["$T",[]],["$P",[]],["$D",[]],["$J",null],["$j",null]],{$U(E){this.$uC=this.$uC||$s({$9B:256,$h:256,os:!0}),this.$JB=this.$JB||$s({$9B:256,$h:256,os:!0}),this.$UC=E,rand.$UC(E);var[E,t]=rand.$5([$b,$3]),[T,A]=rand.$5([rand.$5([$2B,$CB,$fC]),rand.$5([$aC,$jB,$w])]);this.$GB=[$m,E,...T,$DD,...A,t,...rand.$5([$GC,$A]),$0B],this.$J=$J(),this.$j=$j();this.$PB=$t(28,E=>(new $cB).$U(12).$HC([96,0,0]).$BD(E*$UB[28]-$UB[4])),this.$1=$t(13,E=>{E=E<10?(new $cB).$U(18).$HC([80,0,0]).$BD($UB[10]*(E+2.5)):(new $cB).$U(18).$HC([0,16*(E-11)*2.5,0]);return E.$J=$J(),E.$j=$j(),E}),this.$f=$t(3,E=>[$zC((new $cB).$U(16).$HC([0,56,0]).$BD($UB[16]*(2*E+2)),{$j:$j()}),$zC((new $cB).$U(16).$HC([0,56,0]).$BD($UB[16]*(2*E+10)),{$j:$j()})]).flat();const s=this.$1[this.$GB.indexOf($CB)];E=this.$f.find(E=>E.$mB(s).$sC()<E.$p+s.$p);const n=this.$1[this.$GB.indexOf($jB)];T=this.$f.find(E=>E.$mB(n).$sC()<E.$p+n.$p);$pB([[E,$CB,$LB],[T,$jB,$OC]],([T,t,A])=>{T.$T.push(...$t(7,E=>$zC((new t).$HC([0,12,0]).$BD($UB[7]*(E+rand()/8)).$HC(T),{$cB:[T]}))),$t(32,E=>{const t=new $lC(0,-T.$p,0).$BD($UB[32]*(E+rand.$eB()/4));this.$1.filter(E=>t.$gB().$HC(T).$mB(E).$sC()<=E.$p+.05).length<1?((E=(new A).$U().$HC(T).$HC(t)).$cB.push(T),T.$P.push(E),this.$P.push(E)):((E=(new $SC).$U().$HC(T).$HC(t)).$cB.push(T),T.$T.push(E),this.$T.push(E))})});const i=this.$1[this.$GB.indexOf($fC)],e=this.$f.reduce((E,t)=>!E||E.$mB(i).$sC()>t.$mB(i).$sC()&&0===t.$T.length?t:E,null),R=($t(13,E=>{E=(new $hB).$U().$HC([4+rand.$qC(7),0,0]).$BD($UB[13]*E).$HC(e);E.$cB.push(e),e.$P.push(E),this.$P.push(E)}),this.$f.push((new $cB).$U(8).$HC([0,-62,0]),(new $cB).$U(8).$HC([0,-16,0]),(new $cB).$U(8).$HC([0,16,0])),this.$BB=[...this.$PB,...this.$1,...this.$f],$pB(this.$PB,(T,E)=>{T.$IC="moon "+E,$pB(T.$o,t=>{var E;this.$BB.filter(E=>t.$gB().$HC(T).$mB(E).$sC()<=E.$p+.05).length<2&&((E=(new $OC).$U().$HC(T).$HC(t)).$cB.push(T),T.$P.push(E),this.$P.push(E))});E=$zC(new $g,{x:T.x,y:T.y,$TB:E}).$x(0,0,.5);T.$P.push(E),this.$P.push(E)}),this.$GB=$uC(this.$GB,E=>(new $oB).$U(E)),$pB(this.$1,(s,E)=>{const n=(new $uB).$HC(s);n.$oB=this.$GB[E],s.$T.push(n),n.$cB.push(s),$t(3,E=>{var E=$UB[3]*(E+rand.$eB()/8),t=10+rand.$qC(2),T=(new $m).$HC(new $lC(0,t,0).$BD(E).$HC(s));if(n.$oB.$SB.length){var A=n.$oB.$SB.shift();T.$SB.push(A);const E=new A;E.$U?.(1),T.$O.push(E)}A=(new $w).$HC(new $lC(0,t+2,0).$BD(E+$UB[32]*rand.$VC()).$HC(s));$pB(([])=>E=>{var{x:t,y:T}=this.$yC();$zC(E,{x:t,y:T})}),s.$T.push(T,A),$pB([A,T],E=>E.$cB.push(s))}),12!==E&&$t(32,E=>{const t=new $lC(0,-s.$p,0).$BD($UB[32]*(E+rand.$eB()/4));this.$BB.filter(E=>t.$gB().$HC(s).$mB(E).$sC()<=E.$p+.05).length<2&&((E=new(rand.bit()?$LB:$fB)).$U().$HC(s).$HC(t),E.$cB.push(s),s.$P.push(E),this.$P.push(E))})}),this.$T.push(...$uC(this.$BB,E=>E.$T).flat().sort($I)),this.$uC.DO(A=>{A.E().center(),$pB(this.$BB.filter(E=>!this.$f.includes(E)),T=>{A.P(),$pB(T.$o,(E,t)=>(t?A.L:A.M)(E[0]+T.x,E[1]+T.y)),A.C().F(A.GR(0,90,90,0,0,256,["#242","#262"])).O(.25).W(A.GR(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this)["$JB"],r=(R.P().A(128,128,108).W("#202",16).P().A(128,164,80).M(128,128).L(25,150).L(25,80).L(55,50).L(128,30).L(206,50).L(231,80).L(231,150).L(128,128).F(this.$JB.GR(128,164,23,128,164,28,["#fff2","#2026","#202"])).P().A(128,102,40).F(this.$JB.GR(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])).P().A(128,164,22).F(this.$JB.GR(128,164,16,128,160,30,["#fff8","#fff4"])),R.P(),$pB(this.$f,E=>R.M(E.x+128,E.y+128).A(E.x+128,E.y+128,E.$p)),R.F(R.GR(128,128,48,128,108,192,["#141","#263"])),this.$JB.$pC(this.$uC.$dC,0,0,256,256),$zC(new $GC,{$p:10}));return $pB(this.$PB,(t,E)=>{$zC(r,{$TB:E}),this.$JB.DO(E=>{E.T(128+t.x,128+t.y).O(.875).P().A(0,0,t.$p).F(t.$EB).O(.125),r.$nB(E)})}),this.$JB.DO(E=>{E.center(),$pB(this.$P.filter(E=>!(E instanceof $g)),E=>this.$JB.P().A(E.x,E.y+.5,1.25).F(E.$EB))}),$pB([...this.$T,...this.$P,$n],E=>{E.y=$z(E.y),E.x=$z(E.x),this.$vB[E.y+128][E.x+128]=E,IS(E,$w)&&(this.$vB[E.y+128][E.x+127]=E,this.$vB[E.y+128][E.x+129]=E)}),this},$TC(){},$CC(){},$x(t){const T=this.$BB.filter(E=>$sC($mB(E,$n))<E.$p);return(T.find(E=>!$n.$cB.includes(E))||$n.$cB.find(E=>!T.includes(E)))&&($n.$cB=T,DJ?.$KB?.((T.find(E=>E.$J)||this).$J,(T.find(E=>E.$j)||this).$j)),$pB(this.$BB,E=>E.$x(t)),this},$nB(t){this.$D.length=0;var T=-t.W2/$AD,A=t.W1/$AD;let s=1;const n=max(0,$YB($c.y));for(let E=n;E<=min(256,$YB($c.y+132));E+=1){s&&t.O(1-s);const n=new $lC($c.x,E-128,0).$4(0);var i=n[2];if(0===i)break;var e=i*$AD*2,R=max(0,$JB($c.x+128-t.W2/e)-4);min(256-R,ceil(t.W1/e)+8);t.$pC(this.$JB.$dC,$c.x+128-t.W2/e,E,t.W1/e,1,T,(n[1]-t.H2)/$AD,A,2*i),$pB($YC(this.$vB[E].filter(E=>E),$I),E=>{E.$nB(t),E.$cC?.($n)&&this.$D.unshift(E)}),s&&(t.O(1),s=max(0,s-i/4))}return t.$dC}},"$lC")),TV=$s();let moon=new $GC,sun=$DD(32,"#ffd"),rand=$WB(13),stars=$t(91,()=>[rand.$eB(),rand.$eB()]),shell=$0B(),$n=$zC(new $m,{x:0,y:104,z:0,shell:shell,$E:-1,$EB:"#840",$u:"#620"}),$QB=new $lC,world=($QB.$MC=$MC().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $aB).$U(localStorage.getItem($rC)?Date.now():13)),$c=new $lC($n.x,$n.y+$C,$n.z+$L);const $2C=t=>{$l||(D+=t*$QC,$xB=D%$eC/$eC,measure=$JB(D/4e3),bar=D%4e3/4e3,beat=$JB(8*bar),$ED=$JB(D/250),$BC!==$ED&&$sB("tick"),$BC=$ED,step=D%$bC/$bC,$AC.change&&$n.$Z.unshift($zC(new $1C,{$ED:$ED,$2:$AC.$HC})),$AC.shift?$n.$K=4:$n.$K=2,world.$x(t),$n.$x(t),$pB(world.$T,E=>E.$6B?.()),$pB(world.$T,E=>E.$x?.(t))),$c.x+=($n.x-$c.x)/16,$c.y+=($n.y+($l?$C:$G)-$c.y)/16,$c.z+=($n.z-$c.z+($l?$L:$R))/16};let $FC=$t(256,E=>[E,E]).flat().map(E=>E/$AD);const $DC=(E=0)=>{performance.now();var t=E-now;now=E,$2C(t*$QC);const{H1:T,H2:e,H3:A,W1:s,W2:R,W3:n,R3:r,RM:I}=TV;E=$xB,t=E;const h=(E+.5)%1;moon.$TB=D?$JB((28+(D-$0()*$eC)/$eC)%28):0;let O=$6(t)*n;const S=$Y(t);let a=$6(h)*n;const L=$Y(h);.5<E?O=-a:a=-O;let N;TV.DO(()=>{if(TV.E(),TV.ctx.fillStyle=.1<S?"#840":"#202",TV.ctx.fillRect(0,0,s,T),TV.center(),.25<L){const i=A-L*A*2;$pB(stars,([E,t])=>{var T=E*R,A=(t-h)*e,s=OF($sC([a,i],[T,A]),4*moon.$p),n=1+.5*sin((7.3*t+now%$eC/$eC+1.1*E)*$d),t=(1+n)**2*max(0,sin(7.3*t+now/$eC*130+11*E)**3);TV.O(max(0,1-moon.$NB()/2-(s<.25?1:1-s))).P().A(T,A,n).F("#ffd").C(),TV.P().M(T,A-t).L(T,A+t).M(T-t,A).L(T+t,A).W("#ffd",.5)}),N=`rgba(204,204,255,${$nC(.1*moon.$NB())})`,TV.O(max(0,L)).P().A(a,i,2*I).C().F(TV.GR(a,i,r*moon.$NB(),a,i,2*r,[`rgba(204,204,255,${$nC(.05+.2*moon.$NB())})`,N,N,"rgba(24,0,24,0)"])).T(a,i),moon.$nB(TV),N="#ccf6"}.25<S&&(TV.O(max(0,S)),N="#aae6",TV.P().A(O,A-S*A*2,2*I).C().F(TV.GR(O,A-S*A*2,sun.R*max(S,0),O,A-S*A*2,I,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$pC(sun.$pC,O-sun.R,A-S*A*2-sun.R,sun.D,sun.D))}),TV.DO(()=>{TV.T(R,e),TV.S($AD,$AD),world.$nB(TV)}),TV.DO(()=>TV.T($QB.x-2,$QB.y-2).S(4,4).R($d*$tB(now%4e3/4e3)).FP("#280c",$QB.$MC)),$QB.$v=$l?null:world.$D.find(E=>TV.ctx.isPointInPath(E.$M(),$QB.x,$QB.y)),$QB.$v&&TV.DO(()=>{var E=$QB.$v.$M();TV.ctx.setLineDash([13,7]),TV.ctx.lineDashOffset=now/1e3*20,TV.WP("#280",1,E)});const i=$n.$B;$t(i,s=>TV.DO(E=>{var t=$n.$O[s],T=(TV.W1-128)/(i+1)*(s+1)+32,A=max(2*TV.H3,TV.H1-128);TV.T(T,A).P().RR(0,0,64,64,4).C().F("#fff4"),t&&t.$nB(TV,!0)})),$l&&(TV.ctx.fillStyle="#0f0",TV.ctx.font="32px monospace",$pB(["wasd = move","shift = run","esc = pause/resume","mouse = interact",DJ?"- paused -":"click to play"],(E,t)=>TV.ctx.fillText(E,TV.W2-TV.ctx.measureText(E).width/2,32*(t+1))),$pB(["Use the fire to empty inventory.","Drums can unlock new interactions","Help each villager to unlock drums."],(E,t)=>TV.ctx.fillText(E,TV.W2-TV.ctx.measureText(E).width/2,TV.H1+-32*(t+1)))),13===$n.$GB.length&&(TV.ctx.fillStyle="#0f0",TV.ctx.font="32px monospace",$pB(["Refresh to create a new world","You collected all 13 drums.","Congratulations!"],(E,t)=>TV.ctx.fillText(E,TV.W2-TV.ctx.measureText(E).width/2,TV.H1+-32*(t+1)))),requestAnimationFrame($DC)},$AC=($DC(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $HC(){var{w:E,a:t,s:T,d:A}=this;return{w:E,a:t,s:T,d:A}}}),$i=($LC("mousedown",()=>$l=!1),ON("click",()=>$QB.$v?.$V($n)),ON("keydown",E=>{$sB("input");E=E.key.toLowerCase();$AC[E]=1,$sB("key-"+E),"escape"===E&&($l=!$l,$sB("pause"))}),ON("keyup",E=>$AC[E.key.toLowerCase()]=0),ON("mousedown",()=>$sB("input")),ON("mousemove",({clientX:E,clientY:t})=>$zC($QB,{x:E,y:t})),ON("resize",()=>{TV.$r(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$pB(["visibilitychange","blur"],E=>ON(E,()=>{$pB(Object.keys($AC),E=>$AC[E]=0)})),(E,t,T)=>E.addEventListener(t,T));$pB(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],t=>$i(document,t,(...E)=>$sB(t,...E))),$pB(["resize","blur"],t=>$i(window,t,(...E)=>$sB(t,...E))),$i(document,"click",()=>DJ=DJ||$1B()),document.body.appendChild(TV.$RC);})()