(()=>{let now=0,$0=500,$3=144e3,D=0,$HA=0,$q=0,$LA=0,measure=0,beat=0,bar=0,step=0,$QB=!0,$0A=1,$m=32;const{cos,sin,min,max,sqrt,floor:$nA,ceil,round:$yA,imul,abs,PI,sign:$4A}=Math,$YB=(t=0,E=t=>t)=>new Array(t).fill(0).map((t,E)=>E).map(E),$n=([t,E],e)=>[t*cos(e)-E*sin(e),t*sin(e)+E*cos(e)],$RA=([t,E,e],[T,A,s])=>[t+T,E+A,e+s],$y=([t,E,e],[T,A,s])=>[t-T,E-A,e-s],$a=(t,E=1e3)=>$yA(t*E)/E,$L=(t,E)=>t<E?t/E:1,$i=(t,E)=>max(0,$L(t,E)),$K=(t,E,e)=>E<t&&t<e,$6A=(t,E=(t,E)=>t-E)=>t.sort(E),$zA=([t,E],e=1)=>[t*e,E*e],$UA=([t,E],e=1)=>{e/=$e([t,E])||1;return[t*e,E*e]},$e=([t,E],[e=0,T=0]=[])=>sqrt((e-t)**2+(T-E)**2),$2B=t=>(0<t?$nA:ceil)(t),$HB=t=>(t<0?$nA:ceil)(t),$3B=t=>$4A(t)*$yA(abs(t)),$JB=2*PI,$wA=$YB(128,t=>t?$JB/t:0),$l=(...t)=>Object.assign(...t),$AA=(t,E)=>t.forEach?.(E),$g=(t,E)=>t.map(E),$uB=(t,E)=>t.y-E.y||t.z-E.z||t.x-E.x,$9=t=>1+2.70158*(t-1)**3+1.70158*(t-1)**2,$6=t=>t*t*(2.70158*t-1.70158),$7=t=>1-cos(t*PI/2),$BA=t=>-(cos(PI*t)-1)/2,$lA=t=>sin(t*PI),$DA=t=>sin(t*$JB),$4=2.5949095,$5=$JB/4.5,$lB=()=>min(500/$3,.05),$iB=t=>{let E=max(0,sin(t*$JB)),e=$lB();return e<t&&t<=2*e?E+=2*$9((t-e)/e):2*e<t&&t<.5?E+=2:.5<=t&&t<.5+e&&(E+=2-2*$6((t-.5)/e)),E/3},$7B=t=>2*$BA($L(t,.5))-1,_WALK=t=>[(min(2*t,0)-(1-cos(t*$JB)))/2,-$7(-min(sin(t*$JB),0))/2],$cA=t=>_WALK(t),$xA=(t=0)=>{let T=0|t;return let=fn=()=>{var t=(T=T+2654435769|0)^T>>>16,t=imul(t,569420461);return t^=t>>>15,(((t=imul(t,1935289751))^t>>15)>>>0)/4294967296*2},$l(fn,{$3A:t=>void 0!==t?T=0|t:T,$d:(t=1)=>$yA(fn()*t),$t:()=>1-2*fn(),$4A:()=>$HB(fn.$t()),bit:()=>$yA(fn()),bool:()=>!!$yA(fn()),$6B:t=>t.slice().sort(fn.$t),$XA:t=>t[$2B(fn()*t.length)],$b:(t,E,e,T,A,s)=>`hwb(${$yA(t+fn.$t()*E)} ${$yA(e+fn.$t()*T)}% ${$yA(A+fn.$t()*s)}%)`,$W:(t,E,e=1)=>[t+fn.$t()*e,E+fn.$t()*e],$B:(t,E)=>{var e=T;return T=0|(t??T),E(),T=e,t??e}})},$8A=new Map,$o=t=>($8A.has(t)||$8A.set(t,new Set),$8A.get(t)),$N=(t,E)=>$o(t).add(E),$h=(t,E)=>$o(t).delete(E),$CA=(t,...E)=>$AA([...$o(t)],t=>t(...E)),$VA=(E,e)=>{let T=(...t)=>{$h(E,T),e(...t)};$N(E,T)};let DJ=0;const $5A=(t=0,E=0,e=16)=>{let T=t?e/t:0;return $6A($YB(t,t=>$nA(t*T+E+e)%e))},$A=$5A(7,2,12),$EB=32/27,Q=$YB(51,t=>440*2**((t-36)/12)).filter((t,E)=>$A.includes(E%12)).slice(2),$rA=(t,E)=>$6A([...new Set([...t,...E])]),$vB=()=>{let e=Q.slice(1,14);return[[Q[0],.3,0,[0,3,8,11,14]],...$YB(13,t=>{let E=rand.$XA(e);return e=e.filter(t=>t!==E),[E,.2*rand(),rand.$t(),$5A(1+rand.$d(),rand.$d(15))]})]},$PB=()=>[Q[15],...rand.$6B(Q.slice(16))].slice(0,8),$X=(t,e,E,T,A,s=6)=>{const i=t.createOscillator();var n=t.createGain(),R=t.createStereoPanner();i.frequency.setValueAtTime(E/$EB,A),$AA($5A(s,2),(t,E)=>i.frequency.exponentialRampToValueAtTime(E%2?e*$EB:e/$EB,A+E/8)),n.gain.setValueAtTime(.1*E,A),n.gain.exponentialRampToValueAtTime(.5*E,A),n.gain.exponentialRampToValueAtTime(E,A+.325),n.gain.exponentialRampToValueAtTime(.01,A+2),R.pan.setValueAtTime(T,A),R.pan.exponentialRampToValueAtTime(-T,A+2),i.connect(n),n.connect(R),R.connect(t.destination),i.start(A),i.stop(A+2)},$s=(t,E,e,T,A,s,i)=>{var n=t.createOscillator(),R=t.createGain(),r=t.createStereoPanner(),O=t.createDynamicsCompressor(),s=s||e;n.frequency.setValueAtTime(E,A),n.frequency.exponentialRampToValueAtTime(E/1.5,A+.5),R.gain.setValueAtTime(.01,A),R.gain.exponentialRampToValueAtTime(s,A+1/32),R.gain.exponentialRampToValueAtTime(s/5,A+1/16),R.gain.linearRampToValueAtTime(0,A+.5),r.pan.setValueAtTime(i??T,A),O.threshold.setValueAtTime(-50,A),O.knee.setValueAtTime(40,A),O.ratio.setValueAtTime(12,A),O.attack.setValueAtTime(0,A),O.release.setValueAtTime(.25,A),n.connect(R),R.connect(r),r.connect(O),O.connect(t.destination),n.start(A),n.stop(A+.51)},$VB=(t,E,e=0,T)=>{var A=.04+.03*rand(),s=1/8+rand()/16,i=t.createOscillator(),n=t.createGain(),R=t.createStereoPanner();i.type="triangle",i.frequency.setValueAtTime(E,T),n.gain.setValueAtTime(A,T),n.gain.exponentialRampToValueAtTime(A/2,T+1/32),n.gain.linearRampToValueAtTime(0,T+s),R.pan.setValueAtTime(e,T),i.connect(n),n.connect(R),R.connect(t.destination),i.start(T),i.stop(T+s)},$AB=()=>{let s=new AudioContext,t=-$a(D/4e3,10)%1,i=t,e=[0],n=[],T=[],E=null,A=null;var R,r;return setInterval(()=>{s.currentTime+.25<i||i<0||(E&&(n=E,E=null),A&&(T=A,A=null),$X(s,T[7-(beat+measure%8)%8]||2*Q[rand.$d(6)],.2,.5*rand.$t(),i,$nA(i-t)%3+4),$AA(e,t=>{const[E,e,T,A]=n[t];$AA(A,t=>$s(s,E,$a(e),T,.25*t+i))}),i+=4)},100),$N("$VB",(t=0)=>{$VB(s,(T[beat]||Q[15])/2,"number"==typeof t?t:0,s.currentTime)}),$N("beat",()=>{var[,t,E,,]=n[0];$s(s,Q[14],t,E,s.currentTime)}),$N("$X",()=>$X(s,2*(T[7-(beat+measure%8)%8]||Q[0]),.3,.5*rand.$t(),s.currentTime,6)),$N("pause",()=>{"running"===s.state&&$QB?s.suspend():"suspended"!==s.state||$QB||s.resume()}),R=$vB(),r=$PB(),E=R,A=r,{n:i,get track(){return n},get voices(){return e},get melody(){return T},sing:(t=[],E)=>{e=$rA([0,...t]),T=E||T}}},$WA=($XB=({$FB:t=min(1920,window.innerWidth),$NB:E=min(1080,window.innerHeight),os:T=!1}={})=>{let A=T?null:document.createElement("canvas"),s=(A&&(A.width=t,A.height=E),T?new OffscreenCanvas(t,E):A.transferControlToOffscreen()),n=s.getContext("2d");s.width=t,s.height=E;const R={get $S(){return s.width},get $T(){return s.width/2},get $U(){return s.width/3},get $H(){return s.height},$I:s.height/2,get $J(){return s.height/3},get $O(){return min(R.$J,R.$U)},get Rm(){return min(R.$H,R.$S)},get $P(){return max(R.$H,R.$S)},$2:s,$1A:A,ctx:n,$WB:(t,E)=>{var e;T||(e=document.createElement("canvas"),A.replaceWith(e),(A=e).width=t,e.height=E,s=A.transferControlToOffscreen(),n=s.getContext("2d"),$l(R,{$2:s,ctx:n,$1A:A})),s.width=t,s.height=E,R.$I=s.height/2},$B:t=>(n.save(),t(R),n.restore(),R),E:()=>(n.clearRect(0,0,R.$S,R.$H),R),center:()=>(R.T(R.$T,R.$I),R),$D:(t="none")=>(n.filter=t,R),T:(t,E)=>(n.translate(t,E),R),R:(t,E)=>(n.rotate(t,E),R),$Q:(...t)=>(n.roundRect(...t),R),M:(...t)=>(n.moveTo(...t),R),L:(...t)=>(n.lineTo(...t),R),A:(t=0,E=0,e=1,T=0,A=$wA[1],s=!1)=>(n.arc(t,E,e,T,A,s),R),B:(...t)=>(n.bezierCurveTo(...t),R),P:t=>(n.beginPath(),t?.match(/[MLABCTREOSFW](?:\s*-?\d+(?:\.\d+)?|\s*#[a-f0-9]{3,8}|\s*hwb\([^)]+?\))*/g).forEach(t=>{var[t,...E]=t.includes("(")?[t[0],t.slice(1).trim()]:t.split(" ");R[t](...$g(E,t=>"#"===t[0]||t.includes("(")?t:parseFloat(t,10)))}),R),C:()=>(n.closePath(),R),O:t=>(n.globalAlpha=t,R),S:(t=1,E=1)=>(n.scale(t,E),R),$G:(e,T)=>$AA(T,(t,E)=>e.addColorStop(E/T.length,t)),$E:(t,E,e,T,A)=>{t=n.createLinearGradient(t,E,e,T);return R.$G(t,A),t},$F:(t,E,e,T,A,s,i)=>{t=n.createRadialGradient(t,E,e,T,A,s);return R.$G(t,i),t},F:t=>(n.fillStyle=t,n.fill(),R),$C:(t,E)=>(n.fillStyle=t,n.fill(E),R),W:(t,E)=>(n.strokeStyle=t,n.lineWidth=E,n.stroke(),R),$V:(t,E,e)=>(n.strokeStyle=t,n.lineWidth=E,n.stroke(e),R),$c:(...t)=>(n.drawImage(...t),R)};return R.E(),R.$z=t=>t.$z(R),R},()=>{const i=new Path2D;return i.M=(...t)=>(i.moveTo(...t),i),i.L=(...t)=>(i.lineTo(...t),i),i.A=(t=0,E=0,e=1,T=0,A=$wA[1],s=!1)=>(i.arc(t,E,e,T,A,s),i),i.$=(...t)=>(i.arcTo(...t),i),i.B=(...t)=>(i.bezierCurveTo(...t),i),i.Q=(...t)=>(i.quadraticBezierCurveTo(...t),i),i.C=()=>(i.closePath(),i),i}),$bA=(t,E)=>$XB({$FB:t,$NB:E||t,os:!0}),$p=(t=32,E="#840")=>{const e=$bA(3*t),T=t/4,A=1.4*t;return e.$B(()=>{e.E().center().P().A(0,0,t).C().F(E).P().M(-A,-T).L(A,-T).M(-A,T).L(A,T).M(-T,-A).L(-T,A).M(T,-A).L(T,A).W(E,3)}),{R:1.5*t,D:3*t,get $c(){return e.$2}}},$OA=(Array.$cB=()=>[],(a,d,m={},p="$8")=>{const dd=window[p].$cB?.()??[],o=dd.length,dv=$g(d,([,t])=>"function"==typeof t?t.toString().replace(/^\(\) ?=> ?/,""):JSON.stringify(t)).join(","),e=`window.${a}=class ${a} extends ${p}{`+`static $cB=()=>[...${p}.$cB(),${dv}];`+`constructor(...x){super(...(x.length ? x : ${a}.$cB()))}`+"*[Symbol.iterator]() {for(let i = 0,l=this.length;i<l;i++){yield this[i]}}"+$g(d,([t],E)=>`  get ${t}(){return this[${E+o}]} set ${t}(x){return this[${E+o}]=x}`).join("")+$g(Object.values(m),t=>t.toString()).join("")+"};";return eval(e)}),$JA=($OA("$8",[["x",0],["y",0],["z",0],["$Z",0],["$r",[]],["$3A",null]],{$u(){return new this.constructor(...this)},$RA(t){return[this.x,this.y,this.z]=$RA(this,t),this},$n(t){return[this.x,this.y]=$n(this,t),this},$y(t){return new $8(...$y(this,t))},$j(){return $g([this.x,this.y,this.z],$yA)},$UA(t=1){return[this.x,this.y]=$UA([this.x,this.y],t),this},$zA(t=1){return this.$UA(this.$e()*t),this},$e(){return $e([this.x,this.y])},$ZA(t){var[E,e,T]=this.$C();return t.S(T,T),t.T(E,e),this},$C(){var[t,E,e]=this.$y($IB),T=E<0?4/-E*5:0;return[t*=4,E=4*e*T,T]},$5B(t=1){var[E,e,T]=this.$C(),A=(E*=T*$m,e*=T*$m,t?2*-$m*T:0);return new $8(E+$R.$T,e+$R.$I+A,2*T*(t?$m:1))},$nB(){var[t,E,e]=this.$5B();return $WA().A(t,E,abs(e)).C()},$1B(){},$DB(){},$z(){},$1(){},$fB(){}},"Array"),$OA("$A",[["$IA",null],["$M",[]],["$B",()=>{}]]),$OA("$9A",[["$q",0],["$4B",{}],["$0B",null],["$CB",null],["$7A",null],["$1B",null]],{},"Array"),{w:0,a:0,s:0,d:0}),$B=($OA("$Y",[["shell",null],["$BB",0],["$uA",0],["$oB",1],["$zB",1],["$hB",()=>new $8],["$pA",()=>new $8],["$aB",()=>new $8(1,1,0)],["$jB",[]],["w",0],["a",0],["s",0],["d",0],["$wB",2],["$pB",[]],["$jA",[]],["$gB",0],["$rB",[0,0,0]]],{$KB(){return this.$BB?abs(this.$BB):0},$8B(){var t=this.$uA%1;return t*=this.$hB.$e?.()||$K(t,1/32,31/32)?1:0,(this.$oB<0?1-t:t)%1},$iA(){return this.$8B()?$L(this.$8B()%.5,.5)%1:1-bar%.5*2%1},$1B(t){t=min(1,t/1e3);let{w:E,a:e,s:T,d:A}=this;var s=$yA(this.x)+128,i=$yA(this.y)+128,n=this.$jB.filter(t=>t.$q<=$q),n=(n.length?($AA(n,t=>{var E,e,T;t.$CB=t.$CB||t.$q,t.$0B?$e(this,t.$0B)>1/16?(t.$q=$q,[e,T]=(E=$UA($y(t.$0B,this),1)).map(abs),$l(t.$4B,E[0]<0?{a:e,d:0}:{a:0,d:e},E[1]<0?{w:T,s:0}:{w:0,s:T})):(t.$7A=t.$q,t.$4B={w:0,a:0,s:0,d:0}):(t.$q=-1,t.$7A=$q),$l(this,t.$4B)}),n.length&&({w:E,a:e,s:T,d:A}=this),this.$jB=this.$jB.filter(t=>!t.$7A||t.$7A>$q||t.$q>$q)):$l(this,{w:0,a:0,s:0,d:0}),this.$pA=new $8(A-e,T-E,0),this.$oB=$4A(this.$pA.x||this.$oB),this.$zB=$4A(this.$pA.y||this.$zB),new $8(...this.$pA)),R=new $8(...this.$hB),r=this.$iA();if(0===n.$e()&&$K(R.$e(),1/16,r)&&n.$RA(new $8(...this.$aB).$UA((1-r)/2)),n.$UA(4*t),this.$pA.$e()){const T=.75+$L(n.$u().$UA(2).$RA(R.$u().$UA(1)).$e(),3)/4;R.$zA(T)}R.$RA(n),R.$UA(min(R.$e(),this.$wB));var O,n=(this.$hB=R).$e(),a=new $8(...R);a.$UA(a.$e()*t);const I=$RA(this,a);this.$r.length&&!this.$r.find(t=>$e($y(t,I))<t.$UB)&&a.$zA(-.5);let h=$yA(this.x+a.x)+128,S=$yA(this.y+a.y)+128;if(h<0||255<h||S<0||256<S)console.log("Bad end of movement",h,S,this);else if(s===h&&i===S||((O=world.$FA[S][h])&&O!==this&&(a.$zA(-.1),h=$yA(this.x+a.x)+128,S=$yA(this.y+a.y)+128),world.$FA[i][s]=null,world.$FA[S][h]=this),this.$RA(a),this.$uA+=a.$e(),this.$BB=n*this.$oB,this.$aB=n?R.$u().$UA(1):this.$aB,this.$pA.$e()<.25&&R.$e()&&R.$zA(this.$iA()<1/8?0:$i(1-2*t,1)),0===R.$e()&&this.$8B()&&r&&(R.$zA(0),this.$uA=$yA(2*this.$uA)/2),this===$SB){const T=$nA(this.$uA/.25);T>this.$gB&&$CA("$VB",this.$aB.x/-2),this.$gB=T}}},"$8"),({$x:E=512,$jA:A=[]}={})=>{const s=$bA(E),T=E/2,i=E/12,e={R:T,$x:E,$jA:A,$z:(t=s)=>(t.$B(()=>{let e=5.6*i;t===s&&t.E().center(),t.P().A(0,0,T).C().F(t.$F(0,2*i,4*i,0,0,E,["#242","#262"])),s.P().A(0,0,e),$YB(28,t=>{var[t,E]=$n([1,0],$wA[28]*(t-.5)-$wA[4]);s.M(t*e,E*e).L(t*T,E*T)}),s.W(s.$F(0,2*i,3*i,0,0,E,["#3536","#4846"]),2),$YB(13,t=>{let E=0,e=(t-11)*i*2.25;var T;t<10&&(T=$wA[10]*(t-2),[E,e]=$n([4.5*i,0],T)),s.P().A(E,e,i).C().F("rgba(127,127,127,0.25)"),A[t]&&s.P().A(E,e,i).C().F("#aa9")})}),e),add(t){return A.push(t),e.$z(),e},get $c(){return s.$2}};return e.$z(),e}),$tB=new Map,$mA=($OA("$RB",[["$GA",null],["$hA",()=>`hwb(${$yA(30+10*rand.$t()-2)} ${$yA(0+10*rand())}% ${$yA(47+10*rand())}%)`],["$ZB",()=>`hwb(${$yA(30+2*rand.$t()-2)} 0% ${$yA(67+4*rand())}%)`]],{$WA(t,E,e,T,A){var s,i,n,R,r,O,[t,E,e,T,A]=[$a(t,4),$a(E,64),e,T,$a(A[0],4)],T=[t,E,e,T,A].join();return $tB.has(T)||(s=$DA(E)/8,i=t?t/8:$DA(E)/16,n=$lA(E)/8,abs(t/16),[E,R]=[t?$cA(E):[0,0],t?$cA(1-E):[0,0]],[[E,R],[r,O]]=[E,R],A=sqrt(abs(A)/(abs(t)||1)),$tB.set(T,$WA().A(0+i*A,n-3,1,$JB[4],$JB).M(0+i*A,n-2).L(2+r/3,s*e-1.5).L(1+E/16,s*e-1).L(1+E*A,R).L(0,n-1).L(-1-r*A,O).L(r/16-1,-1-s*e).L(-2-E/3,-1.5-s*e).C())),$tB.get(T)},$z(i,n=bar%.5*2,R=!0){i.$B(()=>{R&&this.$ZA(i);var t=this.$8B()%.5,t=t?$L(t%.5,.5):1-n,E=this["$BB"];let e=E?E/8:$DA(t)/16,T=$lA(t)/8,A=abs(E/16);const s=sqrt(abs(this.$hB[0])/(abs(E)||1));this.shell&&0<this.$zB&&i.P().A(0-e*s/2,-1.75-T/2+A,7/8).C().W("#242",1/16).F("#131");E=this.$WA(this.$BB,t,this.$oB,this.$zB,this.$hB);i.$V(this.$ZB,1/8,E).$C(this.$hA,E),this.shell&&(this.$zB<0||$QB)&&i.$B(()=>{i.P().A(0-e*s/2,-1.75-T/2+A,7/8).C(),i.W("#242",1/16),i.T(0-e*s/2,-1.75-T/2+A),i.R(this.$hB[0]/16),i.$c(shell.$c,-1,-1,2,2)})})},$DB(){var t,E,e,T;this.$GA||(this.$GA=this.$j()),this.$jB?.length||(t=$q%576,t=$q-t,E=this.$r[0],e=$y(E,this),T=$e(e),this.$jB=[$l(new $9A,{$q:16+t+rand.$d(16),$0B:$RA($UA(e,-2),E)}),$l(new $9A,{$q:64+t+rand.$d(16),$0B:this.$GA}),$l(new $9A,{$q:288+t+rand.$d(16),$0B:$RA($zA(e,(T-2)/T),this)}),$l(new $9A,{$q:416+t+rand.$d(16),$0B:this.$GA}),$l(new $9A,{$q:575+t})].filter(t=>t.$q>=$q))}},"$Y"),$OA("$w",[],{$z(s){s.$B(()=>{this.$ZA(s),s.S(this.$oB,1);var t=this.$BB,[E,e]=t?$cA(this.$iA()):[0,0],[T,A]=t?$cA(1-this.$iA()):[0,0],[[T,A],[E,e]]=0<this.$oB?[[E,e],[T,A]]:[[T,A],[E,e]],t=sqrt(abs(this.$hB[0])/(abs(t)||1));s.P().M(1,A/4-2).L(0-E*t,0+e).L(0,A/4-1).C().M(-1,e/4-1).L(T*t-1,0+A).L(-2,e/4-1.5).C().F("#520"),s.P().M(1,A/4-3).L(2,A/4-2).L(1,A/4-2).L(1+T*t,0+A).L(0,A/4-1).L(-1,e/4-1).L(-2-E*t,0+e).L(-2,e/4-1.5).L(-1.75,e/4-1.75).L(-2,e/4-2).L(0,A/4-2).L(.5,A/4-2.5).L(0,A/4-3).C().W("#620",1/8).F("#840"),s.P().A(1,A/4-4,1,$wA[2],1,!0).W("#620",.125)})}},"$Y"),$OA("$fA",[],{$z(s,t,E,e){s.$B(()=>{this.$ZA(s),s.S(this.$oB,1);var t=this.$BB,[E,e]=t?$cA(this.$iA()):[0,0],[T,A]=t?$cA(1-this.$iA()):[0,0],[[T,A],[E,e]]=0<this.$oB?[[E,e],[T,A]]:[[T,A],[E,e]],t=sqrt(abs(this.$hB[0])/(abs(t)||1));s.P().M(1,A/4-2).L(0-E*t,0+e).L(0,A/4-1).C().M(-1,e/4-1).L(T*t-1,0+A).L(-2,e/4-1.5).C().F("#520"),s.P().M(2,A/4-2).L(2,A/4-1).L(1.5,A/4-.5).L(1,A/4-1).L(1+T*t,0+A).L(0,A/4-1).L(-1,e/4-1).L(-2-E*t,0+e).L(-2,e/4-1.5).L(-1.75,e/4-1.75).L(-2,e/4-2).L(0,A/4-3).L(1,A/4-2.25).L(1.5,A/4-2.5).C().stroke("#620",1/8).F("#840"),s.P().A(2,A/4-2.25,.75,$wA[2],$wA[2]+$wA[7]).stroke("#620",.125)})}},"$Y"),$OA("$QA",[["$vA",0],["$UB",32],["$hA","#ccf"],["$ZB","#ccf4"]],{$z(i){i.$B(()=>{var t,E,{$vA:e,$UB:T}=this,A=T-1,s=1.3*T;e&&(t=$2B(cos($wA[28]*e)*s),E=e<14?t:-s,e=14<e?-t:s,i.P().M(0,A).B(e,T,e,-T,0,-A).B(E,-T,E,T,0,A).C().F(this.$hA)),i.P().A(0,0,A).C().W(this.$ZB,T/16)})},$qA(){return abs(sin($wA[2]*this.$vA/28))}},"$8"),$OA("$r",[["$hA",()=>`hwb(${120+rand.$d(25)} ${10+rand.$d(5)}% ${$yA(65+rand.$d(5))}%)`],["$UB",16],["$TB",[]],["$dB",[]],["$qB",[]],["$PB",null]],{$eB(E=16){this.$UB=E;rand();return this.$TB=$YB(16,t=>new $8(0,-E,0).$n($wA[16]*(t+rand()/4))),this},$1B(E){$AA(this.$qB,t=>t.$1B(E))}},"$8"),$OA("$dA",[["$R",null]],{$z(t){return this.$R||(this.$R=$XB({$FB:64,$NB:64}).P().M(...rand.$W(1,28)).L(...rand.$W(24,24)).L(...rand.$W(21,12)).L(...rand.$W(31,11)).L(...rand.$W(33,23)).L(...rand.$W(47,14)).L(...rand.$W(53,21)).L(...rand.$W(61,31)).L(...rand.$W(52,44)).L(...rand.$W(42,47)).L(...rand.$W(43,43)).L(...rand.$W(39,48)).L(...rand.$W(16,57)).L(...rand.$W(9,54)).L(...rand.$W(3,42)).C().F(rand.$b(15,2,17,2,68,4))),t.$c(this.$R.$2,0,0,64,64),t}},"$8"),$OA("$YA",[["$WA",""],["$R",null],["$FB",0],["$NB",0],["$TA",0],["$hA",()=>rand.$b(150,2,10,6,80,4)]],{$eB(t){return this.$3A=rand.$B(this.$3A,()=>{const s=min(8,this.$Z=t||this.$Z||4*rand()+3),i=ceil(s);let n=0,R=0,r=0;this.$WA=$YB(i,t=>{var E=(s-t)/(s-t+3),e=n-E/.125,T=E*(i-t),A=n+E+.5,t=$L(s-t,i),E=$a(rand.$t()*t*E/2),T=(R=max(T,R),`M ${E} ${$a(e)} L ${$a(-T)} ${$a(A)-rand()*t} L ${$a(r)} ${$a(n+.25)} L ${$a(T)} ${$a(A)-rand()*t} L ${E} `+$a(e));return r=E,n=e,T}).join(" ")+` F ${this.$hA} S #1218`,this.$FB=ceil(2*R),this.$NB=ceil(abs(n)),this.$R=$XB({$FB:this.$FB*$m*4,$NB:this.$NB*$m*4,os:!0}),this.$R.$B(t=>t.S($m,$m).T(this.$FB/2,this.$NB).P(this.$WA))}),this},$z(t){if(this.$R)return t.$B(()=>{this.$ZA(t),t.$c(this.$R.$2,-this.$FB/2,-this.$NB,4*this.$FB,4*this.$NB)}),this},$1B(t){this.$TA=this.$TA||4+rand.$d(284),$q>=this.$TA&&(this.$eB(this.$Z+(rand()+1)/8),this.$TA=$q+576)},$1(t){return 2<this.$Z&&this.$y(t).$e()<=4},$fB(t){console.log("$YA $fB");var E=$l(new $dA);t.$pB.push(E),this.$eB(--this.$Z),$CA("beat")}},"$8"),$OA("$MB",[["$R",null],["$vA",0],["$hA",()=>rand.$b(180,4,33,3,55,4)],["$LA",-1],["$FB",4],["$NB",4],["$gA",!1]],{$eB(){const e=this.$gA,T=(this.$R=this.$R??$bA(this.$FB*$m*4,this.$NB*$m*4),rand.$t()/4);var t=e?-2:-1.5;const A=rand()/8,s=t+A;return this.$R.$B(t=>{var E;t.E().S($m,$m).T(this.$FB/2,this.$NB).P().M(-1.5-T,0).B(-2.5,-3,-1,-3,T,A-2).B(1,-3,2.5,-3,1.5+T,0).C().F(this.$hA).P().M(0,0).B(2*-T,-A,4*T,s,T,s).W("#0002",1/8),t.P().A(T,s,e?.75:1/8).F(`hwb(${$yA((180/28*this.$vA+240+rand.$t()/4)%360)} ${$yA(10+25*rand())}% 5%)`),this.$gA&&(E=$l(new $QA,{$UB:10,$vA:this.$vA,$hA:"#ccf",$ZB:"#000a"}),t.O(.5).T(1.25*T,s).S(1/16,1/16),E.$z(t))}),this},$z(t,E){if(this.$R)return E?t.$c(this.$R.$2,0,0,256,256):t.$B(()=>{this.$ZA(t),t.$c(this.$R.$2,-this.$FB/2,-this.$NB,4*this.$FB,4*this.$NB)}),t},$1B(t,E,e){var E=E??moon?.$vA,e=e??$HA;return E!==this.$LA&&.5<=e&&(e=((this.$LA=E)+28-this.$vA)%28<3,this.$gA=e,this.$eB()),this},$1(t){return this.$gA&&this.$y(t).$e()<=2},$fB(t){console.log("$MB $fB");var E=$l(this.$u(),{$R:null});t.$pB.push(E.$eB()),this.$gA=!1,this.$eB(),$CA("$X")}},"$8"),new Map),$R=($OA("$EA",[["$f",()=>new $dA],["O",()=>rand()]],{$z(A,t){A.$B(()=>{this.$ZA(A);var t,E,e,T=$a((this.O+bar%.5*2)%1,64);A.$B(()=>A.T(-1.5,-2.125).S(1/32,1/32).$z(this.$f)),A.$B(()=>A.T(1.5,-2).S(-1/32,1/32).$z(this.$f)),$mA.has(T)||(t=$bA(128,256),E=$DA(T),e=$DA((T+.25)%1),t.S(64,64).T(1,4).P().M(1,-1.5).A(0,-1.5,1,0,$wA[2]).B(-1,-2.5-e/2,0+E,-2.5-e,0-E/2,-3.5).B(0-E,-2.5-e,1,-2.5-e/2,1,-1.5).F(A.$F(0,-1.25,.5+e/8,0,0,4-e/4,["#ff0a","#e206","#d004"])),$mA.set(T,t)),A.$c($mA.get(T).$2,-1,-4,2,4)})}},"$8"),$OA("$GB",[["$3A",13],["$Z",0],["$sA",[]],["$jA",[]],["$LB",[]],["$FA",()=>$YB(256,t=>$YB(256,t=>null))],["$eA",[]],["$g",null],["$nA",null],["$9B",[]],["$dB",[]],["$qB",[]],["$yB",[]],["$vB",null],["$PB",null]],{$eB(t){this.$g=this.$g||$XB({$FB:256,$NB:256,os:!0}),this.$nA=this.$nA||$XB({$FB:256,$NB:256,os:!0}),this.$3A=t,rand.$3A(t),this.$vB=$vB(),this.$PB=$PB();this.$sA=$YB(28,t=>(new $r).$eB(12).$RA([96,0,0]).$n(t*$wA[28]-$wA[4])),this.$jA=$YB(13,t=>t<10?(new $r).$eB(18).$RA([80,0,0]).$n($wA[10]*(t+2.5)):(new $r).$eB(18).$RA([0,16*(t-11)*2.5,0])),this.$eA=[...this.$sA,...this.$jA],$AA(this.$sA,(e,t)=>{e.$SA="moon "+t,$AA(e.$TB,E=>{var t;this.$eA.filter(t=>E.$u().$RA(e).$y(t).$e()<=t.$UB+.05).length<2&&((t=(new $YA).$eB().$RA(e).$RA(E)).$r.push(e),e.$qB.push(t),this.$qB.push(t))});t=$l(new $MB,{x:e.x,y:e.y,$vA:t}).$1B(0,0,.5);e.$qB.push(t),this.$qB.push(t)}),$AA(this.$jA,(E,t)=>{E.$dB.push((new $EA).$RA(E)),$YB(3,t=>{t=(new $RB).$RA(new $8(0,10+rand.$d(2),0).$n($wA[3]*(t+rand.$t()/8)).$RA(E));E.$dB.push(t),t.$r.push(E)}),E.$PB=$PB()}),this.$dB.push(...$g(this.$eA,t=>t.$dB).flat().sort($uB)),this.$g.$B(T=>{T.E().center(),$AA(this.$eA,e=>{T.P(),$AA(e.$TB,(t,E)=>(E?T.L:T.M)(t[0]+e.x,t[1]+e.y)),T.C().F(T.$F(0,90,90,0,0,256,["#242","#262"])).O(.25).W(T.$F(0,184,276,0,0,256,["#353","#484"]),1).O(1)})}),this.$nA.P().A(128,128,108).W("#202",16).C().P().A(128,112,48).F(this.$nA.$F(128,128,32,128,128,256,["hwb(250deg 14% 57%)","hwb(220deg 65% 12%)"])),this.$nA.$c(this.$g.$2,0,0,256,256);const e=$l(new $QA,{$UB:10});return $AA(this.$sA,(E,t)=>{$l(e,{$vA:t}),this.$nA.$B(t=>{t.T(128+E.x,128+E.y).O(.875).P().A(0,0,E.$UB).F(E.$hA).O(.125),e.$z(t)})}),this.$nA.$B(t=>{t.center(),$AA(this.$qB.filter(t=>!(t instanceof $MB)),t=>this.$nA.P().A(t.x,t.y+.5,1.25).F(t.$hA))}),$AA([...this.$dB,...this.$qB,$SB],t=>{t.y=$3B(t.y),t.x=$3B(t.x),this.$FA[t.y+128][t.x+128]=t}),this},$2A(){},$MA(){},$1B(E){const e=this.$eA.filter(t=>$e($y(t,$SB))<t.$UB);return(e.find(t=>!$SB.$r.includes(t))||$SB.$r.find(t=>!e.includes(t)))&&($SB.$r=e,DJ?.$oA?.(this.$vB,(e.find(t=>t.$PB)||this).$PB)),$AA(this.$eA,t=>t.$1B(E)),this},$z(E){this.$yB.length=0;var e=-E.$T/$m,T=E.$S/$m;for(let t=0;t<=min(256,$yA($IB.y+132));t+=1){var A=new $8($IB.x,t-128,0).$5B(0),s=A[2];if(0===s)break;var i=s*$m*2,n=max(0,$nA($IB.x+128-E.$T/i)-4);min(256-n,ceil(E.$S/i)+8);E.$c(this.$nA.$2,$IB.x+128-E.$T/i,t,E.$S/i,1,e,(A[1]-E.$I)/$m,T,2*s),$AA($6A(this.$FA[t].filter(t=>t),$uB),t=>{t.$z(E),t.$1?.($SB)&&this.$yB.unshift(t)})}return E.$2}},"$8"),$XB());let moon=new $QA,sun=$p(32,"#ffd"),rand=$xA(13),stars=$YB(91,()=>[rand.$t(),rand.$t()]),shell=$B(),$SB=$l(new $RB,{x:0,y:104,z:0,shell:shell,$zB:-1,$hA:"#840",$ZB:"#620"}),$tA=new $8,world=($tA.$WA=$WA().M(-2,-2).L(2,2).L(-2,2).L(2,-2).C(),(new $GB).$eB(13)),entities=[],$sB=20,$bB=-2,$xB=4,$mB=-1/8,$IB=new $8($SB.x,$SB.y+$xB,$SB.z+$mB);const $aA=E=>{$QB||(D+=E*$0A,$v=$nA(D/$3),$HA=D%$3/$3,measure=$nA(D/4e3),bar=D%4e3/4e3,beat=$nA(8*bar),$q=$nA(D/250),$LA!==$q&&$CA("tick"),$LA=$q,step=D%$0/$0,$KA.change&&$SB.$jB.unshift($l(new $9A,{$q:$q,$4B:$KA.$RA})),$KA.shift?$SB.$wB=4:$SB.$wB=2,world.$1B(E),$SB.$1B(E),$AA(world.$dB,t=>t.$DB?.()),$AA(world.$dB,t=>t.$1B?.(E))),$IB.x+=($SB.x-$IB.x)/16,$IB.y+=($SB.y+($QB?$xB:$sB)-$IB.y)/16,$IB.z+=($SB.z-$IB.z+($QB?$mB:$bB))/16};let $PA=$YB(256,t=>[t,t]).flat().map(t=>t/$m);const $NA=(t=0)=>{performance.now();var E=t-now;now=t,$aA(E*$0A);const{$H:e,$I:n,$J:T,$S:A,$T:R,$U:s,$O:r,$P:O}=$R;var t=$HA,E=t;const a=(t+.5)%1;moon.$vA=D?$nA((28+(D-$lB()*$3)/$3)%28):0;let I=$7B(E)*s;const h=$iB(E);let S=$7B(a)*s;const P=$iB(a);.5<t?I=-S:S=-I;let L;$R.$B(()=>{if($R.E(),$R.ctx.fillStyle=.1<h?"#840":"#202",$R.ctx.fillRect(0,0,A,e),$R.center(),.25<P){const i=T-P*T*2;$AA(stars,([t,E])=>{var e=t*R,T=(E-a)*n,A=$L($e([S,i],[e,T]),4*moon.$UB),s=1+.5*sin((7.3*E+now%$3/$3+1.1*t)*$JB),E=(1+s)**2*max(0,sin(7.3*E+now/$3*130+11*t)**3);$R.O(max(0,1-moon.$qA()/2-(A<.25?1:1-A))).P().A(e,T,s).F("#ffd").C(),$R.P().M(e,T-E).L(e,T+E).M(e-E,T).L(e+E,T).W("#ffd",.5)}),L=`rgba(204,204,255,${$a(.1*moon.$qA())})`,$R.O(max(0,P)).P().A(S,i,2*O).C().F($R.$F(S,i,r*moon.$qA(),S,i,2*r,[`rgba(204,204,255,${$a(.05+.2*moon.$qA())})`,L,L,"rgba(24,0,24,0)"])).T(S,i),moon.$z($R),L="#ccf6"}.25<h&&($R.O(max(0,h)),L="#aae6",$R.P().A(I,T-h*T*2,2*O).C().F($R.$F(I,T-h*T*2,sun.R*max(h,0),I,T-h*T*2,O,["#fff","#aae","#aaec","rgba(170,170,238,0)"])).$c(sun.$c,I-sun.R,T-h*T*2-sun.R,sun.D,sun.D))}),$R.$B(()=>{$R.T(R,n),$R.S($m,$m),world.$z($R)}),$R.$B(()=>$R.T($tA.x-2,$tA.y-2).S(4,4).R($JB*$DA(now%4e3/4e3)).$C("#2808",$tA.$WA)),$tA.$0B=$QB?null:world.$yB.find(t=>$R.ctx.isPointInPath(t.$nB(),$tA.x,$tA.y)),$tA.$0B&&$R.$B(()=>{var t=$tA.$0B.$nB();$R.ctx.setLineDash([13,7]),$R.ctx.lineDashOffset=now/1e3*20,$R.$V("#280",1,t)});const i=$SB.$pB.length;$AA($SB.$pB,(E,t)=>{const e=($R.$S-128)/(i+1)*(t+1)+64,T=$R.$H-128;$R.$B(t=>E.$z(t.T(e,T).P().$Q(0,0,64,64,4).C().F("#fff4"),!0))}),DJ||($R.ctx.fillStyle="#0f0",$R.ctx.font="32px monospace",E="Click to begin",$R.ctx.fillText(E,$R.$T-$R.ctx.measureText(E).width/2,$R.$J)),requestAnimationFrame($NA)},$KA=($NA(0),{w:0,a:0,s:0,d:0,get change(){return this.w+this.a+this.s+this.d},get $RA(){var{w:t,a:E,s:e,d:T}=this;return{w:t,a:E,s:e,d:T}}}),$OB=($VA("mousedown",()=>$QB=!1),$N("click",()=>$tA.$0B?.$fB($SB)),$N("keydown",t=>{$CA("input");t=t.key.toLowerCase();$KA[t]=1,$CA("key-"+t),"escape"===t&&($QB=!$QB,$CA("pause"))}),$N("keyup",t=>$KA[t.key.toLowerCase()]=0),$N("mousedown",()=>$CA("input")),$N("mousemove",({clientX:t,clientY:E})=>$l($tA,{x:t,y:E})),$N("resize",()=>{$R.$WB(min(1920,window.innerWidth),min(1080,window.innerHeight))}),$AA(["visibilitychange","blur"],t=>$N(t,()=>{$AA(Object.keys($KA),t=>$KA[t]=0)})),(t,E,e)=>t.addEventListener(E,e));$AA(["mousedown","mouseup","mousemove","click","keydown","keyup","visibilitychange"],E=>$OB(document,E,(...t)=>$CA(E,...t))),$AA(["resize","blur"],E=>$OB(window,E,(...t)=>$CA(E,...t))),$OB(document,"click",()=>DJ=DJ||$AB()),document.body.appendChild($R.$1A);})()